# 知识库检索

> 用于检索个人知识库，支持向量检索、关键词检索、混合检索，支持自定义重排模型。

## OpenAPI

````yaml openapi/openapi.json post /llm-application/open/knowledge/retrieve
paths:
  path: /llm-application/open/knowledge/retrieve
  method: post
  servers:
    - url: https://open.bigmodel.cn/api/
      description: 开放平台服务
  request:
    security:
      - title: bearerAuth
        parameters:
          query: {}
          header:
            Authorization:
              type: http
              scheme: bearer
              description: >-
                使用以下格式进行身份验证：Bearer [<your api
                key>](https://bigmodel.cn/usercenter/proj-mgmt/apikeys)
          cookie: {}
    parameters:
      path: {}
      query: {}
      header: {}
      cookie: {}
    body:
      application/json:
        schemaArray:
          - type: object
            properties:
              request_id:
                allOf:
                  - type: string
                    description: 请求唯一id，用于定位日志
              query:
                allOf:
                  - type: string
                    description: 查询内容，限制在1000字以内
              knowledge_ids:
                allOf:
                  - type: array
                    description: 知识库ID列表
                    items:
                      type: string
              document_ids:
                allOf:
                  - type: array
                    description: 文档ID列表
                    items:
                      type: string
              top_k:
                allOf:
                  - type: integer
                    description: 最终召回数量，取值范围为[1~20]，默认为8
              top_n:
                allOf:
                  - type: integer
                    description: 初始召回数量，取值范围为[1~100]，默认为10
              recall_method:
                allOf:
                  - type: string
                    description: '检索类型 embedding: 向量化检索(默认)， keyword:关键词检索， mixed: 混合检索'
              recall_ratio:
                allOf:
                  - type: integer
                    description: 混合检索中向量检索的权重，取值范围(0~100)，默认为80
              rerank_status:
                allOf:
                  - type: integer
                    description: '是否开启重排，0: 不开启，1: 开启，默认不开启'
              rerank_model:
                allOf:
                  - type: string
                    description: 重排模型，支持rerank、rerank-pro
              fractional_threshold:
                allOf:
                  - type: number
                    description: 相似度阈值，低于该阈值的切片会被过滤
            required: true
            refIdentifier: '#/components/schemas/KnowledgeRetrieveRequest'
            requiredProperties:
              - query
              - knowledge_ids
        examples:
          example:
            value:
              request_id: <string>
              query: <string>
              knowledge_ids:
                - <string>
              document_ids:
                - <string>
              top_k: 123
              top_n: 123
              recall_method: <string>
              recall_ratio: 123
              rerank_status: 123
              rerank_model: <string>
              fractional_threshold: 123
  response:
    '200':
      application/json:
        schemaArray:
          - type: object
            properties:
              data:
                allOf:
                  - type: array
                    description: 检索结果列表
                    items:
                      type: object
                      properties:
                        text:
                          type: string
                          description: 切片内容
                        score:
                          type: number
                          description: 相似度分数
                        metadata:
                          type: object
                          description: 切片元数据
                          properties:
                            _id:
                              type: string
                              description: 切片ID
                            knowledge_id:
                              type: string
                              description: 知识库ID
                            doc_id:
                              type: string
                              description: 文档ID
                            doc_name:
                              type: string
                              description: 文档名称
                            doc_url:
                              type: string
                              description: 文档URL
                            contextual_text:
                              type: string
                              description: 上下文增强内容，不开启上下文增强则为空
              code:
                allOf:
                  - type: integer
                    description: 响应码，200为成功
              message:
                allOf:
                  - type: string
                    description: 响应信息
              timestamp:
                allOf:
                  - type: integer
                    description: 响应时间戳
            refIdentifier: '#/components/schemas/KnowledgeRetrieveResponse'
        examples:
          example:
            value:
              data:
                - text: <string>
                  score: 123
                  metadata:
                    _id: <string>
                    knowledge_id: <string>
                    doc_id: <string>
                    doc_name: <string>
                    doc_url: <string>
                    contextual_text: <string>
              code: 123
              message: <string>
              timestamp: 123
        description: 业务处理成功
    default:
      application/json:
        schemaArray:
          - type: object
            properties:
              code:
                allOf:
                  - type: integer
              message:
                allOf:
                  - type: string
            refIdentifier: '#/components/schemas/LlmApplicationError'
        examples:
          example:
            value:
              code: 123
              message: <string>
        description: 请求失败。
  deprecated: false
  type: path
components:
  schemas: {}

````