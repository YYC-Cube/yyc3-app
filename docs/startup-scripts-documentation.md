/**

* @file 0379.email é¡¹ç›®å¯åŠ¨è„šæœ¬ä¸å¯†é’¥ç®¡ç†æ–‡æ¡£
* @description è¯¦ç»†è®°å½•é¡¹ç›®çš„å¯åŠ¨è„šæœ¬ã€å¯†é’¥ç®¡ç†ã€æƒé™é…ç½®ç­‰ä¿¡æ¯
* @author YYC
* @version 1.0.0
* @created 2024-10-15
 */

# 0379.email é¡¹ç›®å¯åŠ¨è„šæœ¬ä¸å¯†é’¥ç®¡ç†æ–‡æ¡£

## ğŸ“‹ ç›®å½•

* [é¡¹ç›®è„šæœ¬æ¦‚è§ˆ](#é¡¹ç›®è„šæœ¬æ¦‚è§ˆ)
* [å¯åŠ¨è„šæœ¬è¯¦æƒ…](#å¯åŠ¨è„šæœ¬è¯¦æƒ…)
* [å¯†é’¥ç”Ÿæˆä¸ç®¡ç†](#å¯†é’¥ç”Ÿæˆä¸ç®¡ç†)
* [æƒé™é…ç½®](#æƒé™é…ç½®)
* [æœåŠ¡å¯åŠ¨é¡ºåº](#æœåŠ¡å¯åŠ¨é¡ºåº)
* [é…ç½®åŒæ­¥](#é…ç½®åŒæ­¥)
* [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## é¡¹ç›®è„šæœ¬æ¦‚è§ˆ

| è„šæœ¬åç§° | åŠŸèƒ½æè¿° | æ‰§è¡Œå‘½ä»¤ | æ–‡ä»¶ä½ç½® |
|---------|---------|---------|--------|
| start.sh | å…¨å±€å¯åŠ¨å…¥å£ï¼ˆæ¨èä½¿ç”¨ï¼‰ | `./start.sh` | /Users/yanyu/www/app/scripts/ |
| init.sh | é¡¹ç›®åˆå§‹åŒ– | `./init.sh` | /Users/yanyu/www/app/scripts/ |
| generate-keys-linux.sh | Linuxå¯†é’¥ç”Ÿæˆ | `./generate-keys-linux.sh` | /Users/yanyu/www/app/scripts/ |
| generate-keys-macos.sh | macOSå¯†é’¥ç”Ÿæˆ | `./generate-keys-macos.sh` | /Users/yanyu/www/app/scripts/ |
| generate-keys-windows.ps1 | Windowså¯†é’¥ç”Ÿæˆ | `powershell -File generate-keys-windows.ps1` | /Users/yanyu/www/app/scripts/ |
| setup-ssh-keys.sh | SSHå¯†é’¥é…ç½® | `./setup-ssh-keys.sh` | /Users/yanyu/www/app/scripts/ |
| sync-config.sh | é…ç½®åŒæ­¥ | `./sync-config.sh` | /Users/yanyu/www/app/scripts/ |
| ecs-init.sh | é˜¿é‡Œäº‘ECSåˆå§‹åŒ– | `./ecs-init.sh` | /Users/yanyu/www/app/scripts/ |
| nas-setup.sh | NASæœåŠ¡å™¨è®¾ç½® | `./nas-setup.sh` | /Users/yanyu/www/app/scripts/ |
| service-mesh-start.js | æœåŠ¡ç½‘æ ¼å¯åŠ¨ | `node service-mesh-start.js` | /Users/yanyu/www/app/scripts/ |

## å¯åŠ¨è„šæœ¬è¯¦æƒ…

### 1. start.sh - å…¨å±€å¯åŠ¨å…¥å£

**åŠŸèƒ½**ï¼šæä¾›ç»Ÿä¸€çš„é¡¹ç›®ç®¡ç†èœå•ï¼Œæ˜¯æ‰€æœ‰è„šæœ¬çš„ä¸»å…¥å£

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
chmod +x start.sh
./start.sh
```

**ä¸»è¦åŠŸèƒ½æ¨¡å—**ï¼š

* åˆå§‹åŒ–ç®¡ç†
* SSHé…ç½®ç®¡ç†
* éƒ¨ç½²ç®¡ç†
* äº‘æœåŠ¡å™¨éƒ¨ç½²
* NASåŒæ­¥ç®¡ç†
* æ–‡æ¡£ç®¡ç†
* ç¯å¢ƒæ£€æŸ¥
* å·¥å…·é›†
* é¡¹ç›®çŠ¶æ€
* å‘å¸ƒç®¡ç†
* é…ç½®åŒæ­¥

### 2. init.sh - é¡¹ç›®åˆå§‹åŒ–è„šæœ¬

**åŠŸèƒ½**ï¼šåˆå§‹åŒ–é¡¹ç›®ç¯å¢ƒï¼Œé…ç½®.envæ–‡ä»¶ï¼Œå®‰è£…ä¾èµ–ï¼Œè®¾ç½®TLSè¯ä¹¦å’ŒNginx

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
chmod +x init.sh
./init.sh
```

**ä¸»è¦åŠŸèƒ½**ï¼š

* æ£€æŸ¥ç³»ç»Ÿä¾èµ–ï¼ˆcurl, node, npm, nginx, pm2ï¼‰
* åˆå§‹åŒ–å„æœåŠ¡.envæ–‡ä»¶ï¼ˆapi, admin, llm, mailï¼‰
* å®‰è£…é¡¹ç›®ä¾èµ–
* é…ç½®TLSè¯ä¹¦
* è®¾ç½®Nginxé…ç½®

### 3. service-mesh-start.js - æœåŠ¡ç½‘æ ¼å¯åŠ¨è„šæœ¬

**åŠŸèƒ½**ï¼šå¯åŠ¨å’Œç®¡ç†æ•´ä¸ªæœåŠ¡ç½‘æ ¼ç³»ç»Ÿ

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
node service-mesh-start.js
```

## å¯†é’¥ç”Ÿæˆä¸ç®¡ç†

### 1. å¯†é’¥åˆ—è¡¨

| å¯†é’¥æ–‡ä»¶å | ç”¨é€” | å¯¹åº”é…ç½® |
|----------|------|--------|
| id_rsa_local | æœ¬åœ°è®¾å¤‡è¿æ¥ | è¿æ¥æœ¬åœ°å¼€å‘æœºå’ŒNASè®¾å¤‡ |
| id_rsa_aliyun | é˜¿é‡Œäº‘æœåŠ¡å™¨è¿æ¥ | é˜¿é‡Œäº‘ECSæœåŠ¡å™¨é—´é€šä¿¡ |
| id_rsa_github_cube | GitHubä¸»è´¦å· | è®¿é—®YYC-Cubeè´¦æˆ·ä»“åº“ |
| id_rsa_github_neuxs | GitHubå‰¯è´¦å· | è®¿é—®YY-Neuxsè´¦æˆ·ä»“åº“ |
| id_rsa_docker | Dockerè¿œç¨‹è®¿é—® | è¿œç¨‹ç®¡ç†Dockerå®¹å™¨ |

### 2. å¯†é’¥ç”Ÿæˆè„šæœ¬

#### Linux ç¯å¢ƒ

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
chmod +x generate-keys-linux.sh
./generate-keys-linux.sh
```

**ä¸»è¦åŠŸèƒ½**ï¼š

* åˆ›å»ºSSHç›®å½•ç»“æ„
* ç”Ÿæˆ5ç§ä¸“ç”¨å¯†é’¥ï¼ˆä½¿ç”¨ed25519ç®—æ³•ï¼‰
* é…ç½®å¯†é’¥æƒé™ï¼ˆç§é’¥600ï¼Œå…¬é’¥644ï¼‰
* é…ç½®ssh-agentè‡ªåŠ¨æ·»åŠ å¯†é’¥

#### macOS ç¯å¢ƒ

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
chmod +x generate-keys-macos.sh
./generate-keys-macos.sh
```

**ä¸»è¦åŠŸèƒ½**ï¼š

* åˆ›å»ºSSHç›®å½•ç»“æ„
* ç”Ÿæˆ5ç§ä¸“ç”¨å¯†é’¥ï¼ˆä½¿ç”¨ed25519ç®—æ³•ï¼‰
* å°†å¯†é’¥æ·»åŠ åˆ°macOSé’¥åŒ™ä¸²

#### Windows ç¯å¢ƒ

**ä½¿ç”¨æ–¹æ³•**ï¼š

```powershell
./generate-keys-windows.ps1
```

**ä¸»è¦åŠŸèƒ½**ï¼š

* åˆ›å»ºSSHç›®å½•ç»“æ„
* ç”Ÿæˆ5ç§ä¸“ç”¨å¯†é’¥ï¼ˆä½¿ç”¨ed25519ç®—æ³•ï¼‰
* è®¾ç½®Windowsæ–‡ä»¶æƒé™

### 3. SSHå¯†é’¥é…ç½®è„šæœ¬

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
chmod +x setup-ssh-keys.sh
./setup-ssh-keys.sh
```

**ä¸»è¦åŠŸèƒ½**ï¼š

* ç”Ÿæˆæ‰€æœ‰ä¸“ç”¨å¯†é’¥
* è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
* å°†å¯†é’¥æ·»åŠ åˆ°ssh-agent
* æ˜¾ç¤ºå…¬é’¥å†…å®¹ä»¥ä¾¿å¤åˆ¶

## æƒé™é…ç½®

### 1. æ–‡ä»¶æƒé™è®¾ç½®

**SSHç›®å½•ä¸æ–‡ä»¶æƒé™**ï¼š

```bash
# SSHç›®å½•æƒé™
chmod 700 ~/.ssh

# SSHé…ç½®æ–‡ä»¶æƒé™
chmod 600 ~/.ssh/config

# ç§é’¥æ–‡ä»¶æƒé™
chmod 600 ~/.ssh/id_rsa_*

# å…¬é’¥æ–‡ä»¶æƒé™
chmod 644 ~/.ssh/id_rsa_*.pub
```

### 2. è„šæœ¬æ‰§è¡Œæƒé™

**æ‰€æœ‰è„šæœ¬éœ€è¦æ‰§è¡Œæƒé™**ï¼š

```bash
chmod +x /Users/yanyu/www/app/scripts/*.sh
chmod +x /Users/yanyu/www/app/scripts/*.ps1
```

### 3. NASæœåŠ¡å™¨ç‰¹æ®Šé…ç½®

* ç”¨æˆ·åï¼š`YYC`
* ç«¯å£ï¼š`57`

## æœåŠ¡å¯åŠ¨é¡ºåº

### å®Œæ•´å¯åŠ¨æµç¨‹

1. **åˆå§‹åŒ–é˜¶æ®µ**

   ```bash
   # 1. ç”ŸæˆSSHå¯†é’¥
   ./generate-keys-linux.sh  # æˆ–å¯¹åº”å¹³å°çš„è„šæœ¬
   
   # 2. è®¾ç½®SSHå¯†é’¥
   ./setup-ssh-keys.sh
   
   # 3. åˆå§‹åŒ–é¡¹ç›®ç¯å¢ƒ
   ./init.sh
   ```

2. **æœåŠ¡å™¨é…ç½®é˜¶æ®µ**

   ```bash
   # åˆå§‹åŒ–é˜¿é‡Œäº‘ECSæœåŠ¡å™¨
   ./ecs-init.sh
   
   # è®¾ç½®NASæœåŠ¡å™¨
   ./nas-setup.sh
   ```

3. **é…ç½®åŒæ­¥é˜¶æ®µ**

   ```bash
   # åŒæ­¥é…ç½®åˆ°æ‰€æœ‰è®¾å¤‡
   ./sync-config.sh
   ```

4. **æœåŠ¡å¯åŠ¨é˜¶æ®µ**

   ```bash
   # ä½¿ç”¨ä¸»èœå•å¯åŠ¨æœåŠ¡
   ./start.sh
   # ç„¶åé€‰æ‹©ç›¸åº”çš„æœåŠ¡å¯åŠ¨é€‰é¡¹
   ```

### æ¨èå¯åŠ¨å‘½ä»¤

**æœ€ç®€å•çš„å¯åŠ¨æ–¹å¼**ï¼š

```bash
cd /Users/yanyu/www/app/scripts
./start.sh
```

ç„¶ååœ¨èœå•ä¸­é€‰æ‹©ç›¸åº”åŠŸèƒ½ï¼š

1. å…ˆé€‰æ‹©åˆå§‹åŒ–ç®¡ç†
2. ç„¶åé€‰æ‹©éƒ¨ç½²ç®¡ç†
3. æœ€åå¯åŠ¨æ‰€éœ€æœåŠ¡

## é…ç½®åŒæ­¥

### sync-config.sh åŠŸèƒ½

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
chmod +x sync-config.sh
./sync-config.sh
```

**åŒæ­¥å†…å®¹**ï¼š

* SSHé…ç½®æ–‡ä»¶
* ç¯å¢ƒå˜é‡æ–‡ä»¶
* è„šæœ¬ç›®å½•

**åŒæ­¥ç›®æ ‡**ï¼š

* æœ¬åœ°è®¾å¤‡ï¼šM4 Max, iMac M4, åä¸ºç¬”è®°æœ¬
* NASæœåŠ¡å™¨
* é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼šååŒ—2æœåŠ¡å™¨, ååŒ—6æœåŠ¡å™¨

## å¸¸è§é—®é¢˜

### 1. æƒé™é”™è¯¯

**é—®é¢˜**ï¼šè„šæœ¬æ— æ³•æ‰§è¡Œ
**è§£å†³**ï¼šç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™

```bash
chmod +x è„šæœ¬æ–‡ä»¶å.sh
```

### 2. SSHè¿æ¥å¤±è´¥

**é—®é¢˜**ï¼šæ— æ³•è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨
**è§£å†³**ï¼š

* æ£€æŸ¥å¯†é’¥æ˜¯å¦ç”Ÿæˆæ­£ç¡®
* ç¡®è®¤å…¬é’¥å·²æ·»åŠ åˆ°ç›®æ ‡æœåŠ¡å™¨çš„authorized_keys
* éªŒè¯SSHé…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®

### 3. æœåŠ¡å¯åŠ¨å¤±è´¥

**é—®é¢˜**ï¼šæœåŠ¡æ— æ³•æ­£å¸¸å¯åŠ¨
**è§£å†³**ï¼š

* æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
* æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼ˆä½äºå„æœåŠ¡çš„logsç›®å½•ï¼‰
* éªŒè¯ç¯å¢ƒå˜é‡é…ç½®æ˜¯å¦æ­£ç¡®

### 4. å¯†é’¥æƒé™é—®é¢˜

**é—®é¢˜**ï¼šSSHè­¦å‘Šå¯†é’¥æƒé™è¿‡äºå¼€æ”¾
**è§£å†³**ï¼šç¡®ä¿å¯†é’¥æ–‡ä»¶æƒé™æ­£ç¡®

```bash
chmod 600 ~/.ssh/id_rsa_*
chmod 644 ~/.ssh/id_rsa_*.pub
```

---

ğŸ“ **æ³¨æ„äº‹é¡¹**ï¼š

* æ‰€æœ‰è„šæœ¬éƒ½åŒ…å«å¥åº·æ£€æŸ¥å¤´ (`set -euo pipefail`)
* è„šæœ¬è¿è¡Œæ—¥å¿—ä¿å­˜åœ¨é¡¹ç›®logsç›®å½•
* é…ç½®æ–‡ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨é¡¹ç›®configç›®å½•
* å¯†é’¥ç”Ÿæˆä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒå’Œç®—æ³•ï¼ˆed25519ï¼‰
* æ‰€æœ‰é…ç½®éœ€ä¸ssh_config_exampleä¿æŒä¸€è‡´

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ ğŸŒ¹
