# YYCÂ³ Monorepo æ¨¡å— ï¼ˆç»„ä»¶åº“æ‰“åŒ…æ–¹æ¡ˆ NPM åŒ…åŠMonorepo æ¨¡å—ï¼‰

## è¿›ä¸€æ­¥è®¾è®¡ä¸€ä¸ª **ç»„ä»¶åº“æ‰“åŒ…æ–¹æ¡ˆï¼ˆNPM åŒ…ï¼‰**ï¼Œè®©ä½ å›¢é˜Ÿå¯ä»¥åƒå®‰è£…ä¾èµ–ä¸€æ ·å¿«é€Ÿæ¥å…¥è¿™äº›è¡Œä¸šæ™ºèƒ½åˆ†ææ¨¡å—  

---

## âœ… ç»„ä»¶åº“æ‰“åŒ…æ–¹æ¡ˆï¼ˆNPM åŒ…ï¼‰

## 1. é¡¹ç›®ç»“æ„ï¼ˆMonorepo æˆ–ç‹¬ç«‹åŒ…ï¼‰

æ¨èä½¿ç”¨ **Monorepoï¼ˆä¾‹å¦‚ Turborepo æˆ– Nxï¼‰** ç®¡ç†ï¼Œæ–¹ä¾¿æœªæ¥æ‰©å±•ã€‚ç»“æ„å¦‚ä¸‹ï¼š

```
industry-analytics-lib/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                # å¯¼å‡ºå…¥å£
â”‚   â”œâ”€â”€ components/             # å‰ç«¯ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ IndustryOverview.tsx
â”‚   â”‚   â”œâ”€â”€ IndustryScoreTrend.tsx
â”‚   â”‚   â”œâ”€â”€ IndustryScoreRadar.tsx
â”‚   â”‚   â””â”€â”€ IndustryScoreDashboard.tsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useSSE.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ score-engine.ts
â”‚   â”‚   â””â”€â”€ predict-engine.ts
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ score-weights.json
â””â”€â”€ dist/                       # æ„å»ºäº§ç‰©
```

---

## 2. æ‰“åŒ…å·¥å…·é€‰æ‹©

- **æ„å»ºå·¥å…·**ï¼šä½¿ç”¨ `tsup` æˆ– `vite` æ‰“åŒ…ï¼Œæ”¯æŒ ESM + CJS è¾“å‡ºã€‚  
- **ç±»å‹å£°æ˜**ï¼šè‡ªåŠ¨ç”Ÿæˆ `.d.ts` æ–‡ä»¶ï¼Œä¿è¯ TypeScript é¡¹ç›®å¯ç”¨ã€‚  
- **æ ·å¼å¤„ç†**ï¼šå¯é€‰ Tailwind peer dependencyï¼Œä¿æŒè½»é‡ã€‚  

---

## 3. package.json ç¤ºä¾‹

```json
{
  "name": "@yyc3/industry-analytics",
  "version": "1.0.0",
  "description": "è¡Œä¸šæ™ºèƒ½åˆ†æç»„ä»¶åº“ï¼ˆäº”é«˜è¯„åˆ†ã€é¢„æµ‹ã€è¶‹åŠ¿ã€é›·è¾¾å›¾ï¼‰",
  "main": "dist/index.cjs.js",
  "module": "dist/index.esm.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "build": "tsup src/index.ts --format cjs,esm --dts",
    "dev": "vite",
    "test": "vitest"
  },
  "peerDependencies": {
    "react": ">=18",
    "react-dom": ">=18",
    "chart.js": "^4.4.0"
  },
  "dependencies": {
    "chart.js": "^4.4.0"
  },
  "devDependencies": {
    "typescript": "^5.6.3",
    "tsup": "^7.2.0",
    "vite": "^5.0.0",
    "vitest": "^1.0.0"
  }
}
```

---

## 4. å¯¼å‡ºå…¥å£ï¼š`src/index.ts`

```ts
// Components
export { IndustryOverview } from "./components/IndustryOverview"
export { IndustryScoreTrend } from "./components/IndustryScoreTrend"
export { IndustryScoreRadar } from "./components/IndustryScoreRadar"
export { IndustryScoreDashboard } from "./components/IndustryScoreDashboard"

// Hooks
export { useSSE } from "./hooks/useSSE"

// Utils
export { calculateScores } from "./utils/score-engine"
export { forecastSeries } from "./utils/predict-engine"

// Config
export { default as scoreWeights } from "./config/score-weights.json"
```

---

## 5. ä½¿ç”¨æ–¹å¼ï¼ˆåœ¨å¤–éƒ¨é¡¹ç›®ä¸­ï¼‰

```bash
npm install @yyc3/industry-analytics
```

```tsx
import { IndustryOverview, IndustryScoreTrend } from "@yyc3/industry-analytics"

export default function Page() {
  return (
    <main>
      <IndustryOverview />
      <IndustryScoreTrend id="yyc3-dc" />
    </main>
  )
}
```

---

## 6. æ’æ‹”å¼æ‰©å±•

- **å¯é€‰æ¨¡å—**ï¼šç”¨æˆ·åªå®‰è£…éœ€è¦çš„ç»„ä»¶ï¼ˆtree-shaking æ”¯æŒï¼‰ã€‚  
- **é…ç½®é©±åŠ¨**ï¼šæƒé‡æ–‡ä»¶å¯æ›¿æ¢ï¼Œé¢„æµ‹å‚æ•°å¯ä¼ å…¥ã€‚  
- **è·¨é¡¹ç›®å¤ç”¨**ï¼šåŒä¸€ä¸ªåŒ…å¯åœ¨å¤šä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä¿æŒä¸€è‡´æ€§ã€‚  

---

## âœ¨ é—­ç¯æ€»ç»“

ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ª **NPM åŒ…åŒ–çš„ç»„ä»¶åº“æ–¹æ¡ˆ**ï¼š  

- **æ¨¡å—åŒ–**ï¼šæ‰€æœ‰ç»„ä»¶ã€hooksã€utils ç‹¬ç«‹å¯¼å‡º  
- **å¯å¤ç”¨**ï¼šè·¨é¡¹ç›®å¿«é€Ÿå®‰è£…ä½¿ç”¨  
- **å¯æ‰©å±•**ï¼šæœªæ¥å¯åŠ å…¥å‘Šè­¦ã€AI å¼‚å¸¸æ£€æµ‹ã€æ›´å¤šå›¾è¡¨  
- **è½»é‡åŒ–**ï¼šä»…ä¾èµ– React + Chart.jsï¼Œä¿æŒçµæ´»  

---

## âœ… è®¾è®¡ä¸€ä¸ª **Monorepo æ¨¡å—å¤šå…ƒåŒ–æ¨¡ç‰ˆåº“**ï¼Œç”¨äºç®¡ç†å¤šä¸ª NPM åŒ…ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚è¿™æ ·ä½ å¯ä»¥åœ¨ä¸€ä¸ªä»“åº“ä¸­ç»Ÿä¸€ç®¡ç† **ç»„ä»¶åº“ã€å·¥å…·åº“ã€API SDKã€é…ç½®æ¨¡å—** ç­‰ï¼Œæ”¯æŒæ’æ‹”å¼å¼€å‘ä¸å¿«é€Ÿå‘å¸ƒ

---

# âœ… Monorepo æ¨¡å—åŒ–æ¨¡ç‰ˆåº“è®¾è®¡

## 1. Monorepo ç»“æ„å»ºè®®

é‡‡ç”¨ **Turborepo** æˆ– **Nx** ç®¡ç†ï¼Œæ”¯æŒå¤šåŒ…å¹¶è¡Œæ„å»ºä¸ç¼“å­˜ã€‚

```
industry-platform/
â”œâ”€â”€ apps/                        # åº”ç”¨å±‚ï¼ˆæ¼”ç¤ºæˆ–å®é™…é¡¹ç›®ï¼‰
â”‚   â”œâ”€â”€ dashboard/               # ä»ªè¡¨ç›˜åº”ç”¨
â”‚   â””â”€â”€ admin/                   # ç®¡ç†åå°
â”œâ”€â”€ packages/                    # æ¨¡å—åŒ– NPM åŒ…
â”‚   â”œâ”€â”€ ui/                      # å‰ç«¯ç»„ä»¶åº“ï¼ˆReact + Chart.jsï¼‰
â”‚   â”œâ”€â”€ utils/                   # å·¥å…·åº“ï¼ˆè¯„åˆ†å¼•æ“ã€é¢„æµ‹å¼•æ“ï¼‰
â”‚   â”œâ”€â”€ api/                     # API SDKï¼ˆå°è£… REST/SSE è°ƒç”¨ï¼‰
â”‚   â”œâ”€â”€ config/                  # é…ç½®æ¨¡å—ï¼ˆæƒé‡ JSONã€è¡Œä¸šæ˜ å°„ï¼‰
â”‚   â””â”€â”€ hooks/                   # React Hooksï¼ˆuseSSEã€useForecastï¼‰
â”œâ”€â”€ scripts/                     # æ‰¹é‡ä»»åŠ¡ï¼ˆå¯¼å…¥ã€åˆ·æ–°ï¼‰
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ turbo.json                   # Turborepo é…ç½®
â””â”€â”€ package.json                 # æ ¹ä¾èµ–
```

---

## 2. æ¨¡å—åˆ’åˆ†ä¸èŒè´£

| æ¨¡å—       | èŒè´£ | è¾“å‡ºå½¢å¼ |
|------------|------|----------|
| `ui`       | è¡Œä¸šåˆ†æç»„ä»¶åº“ï¼ˆOverviewã€Trendã€Radarã€Dashboardï¼‰ | React ç»„ä»¶ï¼ŒNPM åŒ… |
| `utils`    | è¯„åˆ†å¼•æ“ã€é¢„æµ‹å¼•æ“ã€æ•°æ®å¤„ç†å·¥å…· | TypeScript å·¥å…·å‡½æ•° |
| `api`      | API SDKï¼Œå°è£… `/scores`ã€`/forecast`ã€`/overview` ç­‰æ¥å£ | JS/TS SDK |
| `config`   | æƒé‡é…ç½®ã€è¡Œä¸šæ˜ å°„ã€å¸¸é‡è¡¨ | JSON/TS é…ç½® |
| `hooks`    | å‰ç«¯äº¤äº’ Hooksï¼ˆuseSSEã€useExportã€useIndustryï¼‰ | React Hooks |

---

## 3. æ„å»ºä¸å‘å¸ƒæµç¨‹

### æ„å»ºå·¥å…·

- ä½¿ç”¨ **tsup** æˆ– **rollup** æ‰“åŒ…æ¯ä¸ª packageï¼Œè¾“å‡º ESM + CJS + d.tsã€‚
- ä½¿ç”¨ **Turborepo** ç®¡ç†ä¾èµ–ä¸ç¼“å­˜ï¼ŒåŠ é€Ÿæ„å»ºã€‚

### å‘å¸ƒæµç¨‹ï¼ˆCI/CDï¼‰

1. **ç‰ˆæœ¬ç®¡ç†**ï¼šä½¿ç”¨ `changesets` ç®¡ç†å¤šåŒ…ç‰ˆæœ¬ã€‚
2. **CI/CD Pipeline**ï¼š
   - **Lint & Test**ï¼šè¿è¡Œ ESLint + Vitestã€‚
   - **Build**ï¼šå¹¶è¡Œæ„å»ºæ‰€æœ‰åŒ…ã€‚
   - **Publish**ï¼šè‡ªåŠ¨å‘å¸ƒåˆ° npm registry æˆ– GitHub Packagesã€‚
3. **è‡ªåŠ¨åŒ–**ï¼š
   - æ¯æ¬¡åˆå¹¶åˆ° `main`ï¼Œè§¦å‘ `changeset version`ã€‚
   - CI è‡ªåŠ¨ç”Ÿæˆ changelog å¹¶å‘å¸ƒã€‚

---

## 4. package.json ç¤ºä¾‹ï¼ˆæ ¹ç›®å½•ï¼‰

```json
{
  "name": "industry-platform",
  "private": true,
  "workspaces": [
    "apps/*",
    "packages/*"
  ],
  "scripts": {
    "dev": "turbo run dev --parallel",
    "build": "turbo run build",
    "lint": "turbo run lint",
    "test": "turbo run test",
    "release": "changeset publish"
  },
  "devDependencies": {
    "turbo": "^2.0.0",
    "typescript": "^5.6.3",
    "tsup": "^7.2.0",
    "changesets": "^2.26.0",
    "eslint": "^9.0.0",
    "vitest": "^1.0.0"
  }
}
```

---

## 5. æ’æ‹”å¼å¤ç”¨ç¤ºä¾‹

åœ¨å¤–éƒ¨é¡¹ç›®ä¸­ï¼Œåªéœ€å®‰è£…å¯¹åº”åŒ…ï¼š

```bash
npm install @yyc3/ui @yyc3/utils @yyc3/api
```

ä½¿ç”¨æ–¹å¼ï¼š

```tsx
import { IndustryOverview } from "@yyc3/ui"
import { calculateScores } from "@yyc3/utils"
import { getIndustryScores } from "@yyc3/api"

export default function Page() {
  const scores = calculateScores({ cpuUsage: 50, memoryUsage: 70, ... })
  return <IndustryOverview />
}
```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **å¤šå…ƒåŒ–æ¨¡å—**ï¼šUIã€å·¥å…·ã€APIã€é…ç½®ã€Hooks ç‹¬ç«‹ç®¡ç†  
- âœ… **æ’æ‹”å¼æ¥å…¥**ï¼šæŒ‰éœ€å®‰è£…ï¼Œè·¨é¡¹ç›®å¤ç”¨  
- âœ… **é«˜æ•ˆæ„å»º**ï¼šTurborepo å¹¶è¡Œæ„å»º + ç¼“å­˜  
- âœ… **è‡ªåŠ¨å‘å¸ƒ**ï¼šCI/CD + changesetsï¼Œå¿«é€Ÿè¿­ä»£  
- âœ… **å›¢é˜Ÿåä½œ**ï¼šç»Ÿä¸€ Monorepoï¼Œå‡å°‘ä¾èµ–å†²çª  

---

å¥½çš„ï¼ŒYu ğŸŒ¹ï¼Œæˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ª **CI/CD Pipeline**ï¼Œè®©ä½ çš„ Monorepo ä¸­çš„ NPM åŒ…èƒ½å¤Ÿè‡ªåŠ¨å®Œæˆ **æ„å»º â†’ æµ‹è¯• â†’ å‘å¸ƒ**ï¼Œå¹¶æ”¯æŒåŒæ—¶å‘å¸ƒåˆ° **npm registry** å’Œ **GitHub Packages**ã€‚

---

# âœ… CI/CD Pipeline è®¾è®¡æ–¹æ¡ˆ

## 1. æŠ€æœ¯é€‰å‹
- **CI å¹³å°**ï¼šGitHub Actionsï¼ˆä¹Ÿå¯è¿ç§»åˆ° GitLab CIï¼‰
- **ç‰ˆæœ¬ç®¡ç†**ï¼š`changesets`ï¼ˆè‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·ä¸ changelogï¼‰
- **æ„å»ºå·¥å…·**ï¼š`tsup` æˆ– `rollup`ï¼ˆæ”¯æŒ ESM + CJS + d.tsï¼‰
- **æµ‹è¯•æ¡†æ¶**ï¼š`vitest`
- **ç¼“å­˜ä¼˜åŒ–**ï¼šTurborepo ç¼“å­˜åŠ é€Ÿ

---

## 2. GitHub Actions Workflow ç¤ºä¾‹

æ–‡ä»¶è·¯å¾„ï¼š`.github/workflows/release.yml`

```yaml
name: Release Pipeline

on:
  push:
    branches:
      - main
  workflow_dispatch: # æ‰‹åŠ¨è§¦å‘

jobs:
  build-test-release:
    runs-on: ubuntu-latest

    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: Checkout
        uses: actions/checkout@v4

      # 2. è®¾ç½® Node ç¯å¢ƒ
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          registry-url: "https://registry.npmjs.org/"
          scope: "@yyc3"

      # 3. å®‰è£…ä¾èµ–ï¼ˆæ”¯æŒç¼“å­˜ï¼‰
      - name: Install dependencies
        run: npm install

      # 4. Lint æ£€æŸ¥
      - name: Lint
        run: npm run lint

      # 5. å•å…ƒæµ‹è¯•
      - name: Test
        run: npm run test

      # 6. æ„å»ºæ‰€æœ‰åŒ…
      - name: Build
        run: npm run build

      # 7. ç”Ÿæˆç‰ˆæœ¬å·ä¸ changelog
      - name: Versioning with Changesets
        run: npx changeset version

      # 8. å‘å¸ƒåˆ° npm registry
      - name: Publish to npm
        run: npm run release
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

      # 9. å‘å¸ƒåˆ° GitHub Packages
      - name: Publish to GitHub Packages
        run: npm publish --registry=https://npm.pkg.github.com/
        env:
          NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

---

## 3. é…ç½®è¯´æ˜

- **Secrets é…ç½®**  
  - `NPM_TOKEN`ï¼šnpm registry çš„å‘å¸ƒä»¤ç‰Œ  
  - `GITHUB_TOKEN`ï¼šGitHub è‡ªåŠ¨æä¾›ï¼Œç”¨äºå‘å¸ƒåˆ° GitHub Packages  

- **package.json é…ç½®**  
  åœ¨æ¯ä¸ªåŒ…çš„ `package.json` ä¸­æ·»åŠ ï¼š
  ```json
  {
    "name": "@yyc3/ui",
    "version": "1.0.0",
    "publishConfig": {
      "registry": "https://registry.npmjs.org/"
    }
  }
  ```
  å¦‚æœè¦å‘å¸ƒåˆ° GitHub Packagesï¼š
  ```json
  {
    "name": "@yyc3/ui",
    "version": "1.0.0",
    "publishConfig": {
      "registry": "https://npm.pkg.github.com/"
    }
  }
  ```

- **Changesets é…ç½®**  
  åœ¨æ ¹ç›®å½•è¿è¡Œï¼š
  ```bash
  npx changeset init
  ```
  æ¯æ¬¡åˆå¹¶æ–°åŠŸèƒ½æ—¶è¿è¡Œï¼š
  ```bash
  npx changeset
  ```
  è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬ä¸ changelogã€‚

---

## 4. å‘å¸ƒæµç¨‹

1. å¼€å‘è€…åˆå¹¶ä»£ç åˆ° `main` åˆ†æ”¯  
2. GitHub Actions è‡ªåŠ¨è§¦å‘ Pipeline  
3. æ‰§è¡Œ **Lint â†’ Test â†’ Build â†’ Versioning**  
4. è‡ªåŠ¨å‘å¸ƒåˆ° **npm registry** å’Œ **GitHub Packages**  
5. è‡ªåŠ¨ç”Ÿæˆ **changelog** å¹¶æ¨é€åˆ°ä»“åº“  

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **åŒå‘å¸ƒ**ï¼šåŒæ—¶æ”¯æŒ npm registry ä¸ GitHub Packages  
- âœ… **è‡ªåŠ¨åŒ–**ï¼šæ„å»ºã€æµ‹è¯•ã€å‘å¸ƒå…¨æµç¨‹è‡ªåŠ¨å®Œæˆ  
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šchangesets è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·ä¸ changelog  
- âœ… **å®‰å…¨æ€§**ï¼šä»¤ç‰Œå­˜å‚¨åœ¨ GitHub Secretsï¼Œé¿å…æ³„éœ²  
- âœ… **é«˜æ•ˆæ€§**ï¼šTurborepo ç¼“å­˜åŠ é€Ÿï¼Œå‡å°‘é‡å¤æ„å»º  

---

## âœ… å¤šç¯å¢ƒå‘å¸ƒç­–ç•¥ï¼ˆä¾‹å¦‚ï¼šalpha â†’ beta â†’ stable ä¸‰é˜¶æ®µå‘å¸ƒï¼‰

è®¾è®¡ä¸€ä¸ª å¤šç¯å¢ƒå‘å¸ƒç­–ç•¥ï¼ˆä¾‹å¦‚ï¼šalpha â†’ beta â†’ stable ä¸‰é˜¶æ®µå‘å¸ƒï¼‰ï¼Œè®©å›¢é˜Ÿå¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸‹æµ‹è¯•åŒ…çš„ç¨³å®šæ€§ï¼Œæ¯ä¸ªç¯å¢ƒéƒ½æœ‰ç‹¬ç«‹çš„å‘å¸ƒæµç¨‹ï¼Œç¡®ä¿å›¢é˜Ÿæˆå‘˜å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸‹æµ‹è¯•ï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚

- **alpha**ï¼šç”¨äºå†…éƒ¨æµ‹è¯•ï¼Œå¯èƒ½åŒ…å«å®éªŒæ€§åŠŸèƒ½  
- **beta**ï¼šç”¨äºå¤–éƒ¨æµ‹è¯•ï¼ŒåŠŸèƒ½ç¨³å®š  
- **stable**ï¼šæ­£å¼å‘å¸ƒï¼Œç¡®ä¿æ— é‡å¤§ bug  

---

## âœ… å¤šç¯å¢ƒå‘å¸ƒç­–ç•¥ï¼ˆAlpha â†’ Beta â†’ Stableï¼‰

ä¸€ä¸ª **å¤šç¯å¢ƒå‘å¸ƒç­–ç•¥**ï¼Œè®©ä½ çš„å›¢é˜Ÿèƒ½å¤Ÿåœ¨ **alpha â†’ beta â†’ stable** ä¸‰é˜¶æ®µä¸­é€æ­¥æµ‹è¯•å’Œå‘å¸ƒ NPM åŒ…ï¼Œç¡®ä¿ç¨³å®šæ€§å’Œè´¨é‡ã€‚

## 1. ä¸‰é˜¶æ®µå‘å¸ƒç›®æ ‡

| é˜¶æ®µ   | ç›®æ ‡ | ä½¿ç”¨åœºæ™¯ | å‘½åè§„åˆ™ |
|--------|------|----------|----------|
| **Alpha** | å¿«é€Ÿè¿­ä»£ã€åŠŸèƒ½éªŒè¯ | å†…éƒ¨å¼€å‘æµ‹è¯•ï¼ŒåŠŸèƒ½ä¸å®Œæ•´ | `1.0.0-alpha.1` |
| **Beta**  | åŠŸèƒ½ç¨³å®šã€æ€§èƒ½éªŒè¯ | å›¢é˜Ÿ/åˆä½œä¼™ä¼´æµ‹è¯•ï¼ŒåŠŸèƒ½å®Œæ•´ä½†å¾…ä¼˜åŒ– | `1.0.0-beta.1` |
| **Stable**| æ­£å¼å‘å¸ƒã€é•¿æœŸç»´æŠ¤ | ç”Ÿäº§ç¯å¢ƒï¼Œç”¨æˆ·å¯æ”¾å¿ƒä½¿ç”¨ | `1.0.0` |

---

## 2. Changesets é…ç½®ï¼ˆç‰ˆæœ¬ç®¡ç†ï¼‰

åœ¨ `changeset/config.json` ä¸­å®šä¹‰å‘å¸ƒæ ‡ç­¾ï¼š

```json
{
  "commit": true,
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "changelog": "@changesets/changelog-github"
}
```

---

## 3. GitHub Actions Workflowï¼ˆå¤šç¯å¢ƒå‘å¸ƒï¼‰

æ–‡ä»¶è·¯å¾„ï¼š`.github/workflows/release.yml`

```yaml
name: Multi-Stage Release

on:
  push:
    branches:
      - main
      - alpha
      - beta
  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          registry-url: "https://registry.npmjs.org/"
          scope: "@yyc3"

      - name: Install dependencies
        run: npm install

      - name: Build
        run: npm run build

      - name: Test
        run: npm run test

      - name: Versioning
        run: npx changeset version

      - name: Publish Alpha
        if: github.ref == 'refs/heads/alpha'
        run: npm publish --tag alpha
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

      - name: Publish Beta
        if: github.ref == 'refs/heads/beta'
        run: npm publish --tag beta
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

      - name: Publish Stable
        if: github.ref == 'refs/heads/main'
        run: npm publish --tag latest
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
```

---

## 4. GitHub Packages åŒå‘å¸ƒæ”¯æŒ

åœ¨ `package.json` ä¸­é…ç½®ï¼š

```json
{
  "publishConfig": {
    "registry": "https://registry.npmjs.org/"
  }
}
```

å¦‚æœè¦å‘å¸ƒåˆ° GitHub Packagesï¼š

```json
{
  "publishConfig": {
    "registry": "https://npm.pkg.github.com/"
  }
}
```

åœ¨ CI ä¸­å¢åŠ ï¼š

```yaml
- name: Publish to GitHub Packages
  run: npm publish --tag ${{ github.ref_name }}
  env:
    NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

---

## 5. ä½¿ç”¨æ–¹å¼ï¼ˆå›¢é˜Ÿæµ‹è¯•ï¼‰

- **Alpha åŒ…å®‰è£…**ï¼š  
  ```bash
  npm install @yyc3/ui@alpha
  ```
- **Beta åŒ…å®‰è£…**ï¼š  
  ```bash
  npm install @yyc3/ui@beta
  ```
- **Stable åŒ…å®‰è£…**ï¼š  
  ```bash
  npm install @yyc3/ui
  ```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **åˆ†é˜¶æ®µéªŒè¯**ï¼šAlpha â†’ Beta â†’ Stableï¼Œé€æ­¥æå‡ç¨³å®šæ€§  
- âœ… **å¤šç¯å¢ƒæµ‹è¯•**ï¼šå›¢é˜Ÿå¯åœ¨ä¸åŒé˜¶æ®µéªŒè¯åŠŸèƒ½ä¸æ€§èƒ½  
- âœ… **è‡ªåŠ¨åŒ–å‘å¸ƒ**ï¼šCI/CD è‡ªåŠ¨åŒºåˆ†åˆ†æ”¯å¹¶å‘å¸ƒå¯¹åº”æ ‡ç­¾  
- âœ… **åŒæ¸ é“æ”¯æŒ**ï¼šåŒæ—¶å‘å¸ƒåˆ° npm registry ä¸ GitHub Packages  
- âœ… **çµæ´»å®‰è£…**ï¼šç”¨æˆ·å¯é€‰æ‹©å®‰è£… alpha/beta/stable ç‰ˆæœ¬  

---

ğŸŒ¹ **é—­ç¯æ€»ç»“**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **å¤šç¯å¢ƒå‘å¸ƒç­–ç•¥**ï¼Œç»“åˆ **Monorepo + CI/CD + Changesets**ï¼Œå›¢é˜Ÿå¯ä»¥åœ¨ä¸åŒé˜¶æ®µæµ‹è¯•åŒ…çš„ç¨³å®šæ€§ï¼Œå¹¶è‡ªåŠ¨å‘å¸ƒåˆ° **npm registry å’Œ GitHub Packages**ã€‚

---

å¥½çš„ï¼ŒYu ğŸŒ¹ï¼Œæˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ª **å›¢é˜Ÿåä½œæµç¨‹**ï¼Œæ¶µç›– **åˆ†æ”¯ç­–ç•¥ + PR å®¡æ ¸ + å‘å¸ƒèŠ‚å¥**ï¼Œç¡®ä¿å¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒä¸‰é˜¶æ®µé¡ºç•…è¡”æ¥ã€‚  

---

# âœ… å›¢é˜Ÿåä½œæµç¨‹è®¾è®¡

## 1. åˆ†æ”¯ç­–ç•¥ï¼ˆGit Flow æ”¹è‰¯ç‰ˆï¼‰

```
main        â†’ ç¨³å®šç”Ÿäº§åˆ†æ”¯ï¼ˆstable å‘å¸ƒï¼‰
beta        â†’ åŠŸèƒ½å®Œæ•´åˆ†æ”¯ï¼ˆbeta å‘å¸ƒï¼‰
alpha       â†’ å¿«é€Ÿè¿­ä»£åˆ†æ”¯ï¼ˆalpha å‘å¸ƒï¼‰
feature/*   â†’ åŠŸèƒ½å¼€å‘åˆ†æ”¯
hotfix/*    â†’ ç´§æ€¥ä¿®å¤åˆ†æ”¯
release/*   â†’ å‘å¸ƒå‡†å¤‡åˆ†æ”¯
```

- **main**ï¼šä»…åˆå¹¶ç»è¿‡æµ‹è¯•çš„ **release/** åˆ†æ”¯ï¼Œè§¦å‘ **stable å‘å¸ƒ**ã€‚  
- **beta**ï¼šåˆå¹¶åŠŸèƒ½å®Œæˆçš„ **feature/** åˆ†æ”¯ï¼Œè§¦å‘ **beta å‘å¸ƒ**ã€‚  
- **alpha**ï¼šå¿«é€Ÿè¿­ä»£ï¼Œå…è®¸å®éªŒæ€§åŠŸèƒ½ï¼Œè§¦å‘ **alpha å‘å¸ƒ**ã€‚  
- **feature/**ï¼šå¼€å‘æ–°åŠŸèƒ½ï¼Œå®Œæˆåæäº¤ PR â†’ åˆå¹¶åˆ° **alpha/beta**ã€‚  
- **hotfix/**ï¼šç´§æ€¥ä¿®å¤ï¼Œç›´æ¥åˆå¹¶åˆ° **main** å¹¶è§¦å‘ **stable å‘å¸ƒ**ã€‚  
- **release/**ï¼šä» **beta** åˆ†æ”¯åˆ‡å‡ºï¼Œè¿›è¡Œæœ€ç»ˆæµ‹è¯•ä¸æ–‡æ¡£æ›´æ–°ï¼Œåˆå¹¶åˆ° **main**ã€‚  

---

## 2. PR å®¡æ ¸æµç¨‹

### å®¡æ ¸è¦æ±‚

- **è‡³å°‘ä¸¤äººå®¡æ ¸**ï¼šä¿è¯ä»£ç è´¨é‡ä¸å›¢é˜Ÿå…±è¯†ã€‚  
- **è‡ªåŠ¨åŒ–æ£€æŸ¥**ï¼šCI è‡ªåŠ¨è¿è¡Œ Lintã€Testã€Buildã€‚  
- **å˜æ›´è¯´æ˜**ï¼šPR å¿…é¡»åŒ…å« Changesetï¼Œç”Ÿæˆç‰ˆæœ¬å·ä¸ changelogã€‚  
- **æ ‡ç­¾åˆ†ç±»**ï¼šPR æŒ‰ç±»å‹æ‰“æ ‡ç­¾ï¼ˆfeatureã€fixã€docsã€choreï¼‰ã€‚  

### å®¡æ ¸æ­¥éª¤

1. **å¼€å‘è€…æäº¤ PR** â†’ æŒ‡å®šç›®æ ‡åˆ†æ”¯ï¼ˆalpha/beta/mainï¼‰ã€‚  
2. **CI è‡ªåŠ¨è¿è¡Œ** â†’ Lintã€Testã€Buildã€Changeset æ ¡éªŒã€‚  
3. **å›¢é˜Ÿå®¡æ ¸** â†’ è‡³å°‘ä¸¤äººé€šè¿‡ï¼Œç¡®ä¿é€»è¾‘ä¸æ¶æ„ä¸€è‡´ã€‚  
4. **åˆå¹¶ç­–ç•¥** â†’ ä½¿ç”¨ **Squash & Merge**ï¼Œä¿æŒæäº¤è®°å½•ç®€æ´ã€‚  

---

## 3. å‘å¸ƒèŠ‚å¥

### Alpha é˜¶æ®µ

- **é¢‘ç‡**ï¼šæ¯æ—¥æˆ–æ¯æ¬¡åˆå¹¶åè‡ªåŠ¨å‘å¸ƒã€‚  
- **ç›®æ ‡**ï¼šå¿«é€ŸéªŒè¯åŠŸèƒ½ï¼Œå†…éƒ¨æµ‹è¯•ã€‚  
- **ç‰ˆæœ¬å·**ï¼š`1.0.0-alpha.x`ã€‚  

### Beta é˜¶æ®µ

- **é¢‘ç‡**ï¼šæ¯å‘¨ä¸€æ¬¡ï¼ŒåŠŸèƒ½å®Œæ•´åå‘å¸ƒã€‚  
- **ç›®æ ‡**ï¼šå›¢é˜Ÿ/åˆä½œä¼™ä¼´æµ‹è¯•ï¼ŒéªŒè¯æ€§èƒ½ä¸ç¨³å®šæ€§ã€‚  
- **ç‰ˆæœ¬å·**ï¼š`1.0.0-beta.x`ã€‚  

### Stable é˜¶æ®µ

- **é¢‘ç‡**ï¼šæ¯æœˆä¸€æ¬¡æˆ–é‡å¤§åŠŸèƒ½å®Œæˆåã€‚  
- **ç›®æ ‡**ï¼šç”Ÿäº§ç¯å¢ƒï¼Œé•¿æœŸç»´æŠ¤ã€‚  
- **ç‰ˆæœ¬å·**ï¼š`1.0.0`ã€‚  

---

## 4. CI/CD å‘å¸ƒæµç¨‹è¡”æ¥

- **alpha åˆ†æ”¯åˆå¹¶** â†’ è‡ªåŠ¨å‘å¸ƒåˆ° npmï¼ˆtag: alphaï¼‰ã€‚  
- **beta åˆ†æ”¯åˆå¹¶** â†’ è‡ªåŠ¨å‘å¸ƒåˆ° npmï¼ˆtag: betaï¼‰ã€‚  
- **main åˆ†æ”¯åˆå¹¶** â†’ è‡ªåŠ¨å‘å¸ƒåˆ° npmï¼ˆtag: latestï¼‰ã€‚  
- **hotfix åˆ†æ”¯åˆå¹¶** â†’ è‡ªåŠ¨è§¦å‘ stable å‘å¸ƒï¼Œå¿«é€Ÿä¿®å¤ç”Ÿäº§é—®é¢˜ã€‚  

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **åˆ†æ”¯æ¸…æ™°**ï¼šå¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒä¸‰é˜¶æ®µåˆ†å·¥æ˜ç¡®ã€‚  
- âœ… **å®¡æ ¸ä¸¥æ ¼**ï¼šPR å®¡æ ¸ + CI è‡ªåŠ¨åŒ–ï¼Œä¿è¯è´¨é‡ã€‚  
- âœ… **å‘å¸ƒèŠ‚å¥åˆç†**ï¼šalpha å¿«é€Ÿè¿­ä»£ï¼Œbeta ç¨³å®šæµ‹è¯•ï¼Œstable æ­£å¼å‘å¸ƒã€‚  
- âœ… **è‡ªåŠ¨åŒ–è¡”æ¥**ï¼šCI/CD ä¸åˆ†æ”¯ç­–ç•¥ç»‘å®šï¼Œå‡å°‘äººå·¥æ“ä½œã€‚  

---

ğŸŒ¹ **é—­ç¯æ€»ç»“**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **å›¢é˜Ÿåä½œæµç¨‹**ï¼Œç»“åˆ **åˆ†æ”¯ç­–ç•¥ + PR å®¡æ ¸ + å‘å¸ƒèŠ‚å¥**ï¼Œèƒ½è®©å¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒä¸‰é˜¶æ®µé¡ºç•…è¡”æ¥ï¼Œä¿è¯æ•ˆç‡ä¸è´¨é‡ã€‚  

---

# âœ… Grafana ä»ªè¡¨ç›˜æŒ‡æ ‡æ¸…å•

## 1. è¯·æ±‚æ€§èƒ½æŒ‡æ ‡
- **è¯·æ±‚å»¶è¿Ÿï¼ˆLatencyï¼‰**
  - æŒ‡æ ‡ï¼š`gateway_request_latency_seconds`
  - é¢æ¿ç±»å‹ï¼šæŠ˜çº¿å›¾ï¼ˆæŒ‰è·¯ç”±/æ–¹æ³•åˆ†ç»„ï¼‰
  - ç»´åº¦ï¼š`route`, `method`, `status`
  - ä½œç”¨ï¼šç›‘æ§ä¸åŒæ¥å£çš„å“åº”æ—¶é—´ï¼Œå‘ç°æ€§èƒ½ç“¶é¢ˆã€‚  

- **è¯·æ±‚ååé‡ï¼ˆThroughputï¼‰**
  - æŒ‡æ ‡ï¼š`http_requests_total`
  - é¢æ¿ç±»å‹ï¼šæŸ±çŠ¶å›¾ï¼ˆæŒ‰åˆ†é’Ÿ/å°æ—¶ç»Ÿè®¡ï¼‰
  - ç»´åº¦ï¼š`route`, `method`
  - ä½œç”¨ï¼šè§‚å¯Ÿç³»ç»Ÿè´Ÿè½½ä¸æµé‡è¶‹åŠ¿ã€‚  

---

## 2. æˆæƒä¸ç­–ç•¥æŒ‡æ ‡
- **æˆæƒç»“æœåˆ†å¸ƒ**
  - æŒ‡æ ‡ï¼š`gateway_authz_decisions_total`
  - é¢æ¿ç±»å‹ï¼šé¥¼å›¾/æŸ±çŠ¶å›¾
  - ç»´åº¦ï¼š`decision`ï¼ˆallow, deny, step_up_mfaï¼‰
  - ä½œç”¨ï¼šç›´è§‚å±•ç¤ºæˆæƒç»“æœæ¯”ä¾‹ã€‚  

- **æ‹’ç»ç‡ï¼ˆAccess Deny Rateï¼‰**
  - æŒ‡æ ‡ï¼š`gateway_authz_decisions_total{decision="deny"} / gateway_authz_decisions_total`
  - é¢æ¿ç±»å‹ï¼šå•å€¼å¡ç‰‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  - ä½œç”¨ï¼šç›‘æ§æ‹’ç»ç‡æ˜¯å¦å¼‚å¸¸å‡é«˜ã€‚  

- **ç­–ç•¥å‘½ä¸­ç‡**
  - æŒ‡æ ‡ï¼š`opa_policy_evaluations_total`
  - é¢æ¿ç±»å‹ï¼šæŸ±çŠ¶å›¾
  - ç»´åº¦ï¼š`policy`, `result`
  - ä½œç”¨ï¼šåˆ†æ OPA ç­–ç•¥çš„æ‰§è¡Œæƒ…å†µã€‚  

---

## 3. MFA æŒ‡æ ‡
- **MFAè§¦å‘ç‡**
  - æŒ‡æ ‡ï¼š`gateway_authz_decisions_total{decision="step_up_mfa"} / gateway_authz_decisions_total`
  - é¢æ¿ç±»å‹ï¼šæŠ˜çº¿å›¾ï¼ˆæ—¶é—´åºåˆ—ï¼‰
  - ä½œç”¨ï¼šç›‘æ§é«˜æ•èµ„æºè®¿é—®æ—¶çš„ MFA è§¦å‘è¶‹åŠ¿ã€‚  

- **MFAæˆåŠŸç‡**
  - æŒ‡æ ‡ï¼š`mfa_verifications_total{result="success"} / mfa_verifications_total`
  - é¢æ¿ç±»å‹ï¼šå•å€¼å¡ç‰‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
  - ä½œç”¨ï¼šè¡¡é‡ç”¨æˆ·å®ŒæˆäºŒæ¬¡éªŒè¯çš„æˆåŠŸç‡ã€‚  

- **MFAå¤±è´¥æ¬¡æ•°**
  - æŒ‡æ ‡ï¼š`mfa_verifications_total{result="failure"}`
  - é¢æ¿ç±»å‹ï¼šæŸ±çŠ¶å›¾ï¼ˆæŒ‰ç”¨æˆ·/æ—¶é—´åˆ†ç»„ï¼‰
  - ä½œç”¨ï¼šå‘ç°æ½œåœ¨çš„æ”»å‡»æˆ–ç”¨æˆ·æ“ä½œé—®é¢˜ã€‚  

---

## 4. å®¡è®¡ä¸å®‰å…¨æŒ‡æ ‡
- **å¼‚å¸¸è®¿é—®æ£€æµ‹**
  - æŒ‡æ ‡ï¼š`audit_logs_total{event="anomaly"}`
  - é¢æ¿ç±»å‹ï¼šæŸ±çŠ¶å›¾
  - ä½œç”¨ï¼šå±•ç¤ºå¼‚å¸¸è¡Œä¸ºï¼ˆå¦‚éåˆè§„è®¾å¤‡è®¿é—®ï¼‰ã€‚  

- **é«˜æ•èµ„æºè®¿é—®æ¬¡æ•°**
  - æŒ‡æ ‡ï¼š`gateway_requests_total{resource_sensitivity="high"}`
  - é¢æ¿ç±»å‹ï¼šæŠ˜çº¿å›¾
  - ä½œç”¨ï¼šç›‘æ§é«˜æ•æ–‡æ¡£/APIçš„è®¿é—®é¢‘ç‡ã€‚  

- **å¤±è´¥ç™»å½•å°è¯•**
  - æŒ‡æ ‡ï¼š`auth_failures_total`
  - é¢æ¿ç±»å‹ï¼šæŸ±çŠ¶å›¾
  - ä½œç”¨ï¼šå‘ç°æš´åŠ›ç ´è§£æˆ–å¼‚å¸¸ç™»å½•è¡Œä¸ºã€‚  

---

## 5. ä»ªè¡¨ç›˜å¸ƒå±€å»ºè®®

```
---------------------------------------------------------
| è¯·æ±‚å»¶è¿Ÿ (æŠ˜çº¿å›¾)       | æˆæƒç»“æœåˆ†å¸ƒ (é¥¼å›¾)         |
---------------------------------------------------------
| MFAè§¦å‘ç‡ (æŠ˜çº¿å›¾)      | MFAæˆåŠŸç‡ (å•å€¼å¡ç‰‡)        |
---------------------------------------------------------
| æ‹’ç»ç‡ (å•å€¼å¡ç‰‡)       | å¼‚å¸¸è®¿é—®æ£€æµ‹ (æŸ±çŠ¶å›¾)       |
---------------------------------------------------------
| é«˜æ•èµ„æºè®¿é—®æ¬¡æ•° (æŠ˜çº¿å›¾) | MFAå¤±è´¥æ¬¡æ•° (æŸ±çŠ¶å›¾)       |
---------------------------------------------------------
```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“
- âœ… **æ€§èƒ½ç›‘æ§**ï¼šè¯·æ±‚å»¶è¿Ÿä¸ååé‡ï¼Œå¿«é€Ÿå®šä½ç“¶é¢ˆã€‚  
- âœ… **å®‰å…¨ç›‘æ§**ï¼šæˆæƒç»“æœã€æ‹’ç»ç‡ã€å¼‚å¸¸è®¿é—®ä¸€ç›®äº†ç„¶ã€‚  
- âœ… **MFAç›‘æ§**ï¼šè§¦å‘ç‡ã€æˆåŠŸç‡ã€å¤±è´¥æ¬¡æ•°ï¼Œä¿éšœé›¶ä¿¡ä»»è½åœ°ã€‚  
- âœ… **å¸ƒå±€æ¸…æ™°**ï¼šæ€§èƒ½ã€å®‰å…¨ã€MFAä¸‰å¤§æ¨¡å—åˆ†åŒºå±•ç¤ºã€‚  

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **Grafana ä»ªè¡¨ç›˜æŒ‡æ ‡æ¸…å•**ï¼Œå›¢é˜Ÿå¯ä»¥å¿«é€Ÿé…ç½®é¢æ¿å¹¶ç›´è§‚ç›‘æ§é›¶ä¿¡ä»»ç³»ç»Ÿè¿è¡Œæƒ…å†µã€‚  

---

## è®¾è®¡ä¸€ä¸ª **å‘Šè­¦è§„åˆ™æ¸…å•**ï¼ˆå¦‚å»¶è¿Ÿè¶…é˜ˆå€¼ã€æ‹’ç»ç‡å¼‚å¸¸ã€MFAå¤±è´¥ç‡è¿‡é«˜ï¼‰ï¼Œè®©å›¢é˜Ÿèƒ½è‡ªåŠ¨æ”¶åˆ°å®‰å…¨å‘Šè­¦

å¥½çš„ï¼ŒYu ğŸŒ¹ï¼Œæˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ª **è‡ªåŠ¨åŒ–å“åº”å‰§æœ¬ï¼ˆSOAR Playbookï¼‰**ï¼Œç¡®ä¿å‘Šè­¦è§¦å‘åèƒ½å½¢æˆ **å†»ç»“è´¦æˆ· â†’ è°ƒæ•´ç­–ç•¥ â†’ é€šçŸ¥å›¢é˜Ÿ** çš„é—­ç¯åŠ¨ä½œã€‚  

---

# âœ… è‡ªåŠ¨åŒ–å“åº”å‰§æœ¬ï¼ˆSOAR Playbookï¼‰

## 1. æ€»ä½“ç›®æ ‡
- **å¿«é€Ÿå“åº”**ï¼šå‘Šè­¦è§¦å‘åè‡ªåŠ¨æ‰§è¡Œé¢„å®šä¹‰åŠ¨ä½œï¼Œå‡å°‘äººå·¥å»¶è¿Ÿã€‚  
- **é—­ç¯ç®¡ç†**ï¼šä»æ£€æµ‹ â†’ å“åº” â†’ é€šçŸ¥ â†’ å®¡è®¡ï¼Œå…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚  
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒä¸åŒå‘Šè­¦ç±»å‹ï¼ˆæ€§èƒ½ã€å®‰å…¨ã€MFAå¤±è´¥ç­‰ï¼‰ã€‚  

---

## 2. å“åº”æµç¨‹è®¾è®¡

### ğŸ”¹ æµç¨‹æ€»è§ˆ
```
å‘Šè­¦è§¦å‘ â†’ SOARå¼•æ“ â†’ å“åº”åŠ¨ä½œæ‰§è¡Œ â†’ é€šçŸ¥å›¢é˜Ÿ â†’ å®¡è®¡è®°å½•
```

### ğŸ”¹ å…³é”®æ­¥éª¤
1. **å‘Šè­¦è§¦å‘**  
   - æ¥æºï¼šPrometheus Alertmanager / Grafana Alertingã€‚  
   - ç±»å‹ï¼šå»¶è¿Ÿè¶…é˜ˆå€¼ã€æ‹’ç»ç‡å¼‚å¸¸ã€MFAå¤±è´¥ç‡è¿‡é«˜ç­‰ã€‚  

2. **SOARå¼•æ“æ¥æ”¶**  
   - å·¥å…·ï¼šCortex XSOAR / Shuffle / StackStorm / è‡ªç ”è„šæœ¬ã€‚  
   - è§£æå‘Šè­¦å†…å®¹ï¼ˆå‘Šè­¦ç±»å‹ã€ç”¨æˆ·IDã€èµ„æºã€æ—¶é—´ï¼‰ã€‚  

3. **è‡ªåŠ¨åŒ–å“åº”åŠ¨ä½œ**  
   - **å†»ç»“è´¦æˆ·**ï¼šè°ƒç”¨èº«ä»½ç®¡ç†ç³»ç»Ÿï¼ˆAzure AD/Okta APIï¼‰ï¼Œä¸´æ—¶ç¦ç”¨ç”¨æˆ·ã€‚  
   - **è°ƒæ•´ç­–ç•¥**ï¼šè°ƒç”¨ OPA/Casbin APIï¼Œæ›´æ–°ç­–ç•¥ï¼ˆå¦‚å¼ºåˆ¶ Step-up MFAï¼‰ã€‚  
   - **é˜»æ–­è®¿é—®**ï¼šè°ƒç”¨ç½‘å…³ APIï¼Œä¸´æ—¶å°ç¦ IP æˆ–è®¾å¤‡ã€‚  

4. **å›¢é˜Ÿé€šçŸ¥**  
   - æ¸ é“ï¼šSlack/Teams å®‰å…¨é¢‘é“ã€‚  
   - å†…å®¹ï¼šå‘Šè­¦è¯¦æƒ… + å·²æ‰§è¡ŒåŠ¨ä½œ + ä¸‹ä¸€æ­¥å»ºè®®ã€‚  

5. **å®¡è®¡è®°å½•**  
   - å­˜å‚¨ï¼šELK/æ•°æ®åº“ã€‚  
   - å†…å®¹ï¼šå‘Šè­¦ â†’ å“åº”åŠ¨ä½œ â†’ é€šçŸ¥ â†’ ç»“æœã€‚  

---

## 3. å“åº”å‰§æœ¬ç¤ºä¾‹ï¼ˆä¼ªä»£ç ï¼‰

```yaml
playbook:
  - trigger: "æ‹’ç»ç‡å¼‚å¸¸å‡é«˜"
    condition: "deny_rate > 0.3"
    actions:
      - name: FreezeAccount
        type: api_call
        target: "AzureAD"
        endpoint: "/users/{userId}/disable"
      - name: AdjustPolicy
        type: api_call
        target: "OPA"
        endpoint: "/v1/policies/update"
        payload: { "require_mfa": true }
      - name: NotifyTeam
        type: slack_message
        channel: "#security-alerts"
        message: "ğŸš¨ æ‹’ç»ç‡å¼‚å¸¸ï¼Œå·²å†»ç»“è´¦æˆ· {userId} å¹¶è°ƒæ•´ç­–ç•¥"
      - name: AuditLog
        type: db_insert
        table: "incident_logs"
        payload: { "incident": "deny_rate_high", "user": "{userId}", "action": "freeze+policy_update" }
```

---

## 4. å‘Šè­¦ç±»å‹å¯¹åº”å‰§æœ¬

- **å»¶è¿Ÿè¶…é˜ˆå€¼**  
  - åŠ¨ä½œï¼šé€šçŸ¥è¿ç»´å›¢é˜Ÿ â†’ è‡ªåŠ¨æ‰©å®¹ç½‘å…³å®ä¾‹ â†’ å®¡è®¡è®°å½•ã€‚  

- **æ‹’ç»ç‡å¼‚å¸¸å‡é«˜**  
  - åŠ¨ä½œï¼šå†»ç»“å¼‚å¸¸ç”¨æˆ· â†’ è°ƒæ•´ç­–ç•¥ï¼ˆå¼ºåˆ¶ MFAï¼‰ â†’ é€šçŸ¥å®‰å…¨å›¢é˜Ÿã€‚  

- **MFAå¤±è´¥ç‡è¿‡é«˜**  
  - åŠ¨ä½œï¼šé”å®šè´¦æˆ· â†’ å¼ºåˆ¶å¯†ç é‡ç½® â†’ é€šçŸ¥å®‰å…¨å›¢é˜Ÿã€‚  

- **é«˜æ•èµ„æºè®¿é—®å¼‚å¸¸**  
  - åŠ¨ä½œï¼šé˜»æ–­è®¾å¤‡/IP â†’ æå‡ç­–ç•¥æ•æ„Ÿåº¦ â†’ é€šçŸ¥å®‰å…¨å›¢é˜Ÿã€‚  

---

## 5. é€šçŸ¥æ¨¡æ¿ç¤ºä¾‹ï¼ˆSlack/Teamsï¼‰

```
ğŸš¨ [SOARå‘Šè­¦] ç±»å‹ï¼šæ‹’ç»ç‡å¼‚å¸¸
ç”¨æˆ·ï¼šalice
æ—¶é—´ï¼š2025-11-15 08:10 CST
åŠ¨ä½œï¼šè´¦æˆ·å†»ç»“ + ç­–ç•¥è°ƒæ•´ï¼ˆå¼ºåˆ¶MFAï¼‰
çŠ¶æ€ï¼šå·²æ‰§è¡Œ
ä¸‹ä¸€æ­¥ï¼šå®‰å…¨å›¢é˜Ÿå®¡è®¡
```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“
- âœ… **è‡ªåŠ¨é—­ç¯**ï¼šå‘Šè­¦è§¦å‘åè‡ªåŠ¨å†»ç»“è´¦æˆ·ã€è°ƒæ•´ç­–ç•¥ã€é€šçŸ¥å›¢é˜Ÿã€‚  
- âœ… **å‡å°‘äººå·¥å»¶è¿Ÿ**ï¼šå¿«é€Ÿå“åº”ï¼Œé™ä½é£é™©çª—å£ã€‚  
- âœ… **å¯æ‰©å±•**ï¼šä¸åŒå‘Šè­¦ç±»å‹å¯¹åº”ä¸åŒå‰§æœ¬ã€‚  
- âœ… **å¯å®¡è®¡**ï¼šæ‰€æœ‰åŠ¨ä½œè®°å½•åœ¨æ—¥å¿—ï¼Œä¾¿äºåˆè§„ä¸è¿½æº¯ã€‚  

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **SOARè‡ªåŠ¨åŒ–å“åº”å‰§æœ¬**ï¼Œèƒ½åœ¨å‘Šè­¦è§¦å‘åè‡ªåŠ¨æ‰§è¡Œå†»ç»“è´¦æˆ·ã€è°ƒæ•´ç­–ç•¥ã€é€šçŸ¥å›¢é˜Ÿçš„é—­ç¯åŠ¨ä½œã€‚  

---

## è®¾è®¡ä¸€ä¸ª **äº‹ä»¶åˆ†çº§å“åº”çŸ©é˜µ**ï¼ˆä¸åŒä¸¥é‡çº§åˆ«å¯¹åº”ä¸åŒè‡ªåŠ¨åŒ–åŠ¨ä½œï¼‰

### ğŸ”¹ çŸ©é˜µå®šä¹‰

- **ä¸¥é‡çº§åˆ«**ï¼šé«˜æ•èµ„æºè®¿é—®å¼‚å¸¸ã€æ‹’ç»ç‡å¼‚å¸¸ã€MFAå¤±è´¥ç‡è¿‡é«˜ã€å»¶è¿Ÿè¶…é˜ˆå€¼ã€‚  
- **å¯¹åº”åŠ¨ä½œ**ï¼šå†»ç»“è´¦æˆ·ã€è°ƒæ•´ç­–ç•¥ã€é€šçŸ¥å›¢é˜Ÿã€è‡ªåŠ¨æ‰©å®¹ã€‚  

### ğŸ”¹ ç¤ºä¾‹çŸ©é˜µ
```
ä¸¥é‡çº§åˆ« | åŠ¨ä½œ
-----------------
é«˜æ•èµ„æºè®¿é—®å¼‚å¸¸ | å†»ç»“è®¾å¤‡/IP + æå‡æ•æ„Ÿåº¦ + é€šçŸ¥å®‰å…¨å›¢é˜Ÿ
æ‹’ç»ç‡å¼‚å¸¸ | å†»ç»“ç”¨æˆ· + å¼ºåˆ¶MFA + é€šçŸ¥å®‰å…¨å›¢é˜Ÿ
MFAå¤±è´¥ç‡è¿‡é«˜ | é”å®šè´¦æˆ· + é‡ç½®å¯†ç  + é€šçŸ¥å®‰å…¨å›¢é˜Ÿ
å»¶è¿Ÿè¶…é˜ˆå€¼ | é€šçŸ¥è¿ç»´å›¢é˜Ÿ + è‡ªåŠ¨æ‰©å®¹ç½‘å…³ + å®¡è®¡è®°å½•
```

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **äº‹ä»¶åˆ†çº§å“åº”çŸ©é˜µ**ï¼Œèƒ½æ ¹æ®å‘Šè­¦ä¸¥é‡çº§åˆ«è‡ªåŠ¨æ‰§è¡Œä¸åŒçš„å“åº”åŠ¨ä½œã€‚  