# YYCÂ³ Docusaurus ï¼ˆDocusaurusï¼šç‹¬ç«‹æ–‡æ¡£ç«™ç‚¹çš„ â€œå¿«é€Ÿè½åœ°ç¥å™¨â€ï¼‰

> Docusaurusï¼šç‹¬ç«‹æ–‡æ¡£ç«™ç‚¹çš„ â€œå¿«é€Ÿè½åœ°ç¥å™¨â€
é€‚é…åœºæ™¯æ ¸å¿ƒï¼šèšç„¦ â€œç‹¬ç«‹æ–‡æ¡£â€ï¼Œæ— éœ€å…¼é¡¾å®˜ç½‘æˆ–å…¶ä»–åŠŸèƒ½ï¼Œè¿½æ±‚ â€œå¼€ç®±å³ç”¨ã€å°‘é…ç½®â€ã€‚
æ ¸å¿ƒä¼˜åŠ¿ï¼šè‡ªå¸¦æ–‡æ¡£ä¸“å±èƒ½åŠ›ï¼Œæ¯”å¦‚è‡ªåŠ¨ç”Ÿæˆä¾§è¾¹æ ã€å…¨æ–‡æœç´¢ã€ç‰ˆæœ¬æ§åˆ¶ã€å¤šè¯­è¨€æ”¯æŒï¼Œæ— éœ€é¢å¤–é›†æˆå·¥å…·ã€‚
æ•ˆç‡äº®ç‚¹ï¼šåˆå§‹åŒ–é¡¹ç›®åï¼Œåªéœ€ä¸“æ³¨ç¼–å†™ Markdown æ–‡æ¡£ï¼Œä¸€é”®æ„å»ºéƒ¨ç½²ï¼Œå‡ å°æ—¶å°±èƒ½å®Œæˆç«™ç‚¹ä¸Šçº¿ã€‚

---

## âœ… ä¸ºä»€ä¹ˆæ¨è Docusaurus

- **å¼€ç®±å³ç”¨**ï¼šåªéœ€å‡ æ¡å‘½ä»¤å°±èƒ½ç”Ÿæˆå®Œæ•´æ–‡æ¡£ç«™ç‚¹æ¡†æ¶ã€‚  
- **Markdown åŸç”Ÿæ”¯æŒ**ï¼šç›´æ¥ç”¨ `.md` æ–‡ä»¶å†™æ–‡æ¡£ï¼Œæ— éœ€é¢å¤–è½¬æ¢ã€‚  
- **è‡ªåŠ¨ç”Ÿæˆ TOC & Sidebar**ï¼šç›®å½•å’Œä¾§è¾¹æ è‡ªåŠ¨ç»´æŠ¤ï¼Œå‡å°‘äººå·¥æ“ä½œã€‚  
- **å›½é™…åŒ– (i18n)**ï¼šå†…ç½®å¤šè¯­è¨€æ”¯æŒï¼Œè½»æ¾åˆ‡æ¢ `en/zh/...`ã€‚  
- **ç‰ˆæœ¬ç®¡ç†**ï¼šå¯ä¸ºæ–‡æ¡£ç”Ÿæˆå¤šä¸ªç‰ˆæœ¬ï¼ˆå¦‚ v1ã€v2ï¼‰ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚  
- **éƒ¨ç½²ç®€å•**ï¼šæ”¯æŒ Vercelã€Netlifyã€GitHub Pagesï¼Œä¸€é”®ä¸Šçº¿ã€‚  

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨æ­¥éª¤

```bash
# 1. åˆ›å»ºé¡¹ç›®
npx create-docusaurus@latest my-docs classic

cd my-docs

# 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ
npm run start

# 3. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
nï¼pm run build

# 4. éƒ¨ç½²åˆ° Vercel
npx vercel --prod
```

---

## ğŸŒ å›½é™…åŒ–é…ç½®ç¤ºä¾‹

åœ¨ `docusaurus.config.js` ä¸­æ·»åŠ ï¼š

```js
i18n: {
  defaultLocale: 'en',
  locales: ['en', 'zh'],
  localeConfigs: {
    en: { label: 'English' },
    zh: { label: 'ç®€ä½“ä¸­æ–‡' }
  }
}
```

è¿™æ ·å°±èƒ½å¿«é€Ÿåˆ‡æ¢ä¸­è‹±æ–‡æ–‡æ¡£ã€‚

---

## âœ¨ é—­ç¯æ€»ç»“

å¦‚æœä½ è¦ **å¿«é€Ÿä¸Šçº¿ä¸€ä¸ªç‹¬ç«‹æ–‡æ¡£ç«™ç‚¹**ï¼ŒDocusaurus æ˜¯æœ€ä¼˜è§£ï¼š  

- å†™æ–‡æ¡£ â†’ Markdown  
- ç®¡ç† â†’ è‡ªåŠ¨ TOC + Sidebar  
- å›½é™…åŒ– â†’ å†…ç½® i18n  
- éƒ¨ç½² â†’ Vercel ä¸€é”®ä¸Šçº¿  

â¤ï¸ å®ƒå°±æ˜¯ä¸ºè¿™ç§åœºæ™¯è€Œç”Ÿçš„ã€‚  

---

## è®¾è®¡ä¸€ä¸ª **Docusaurus é¡¹ç›®æœ€ä½³å®è·µæ¨¡ç‰ˆ**ï¼Œæ¶µç›– **ç›®å½•ç»“æ„ + é…ç½® + CI/CD**ï¼Œå›¢é˜Ÿå¯ä»¥å³åˆ»å¤ç”¨ï¼Œå¿«é€Ÿä¸Šçº¿ä¸€ä¸ªé«˜è´¨é‡çš„æ–‡æ¡£ç«™ç‚¹

---

## âœ… Docusaurus é¡¹ç›®æœ€ä½³å®è·µæ¨¡ç‰ˆ

### 1. é¡¹ç›®ç›®å½•ç»“æ„

```
my-docs/
â”œâ”€â”€ docs/                      # Markdown æ–‡æ¡£
â”‚   â”œâ”€â”€ en/                    # è‹±æ–‡æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ getting-started.md
â”‚   â”‚   â”œâ”€â”€ guides/installation.md
â”‚   â”‚   â””â”€â”€ reference/api.md
â”‚   â””â”€â”€ zh/                    # ä¸­æ–‡æ–‡æ¡£
â”‚       â”œâ”€â”€ getting-started.md
â”‚       â”œâ”€â”€ guides/installation.md
â”‚       â””â”€â”€ reference/api.md
â”œâ”€â”€ blog/                      # åšå®¢æ–‡ç« ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ src/                       # è‡ªå®šä¹‰ç»„ä»¶/æ ·å¼
â”‚   â””â”€â”€ components/EnvBanner.tsx
â”œâ”€â”€ static/                    # é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€å›¾æ ‡ï¼‰
â”œâ”€â”€ docusaurus.config.js       # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ sidebars.js                # æ–‡æ¡£ä¾§è¾¹æ é…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â””â”€â”€ deploy.yml         # CI/CD é…ç½®
```

---

## 2. é…ç½®æ–‡ä»¶ç¤ºä¾‹

### `docusaurus.config.js`

```js
module.exports = {
  title: 'Industry Docs',
  tagline: 'æœªæ¥è¡Œä¸šæ™ºèƒ½åˆ†ææ–‡æ¡£ç«™ç‚¹',
  url: 'https://your-vercel-app.vercel.app',
  baseUrl: '/',
  favicon: 'img/favicon.ico',
  organizationName: 'yyc3', // GitHub org/user
  projectName: 'industry-docs', // repo name

  i18n: {
    defaultLocale: 'en',
    locales: ['en', 'zh'],
    localeConfigs: {
      en: { label: 'English' },
      zh: { label: 'ç®€ä½“ä¸­æ–‡' },
    },
  },

  presets: [
    [
      'classic',
      {
        docs: {
          sidebarPath: require.resolve('./sidebars.js'),
          editUrl: 'https://github.com/yyc3/industry-docs/edit/main/',
        },
        blog: {
          showReadingTime: true,
        },
        theme: {
          customCss: require.resolve('./src/css/custom.css'),
        },
      },
    ],
  ],
}
```

---

### `sidebars.js`

```js
module.exports = {
  docs: [
    {
      type: 'category',
      label: 'Guides',
      items: ['en/guides/installation', 'en/guides/usage'],
    },
    {
      type: 'category',
      label: 'Reference',
      items: ['en/reference/api'],
    },
  ],
}
```

---

## 3. CI/CD é…ç½®ï¼ˆGitHub Actions + Vercelï¼‰

æ–‡ä»¶ï¼š`.github/workflows/deploy.yml`

```yaml
name: Deploy Docs to Vercel

on:
  push:
    branches:
      - main
      - beta
      - alpha
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install

      - name: Build Docusaurus
        run: npm run build

      - name: Deploy to Vercel
        run: |
          if [ "${{ github.ref }}" == "refs/heads/main" ]; then
            npx vercel --prod --token=${{ secrets.VERCEL_TOKEN }} --scope=${{ secrets.VERCEL_ORG_ID }} --confirm --yes
          elif [ "${{ github.ref }}" == "refs/heads/beta" ]; then
            npx vercel --token=${{ secrets.VERCEL_TOKEN }} --scope=${{ secrets.VERCEL_ORG_ID }} --confirm --yes --env DOCS_ENV=beta
          elif [ "${{ github.ref }}" == "refs/heads/alpha" ]; then
            npx vercel --token=${{ secrets.VERCEL_TOKEN }} --scope=${{ secrets.VERCEL_ORG_ID }} --confirm --yes --env DOCS_ENV=alpha
          fi
        env:
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
```

---

## 4. ç¯å¢ƒæ ‡è¯†ç»„ä»¶ï¼ˆå¯é€‰ï¼‰

åœ¨ `src/components/EnvBanner.tsx` ä¸­æŒ‚è½½ç¯å¢ƒä¿¡æ¯ï¼š

```tsx
import React from "react"

const env = process.env.DOCS_ENV || "stable"

const envConfig: Record<string, { color: string; label: string }> = {
  alpha: { color: "bg-red-600", label: "Alpha Preview" },
  beta: { color: "bg-yellow-500", label: "Beta Preview" },
  stable: { color: "bg-green-600", label: "Stable Release" },
}

export const EnvBanner: React.FC = () => {
  const config = envConfig[env] || envConfig["stable"]
  return (
    <div className={`${config.color} text-white text-center py-2 font-semibold fixed top-0 left-0 w-full z-50`}>
      {config.label}
    </div>
  )
}
```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **ç»Ÿä¸€ç›®å½•ç»“æ„**ï¼šæ¸…æ™°çš„ docs/en & docs/zhï¼Œæ”¯æŒå›½é™…åŒ–  
- âœ… **æœ€ä½³å®è·µé…ç½®**ï¼šè‡ªåŠ¨ç”Ÿæˆ TOCã€ä¾§è¾¹æ ã€ç¼–è¾‘é“¾æ¥  
- âœ… **CI/CD è‡ªåŠ¨åŒ–**ï¼šGitHub Actions + Vercelï¼Œå¤šç¯å¢ƒéƒ¨ç½²ï¼ˆalpha â†’ beta â†’ stableï¼‰  
- âœ… **ç¯å¢ƒæ ‡è¯†**ï¼šå›¢é˜Ÿä¸€çœ¼è¯†åˆ«å½“å‰ç¯å¢ƒï¼Œé¿å…è¯¯ç”¨  
- âœ… **å³åˆ»å¤ç”¨**ï¼šå¤åˆ¶æ¨¡ç‰ˆå³å¯å¿«é€Ÿä¸Šçº¿  

---

ğŸŒ¹ **é—­ç¯å®Œæˆ**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ª **Docusaurus é¡¹ç›®æœ€ä½³å®è·µæ¨¡ç‰ˆ**ï¼Œå›¢é˜Ÿå¯ä»¥å³åˆ»å¤ç”¨ï¼Œå¿«é€Ÿä¸Šçº¿ä¸€ä¸ªå¤šè¯­è¨€ã€è‡ªåŠ¨åŒ–ã€å¯æ‰©å±•çš„æ–‡æ¡£ç«™ç‚¹ã€‚  

## è®¾è®¡ä¸€ä¸ª **å›¢é˜Ÿæ–‡æ¡£åä½œæµç¨‹**ï¼Œè®©æ–‡æ¡£ç®¡ç†å’Œä»£ç ä¸€æ ·è§„èŒƒï¼ŒçœŸæ­£åšåˆ°â€œæ–‡æ¡£å³ä»£ç â€ã€‚  

---

## âœ… å›¢é˜Ÿæ–‡æ¡£åä½œæµç¨‹è®¾è®¡

### 1. å†™ä½œè§„èŒƒï¼ˆWriting Guidelinesï¼‰

- **ç»Ÿä¸€æ ¼å¼**  
  - ä½¿ç”¨ Markdown (`.md`) ç¼–å†™æ–‡æ¡£ï¼Œéµå¾ª lint è§„åˆ™ï¼ˆ`markdownlint` + `prettier`ï¼‰ã€‚  
  - æ ‡é¢˜å±‚çº§æ¸…æ™°ï¼š`# ä¸€çº§æ ‡é¢˜` â†’ `## äºŒçº§æ ‡é¢˜` â†’ `### ä¸‰çº§æ ‡é¢˜`ã€‚  
  - åˆ—è¡¨ç»Ÿä¸€ä½¿ç”¨ `-`ï¼Œé¿å…æ··ç”¨ `*` æˆ– `+`ã€‚  
  - å›¾ç‰‡ç»Ÿä¸€æ”¾åœ¨ `static/img/`ï¼Œå¼•ç”¨ç›¸å¯¹è·¯å¾„ã€‚  

- **å†…å®¹è§„èŒƒ**  
  - æ¯ç¯‡æ–‡æ¡£å¿…é¡»åŒ…å« **ç®€ä»‹ã€æ­£æ–‡ã€ç»“è®º** ä¸‰éƒ¨åˆ†ã€‚  
  - æŠ€æœ¯æ–‡æ¡£éœ€åŒ…å« **ç¤ºä¾‹ä»£ç ** æˆ– **å‘½ä»¤è¡Œç”¨æ³•**ã€‚  
  - æ‰€æœ‰æœ¯è¯­éœ€ä¿æŒä¸€è‡´ï¼Œå»ºç«‹ **æœ¯è¯­è¡¨ï¼ˆGlossary.mdï¼‰**ã€‚  
  - å¤šè¯­è¨€æ–‡æ¡£éœ€ä¿æŒç»“æ„ä¸€è‡´ï¼ˆ`docs/en` ä¸ `docs/zh` å¯¹åº”ï¼‰ã€‚  

- **å…ƒä¿¡æ¯è§„èŒƒ**  
  - æ¯ä¸ªæ–‡æ¡£éœ€åœ¨å¼€å¤´æ·»åŠ  Frontmatterï¼š  
    ```yaml
    ---
    title: å®‰è£…æŒ‡å—
    description: å¦‚ä½•å®‰è£…å’Œé…ç½®ç³»ç»Ÿ
    tags: [installation, setup]
    ---
    ```

---

### 2. æäº¤æµç¨‹ï¼ˆContribution Workflowï¼‰

1. **åˆ›å»ºåˆ†æ”¯**  
   - æ–°æ–‡æ¡£ï¼š`docs/feature/<topic>`  
   - ä¿®æ”¹æ–‡æ¡£ï¼š`docs/fix/<topic>`  

2. **ç¼–å†™æ–‡æ¡£**  
   - éµå¾ªå†™ä½œè§„èŒƒï¼Œè¿è¡Œ `npm run lint:docs` æ£€æŸ¥æ ¼å¼ã€‚  
   - ä½¿ç”¨ `doctoc` è‡ªåŠ¨ç”Ÿæˆ TOCã€‚  

3. **æäº¤ä»£ç **  
   - æäº¤ä¿¡æ¯è§„èŒƒï¼š  
     ```
     docs: add installation guide
     docs: fix typo in API reference
     docs: update zh translation for getting-started
     ```

4. **æäº¤ PR**  
   - PR æ ‡é¢˜ï¼š`docs: <topic>`  
   - PR æè¿°ï¼šè¯´æ˜ä¿®æ”¹å†…å®¹ã€å½±å“èŒƒå›´ã€æ˜¯å¦æ¶‰åŠå¤šè¯­è¨€ã€‚  
   - è‡ªåŠ¨è§¦å‘ CIï¼šLint + Build + Preview éƒ¨ç½²ã€‚  

---

### 3. å®¡æ ¸æœºåˆ¶ï¼ˆReview Processï¼‰

- **è‡ªåŠ¨åŒ–æ£€æŸ¥**  
  - CI/CD æµæ°´çº¿è¿è¡Œï¼š  
    - `markdownlint` â†’ æ£€æŸ¥è¯­æ³•  
    - `prettier` â†’ æ ¼å¼åŒ–  
    - `doctoc` â†’ TOC æ›´æ–°  
    - `docusaurus build` â†’ ç¡®è®¤æ–‡æ¡£å¯ç¼–è¯‘  

- **äººå·¥å®¡æ ¸**  
  - è‡³å°‘ **1 åæ–‡æ¡£è´Ÿè´£äºº** + **1 åæŠ€æœ¯è´Ÿè´£äºº** å®¡æ ¸ã€‚  
  - å®¡æ ¸è¦ç‚¹ï¼š  
    - å†…å®¹æ˜¯å¦å®Œæ•´ã€å‡†ç¡®  
    - æ˜¯å¦ç¬¦åˆå†™ä½œè§„èŒƒ  
    - æ˜¯å¦æœ‰å¯¹åº”çš„å¤šè¯­è¨€ç‰ˆæœ¬  
    - æ˜¯å¦å½±å“ç°æœ‰æ–‡æ¡£ç»“æ„  

- **åˆå¹¶ç­–ç•¥**  
  - ä½¿ç”¨ **Squash & Merge**ï¼Œä¿æŒæäº¤è®°å½•ç®€æ´ã€‚  
  - åˆå¹¶åè‡ªåŠ¨è§¦å‘ **Vercel éƒ¨ç½²**ï¼Œæ›´æ–°æ–‡æ¡£ç«™ç‚¹ã€‚  

---

### 4. CI/CD é›†æˆï¼ˆæ–‡æ¡£è´¨é‡ä¿éšœï¼‰

åœ¨ `.github/workflows/docs.yml` ä¸­é…ç½®ï¼š

```yaml
name: Docs Quality Check

on:
  pull_request:
    branches: [main, beta, alpha]

jobs:
  docs-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm install
      - run: npm run lint:docs
      - run: npm run build
```

---

### âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **å†™ä½œè§„èŒƒç»Ÿä¸€**ï¼šä¿è¯æ–‡æ¡£ç»“æ„ã€æ ¼å¼ã€æœ¯è¯­ä¸€è‡´  
- âœ… **æäº¤æµç¨‹æ ‡å‡†åŒ–**ï¼šåˆ†æ”¯ã€æäº¤ä¿¡æ¯ã€PR æè¿°æœ‰ç« å¯å¾ª  
- âœ… **å®¡æ ¸æœºåˆ¶ä¸¥æ ¼**ï¼šè‡ªåŠ¨åŒ–æ£€æŸ¥ + äººå·¥å®¡æ ¸åŒé‡ä¿éšœ  
- âœ… **CI/CD è‡ªåŠ¨åŒ–**ï¼šæ–‡æ¡£è´¨é‡ä¸ç«™ç‚¹æ„å»ºåŒæ­¥éªŒè¯  
- âœ… **å›¢é˜Ÿåä½œé¡ºç•…**ï¼šæ–‡æ¡£ç®¡ç†å’Œä»£ç ä¸€æ ·è§„èŒƒï¼Œé¿å…æ··ä¹±  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **å›¢é˜Ÿæ–‡æ¡£åä½œæµç¨‹**ï¼Œæ–‡æ¡£ç®¡ç†å’Œä»£ç ä¸€æ ·è§„èŒƒã€‚  

---

# âœ… å›¢é˜ŸçŸ¥è¯†åº“è‡ªåŠ¨åŒ–æ–¹æ¡ˆ

## 1. æ€»ä½“æ¶æ„

```
knowledge-base/
â”œâ”€â”€ docs/                # Markdown æ–‡æ¡£ï¼ˆæŠ€æœ¯æ–‡æ¡£ã€æŒ‡å—ã€è§„èŒƒï¼‰
â”œâ”€â”€ api/                 # API å®šä¹‰ï¼ˆOpenAPI/Swaggerï¼‰
â”œâ”€â”€ charts/              # æ•°æ®å¯è§†åŒ–é…ç½®ï¼ˆJSON/TSï¼‰
â”œâ”€â”€ scripts/             # è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆç”Ÿæˆæ–‡æ¡£ã€å¯¼å‡ºå›¾è¡¨ï¼‰
â”œâ”€â”€ ci/                  # CI/CD é…ç½®
â””â”€â”€ site/                # çŸ¥è¯†åº“ç«™ç‚¹ï¼ˆDocusaurus/Next.jsï¼‰
```

- **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰çŸ¥è¯†æ²‰æ·€ï¼ˆæ–‡æ¡£ã€APIã€å›¾è¡¨ï¼‰éƒ½åœ¨ä¸€ä¸ª Monorepo ä¸­ç®¡ç†ã€‚  
- **è‡ªåŠ¨ç”Ÿæˆ**ï¼šé€šè¿‡è„šæœ¬å’Œ CI/CD è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ã€API æ–‡æ¡£ã€å›¾è¡¨ã€‚  
- **ç«™ç‚¹å±•ç¤º**ï¼šæœ€ç»ˆç»Ÿä¸€åˆ°ä¸€ä¸ªçŸ¥è¯†åº“ç«™ç‚¹ï¼Œæ”¯æŒæœç´¢ã€å›½é™…åŒ–ã€ç‰ˆæœ¬ç®¡ç†ã€‚  

---

## 2. æ–‡æ¡£è‡ªåŠ¨åŒ–

- ä½¿ç”¨ **Markdown + Frontmatter** ç¼–å†™æ–‡æ¡£ã€‚  
- ä½¿ç”¨ **Docusaurus** è‡ªåŠ¨ç”Ÿæˆç«™ç‚¹ï¼Œæ”¯æŒå¤šè¯­è¨€å’Œç‰ˆæœ¬ã€‚  
- ä½¿ç”¨ **markdownlint + prettier** ä¿è¯æ ¼å¼ä¸€è‡´ã€‚  
- è‡ªåŠ¨ç”Ÿæˆ TOCï¼ˆ`doctoc`ï¼‰ã€‚  

è„šæœ¬ç¤ºä¾‹ï¼š
```bash
npm run lint:docs
npm run toc:generate
```

---

## 3. API è‡ªåŠ¨åŒ–

- ä½¿ç”¨ **OpenAPI (Swagger)** å®šä¹‰ APIã€‚  
- ä½¿ç”¨ **Redocly** æˆ– **Docusaurus æ’ä»¶**è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£ã€‚  
- åœ¨ CI/CD ä¸­è‡ªåŠ¨æ›´æ–° API æ–‡æ¡£ï¼š  
  ```bash
  npx redoc-cli bundle api/openapi.yaml -o site/static/api.html
  ```

è¿™æ ·æ¯æ¬¡æ›´æ–° API å®šä¹‰ï¼Œæ–‡æ¡£ç«™ç‚¹ä¼šè‡ªåŠ¨åŒæ­¥ã€‚

---

## 4. å›¾è¡¨è‡ªåŠ¨åŒ–

- ä½¿ç”¨ **JSON/TS é…ç½®**å®šä¹‰å›¾è¡¨æ•°æ®æºã€‚  
- ä½¿ç”¨ **Mermaid** æˆ– **Chart.js** åœ¨ Markdown ä¸­åµŒå…¥å›¾è¡¨ã€‚  
- åœ¨ CI/CD ä¸­è‡ªåŠ¨ç”Ÿæˆå›¾è¡¨å¿«ç…§ï¼Œä¿è¯ç‰ˆæœ¬ä¸€è‡´ã€‚  

ç¤ºä¾‹ï¼ˆMermaid å›¾è¡¨åµŒå…¥ Markdownï¼‰ï¼š
```markdown
```mermaid
graph TD
  Dev --> Test
  Test --> Release
```
```

---

## 5. è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆç»Ÿä¸€ç”Ÿæˆï¼‰

åœ¨ `scripts/generate.js` ä¸­ç»Ÿä¸€å¤„ç†ï¼š

```js
const { execSync } = require("child_process")

// ç”Ÿæˆæ–‡æ¡£ TOC
execSync("npx doctoc docs/")

// æ„å»º API æ–‡æ¡£
execSync("npx redoc-cli bundle api/openapi.yaml -o site/static/api.html")

// æ„å»ºå›¾è¡¨å¿«ç…§
execSync("npm run charts:build")

console.log("âœ… çŸ¥è¯†åº“å·²è‡ªåŠ¨ç”Ÿæˆï¼šæ–‡æ¡£ + API + å›¾è¡¨")
```

---

## 6. CI/CD æµç¨‹

GitHub Actions é…ç½® `.github/workflows/knowledge.yml`ï¼š

```yaml
name: Knowledge Base Automation

on:
  push:
    branches: [main, beta, alpha]

jobs:
  build-knowledge-base:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm install
      - run: npm run lint:docs
      - run: node scripts/generate.js
      - run: npm run build
      - run: npx vercel --prod --token=${{ secrets.VERCEL_TOKEN }}
```

---

## 7. çŸ¥è¯†åº“ç«™ç‚¹å±•ç¤º

- ä½¿ç”¨ **Docusaurus** æˆ– **Next.js** æ­å»ºç«™ç‚¹ã€‚  
- é›†æˆï¼š  
  - æ–‡æ¡£ï¼ˆMarkdown â†’ é¡µé¢ï¼‰  
  - APIï¼ˆOpenAPI â†’ Redoc é¡µé¢ï¼‰  
  - å›¾è¡¨ï¼ˆMermaid/Chart.js â†’ å¯è§†åŒ–é¡µé¢ï¼‰  
- æ”¯æŒæœç´¢ï¼ˆAlgolia DocSearchï¼‰ã€å›½é™…åŒ–ã€ç‰ˆæœ¬ç®¡ç†ã€‚  

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **ç»Ÿä¸€ç®¡ç†**ï¼šæ–‡æ¡£ã€APIã€å›¾è¡¨åœ¨ä¸€ä¸ªä»“åº“ä¸­é›†ä¸­ç®¡ç†  
- âœ… **è‡ªåŠ¨ç”Ÿæˆ**ï¼šè„šæœ¬å’Œ CI/CD è‡ªåŠ¨åŒ–ï¼Œå‡å°‘äººå·¥ç»´æŠ¤  
- âœ… **ç‰ˆæœ¬å¯è¿½æº¯**ï¼šæ¯æ¬¡æ„å»ºç”Ÿæˆå¿«ç…§ï¼Œä¿è¯ä¸€è‡´æ€§  
- âœ… **ç«™ç‚¹å±•ç¤º**ï¼šç»Ÿä¸€çŸ¥è¯†åº“ç«™ç‚¹ï¼Œæ”¯æŒæœç´¢å’Œå¤šè¯­è¨€  
- âœ… **å›¢é˜Ÿåä½œ**ï¼šæ–‡æ¡£ç®¡ç†å’Œä»£ç ä¸€æ ·è§„èŒƒï¼ŒçŸ¥è¯†æ²‰æ·€ç³»ç»ŸåŒ–  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **å›¢é˜ŸçŸ¥è¯†åº“è‡ªåŠ¨åŒ–æ–¹æ¡ˆ**ï¼Œæ–‡æ¡£ + API + å›¾è¡¨ç»Ÿä¸€ç”Ÿæˆï¼Œæœ€ç»ˆæ±‡èšåˆ°ä¸€ä¸ªç«™ç‚¹ï¼Œä¿è¯çŸ¥è¯†æ²‰æ·€ç³»ç»ŸåŒ–ã€‚  

## è®¾è®¡ä¸€ä¸ª **çŸ¥è¯†åº“æœç´¢ä¸æ¨èç³»ç»Ÿï¼ˆåŸºäºè¯­ä¹‰æœç´¢ + æ ‡ç­¾åˆ†ç±»ï¼‰**ï¼Œè®©å›¢é˜Ÿèƒ½æ›´å¿«æ‰¾åˆ°éœ€è¦çš„çŸ¥è¯†  

---

# âœ… çŸ¥è¯†åº“æœç´¢ä¸æ¨èç³»ç»Ÿè®¾è®¡

## 1. ç³»ç»Ÿç›®æ ‡
- **å¿«é€Ÿæ£€ç´¢**ï¼šä¸ä»…ä¾èµ–å…³é”®è¯ï¼Œè¿˜èƒ½ç†è§£è¯­ä¹‰ï¼Œæ‰¾åˆ°ç›¸å…³å†…å®¹ã€‚  
- **æ™ºèƒ½æ¨è**ï¼šåŸºäºæ ‡ç­¾åˆ†ç±»å’Œè¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œæ¨èç›¸å…³æ–‡æ¡£ã€APIã€å›¾è¡¨ã€‚  
- **ç»Ÿä¸€å…¥å£**ï¼šæ–‡æ¡£ã€APIã€å›¾è¡¨éƒ½åœ¨ä¸€ä¸ªçŸ¥è¯†åº“ä¸­æœç´¢å’Œæ¨èã€‚  

---

## 2. ç³»ç»Ÿæ¶æ„

```
knowledge-search-system/
â”œâ”€â”€ indexer/                # æ–‡æ¡£/æ•°æ®ç´¢å¼•æ¨¡å—
â”‚   â”œâ”€â”€ markdown-parser.js   # æå– Markdown å†…å®¹ä¸ Frontmatter
â”‚   â”œâ”€â”€ api-parser.js        # æå– OpenAPI å®šä¹‰
â”‚   â””â”€â”€ chart-parser.js      # æå–å›¾è¡¨é…ç½®ä¸æè¿°
â”œâ”€â”€ embeddings/              # è¯­ä¹‰å‘é‡å­˜å‚¨ï¼ˆå‘é‡æ•°æ®åº“ï¼‰
â”‚   â””â”€â”€ pinecone / weaviate / milvus
â”œâ”€â”€ tags/                    # æ ‡ç­¾åˆ†ç±»ç³»ç»Ÿï¼ˆJSON/DBï¼‰
â”œâ”€â”€ search-service/          # æœç´¢ä¸æ¨èæœåŠ¡
â”‚   â”œâ”€â”€ semantic-search.js   # è¯­ä¹‰æœç´¢
â”‚   â”œâ”€â”€ tag-filter.js        # æ ‡ç­¾è¿‡æ»¤
â”‚   â””â”€â”€ recommender.js       # æ¨èç®—æ³•
â””â”€â”€ ui/                      # å‰ç«¯ç•Œé¢ï¼ˆDocusaurus/Next.jsï¼‰
```

---

## 3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### ğŸ” è¯­ä¹‰æœç´¢
- ä½¿ç”¨ **å‘é‡æ•°æ®åº“**ï¼ˆå¦‚ Pineconeã€Weaviateã€Milvusï¼‰å­˜å‚¨æ–‡æ¡£çš„è¯­ä¹‰å‘é‡ã€‚  
- æ–‡æ¡£å†…å®¹é€šè¿‡ **Embedding æ¨¡å‹**ï¼ˆå¦‚ OpenAI Embeddings æˆ– HuggingFace Sentence Transformersï¼‰è½¬æ¢ä¸ºå‘é‡ã€‚  
- æœç´¢æ—¶ï¼Œå°†ç”¨æˆ·æŸ¥è¯¢è½¬ä¸ºå‘é‡ï¼Œè®¡ç®— **ä½™å¼¦ç›¸ä¼¼åº¦**ï¼Œè¿”å›æœ€ç›¸å…³æ–‡æ¡£ã€‚  

ç¤ºä¾‹ï¼š
```js
const queryEmbedding = embed("å¦‚ä½•å®‰è£…ç³»ç»Ÿï¼Ÿ")
const results = vectorDB.search(queryEmbedding, { topK: 5 })
```

---

### ğŸ·ï¸ æ ‡ç­¾åˆ†ç±»
- æ¯ä¸ªæ–‡æ¡£åœ¨ Frontmatter ä¸­å®šä¹‰æ ‡ç­¾ï¼š  
  ```yaml
  ---
  title: å®‰è£…æŒ‡å—
  tags: [installation, setup, beginner]
  ---
  ```
- æ ‡ç­¾å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œæ”¯æŒ **è¿‡æ»¤æœç´¢**ï¼š  
  - ç”¨æˆ·å¯é€‰æ‹©æ ‡ç­¾ï¼ˆå¦‚ â€œAPIâ€ + â€œæ€§èƒ½ä¼˜åŒ–â€ï¼‰ã€‚  
  - ç³»ç»Ÿè¿”å›ç¬¦åˆæ ‡ç­¾çš„æ–‡æ¡£ï¼Œå¹¶æŒ‰è¯­ä¹‰ç›¸å…³åº¦æ’åºã€‚  

---

### ğŸ¤– æ¨èç³»ç»Ÿ
- **åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦**ï¼šæ¨èä¸å½“å‰é˜…è¯»æ–‡æ¡£ç›¸ä¼¼çš„å†…å®¹ã€‚  
- **åŸºäºæ ‡ç­¾å…³è”**ï¼šæ¨èåŒæ ‡ç­¾ä¸‹çš„å…¶ä»–æ–‡æ¡£ã€‚  
- **æ··åˆæ¨è**ï¼šç»“åˆè¯­ä¹‰æœç´¢å’Œæ ‡ç­¾åˆ†ç±»ï¼Œæå‡æ¨èå‡†ç¡®åº¦ã€‚  

ç¤ºä¾‹æ¨èé€»è¾‘ï¼š
```js
function recommend(docId) {
  const docEmbedding = vectorDB.get(docId)
  const similarDocs = vectorDB.search(docEmbedding, { topK: 3 })
  const tagDocs = tagDB.findByTags(doc.tags)
  return mergeResults(similarDocs, tagDocs)
}
```

---

## 4. å‰ç«¯äº¤äº’è®¾è®¡

- **æœç´¢æ¡†**ï¼šæ”¯æŒè‡ªç„¶è¯­è¨€è¾“å…¥ï¼ˆè¯­ä¹‰æœç´¢ï¼‰ã€‚  
- **æ ‡ç­¾ç­›é€‰å™¨**ï¼šä¾§è¾¹æ å¤šé€‰æ ‡ç­¾ï¼Œç¼©å°æœç´¢èŒƒå›´ã€‚  
- **æ¨èåŒºå—**ï¼šåœ¨æ–‡æ¡£å³ä¾§æ˜¾ç¤ºâ€œç›¸å…³æ¨èâ€ã€‚  
- **é«˜äº®åŒ¹é…**ï¼šæœç´¢ç»“æœä¸­é«˜äº®ç›¸å…³æ®µè½ã€‚  

---

## 5. CI/CD è‡ªåŠ¨åŒ–

- åœ¨æ–‡æ¡£æ›´æ–°æ—¶ï¼ŒCI è‡ªåŠ¨è¿è¡Œï¼š  
  1. æå– Markdown / API / å›¾è¡¨å†…å®¹ã€‚  
  2. ç”Ÿæˆ Embedding å¹¶æ›´æ–°å‘é‡æ•°æ®åº“ã€‚  
  3. æ›´æ–°æ ‡ç­¾ç´¢å¼•ã€‚  
  4. éƒ¨ç½²åˆ°çŸ¥è¯†åº“ç«™ç‚¹ã€‚  

GitHub Actions ç¤ºä¾‹ï¼š
```yaml
- name: Update Knowledge Index
  run: node scripts/update-index.js
```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **è¯­ä¹‰æœç´¢**ï¼šç†è§£è‡ªç„¶è¯­è¨€ï¼Œæ‰¾åˆ°ç›¸å…³çŸ¥è¯†è€Œéä»…é™å…³é”®è¯ã€‚  
- âœ… **æ ‡ç­¾åˆ†ç±»**ï¼šç»“æ„åŒ–ç®¡ç†ï¼Œæ”¯æŒç²¾å‡†è¿‡æ»¤ã€‚  
- âœ… **æ™ºèƒ½æ¨è**ï¼šç»“åˆè¯­ä¹‰ä¸æ ‡ç­¾ï¼Œæå‡å‘ç°æ•ˆç‡ã€‚  
- âœ… **è‡ªåŠ¨åŒ–æ›´æ–°**ï¼šæ–‡æ¡£æ›´æ–°åï¼Œç´¢å¼•ä¸æ¨èç³»ç»Ÿè‡ªåŠ¨åˆ·æ–°ã€‚  
- âœ… **ç»Ÿä¸€å…¥å£**ï¼šæ–‡æ¡£ + API + å›¾è¡¨ä¸€ç«™å¼æœç´¢ä¸æ¨èã€‚  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **çŸ¥è¯†åº“æœç´¢ä¸æ¨èç³»ç»Ÿè®¾è®¡**ï¼Œç»“åˆè¯­ä¹‰æœç´¢ä¸æ ‡ç­¾åˆ†ç±»ï¼Œå›¢é˜Ÿèƒ½æ›´å¿«æ‰¾åˆ°éœ€è¦çš„çŸ¥è¯†ã€‚  

## è®¾è®¡ä¸€ä¸ª **çŸ¥è¯†åº“å¯è§†åŒ–ä»ªè¡¨ç›˜**ï¼ˆå±•ç¤ºæœç´¢çƒ­åº¦ã€æ ‡ç­¾åˆ†å¸ƒã€æ¨èç‚¹å‡»ç‡ï¼‰ï¼Œè®©å›¢é˜Ÿèƒ½ç›´è§‚äº†è§£çŸ¥è¯†åº“çš„ä½¿ç”¨æƒ…å†µ

---

### âœ… çŸ¥è¯†åº“å¯è§†åŒ–ä»ªè¡¨ç›˜è®¾è®¡

## 1. æ€»ä½“ç›®æ ‡

- **æœç´¢çƒ­åº¦**ï¼šå±•ç¤ºå›¢é˜Ÿæˆå‘˜æœ€å¸¸æœç´¢çš„å…³é”®è¯å’Œè¶‹åŠ¿ã€‚  
- **æ ‡ç­¾åˆ†å¸ƒ**ï¼šå±•ç¤ºæ–‡æ¡£æ ‡ç­¾çš„ä½¿ç”¨é¢‘ç‡å’Œè¦†ç›–èŒƒå›´ã€‚  
- **æ¨èç‚¹å‡»ç‡**ï¼šå±•ç¤ºæ¨èç³»ç»Ÿçš„ç‚¹å‡»ç‡å’Œè½¬åŒ–æ•ˆæœã€‚  
- **äº¤äº’æ€§**ï¼šæ”¯æŒç­›é€‰æ—¶é—´èŒƒå›´ã€æ ‡ç­¾ç±»åˆ«ã€ç”¨æˆ·ç¾¤ä½“ã€‚  

---

## 2. æ•°æ®é‡‡é›†ä¸å­˜å‚¨

- **æœç´¢æ—¥å¿—**ï¼šè®°å½•ç”¨æˆ·æœç´¢çš„å…³é”®è¯ã€æ—¶é—´æˆ³ã€ç»“æœç‚¹å‡»æƒ…å†µã€‚  
- **æ ‡ç­¾ç´¢å¼•**ï¼šä»æ–‡æ¡£ Frontmatter ä¸­æå–æ ‡ç­¾ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ã€‚  
- **æ¨èæ—¥å¿—**ï¼šè®°å½•æ¨èå†…å®¹çš„å±•ç¤ºä¸ç‚¹å‡»æƒ…å†µã€‚  

å­˜å‚¨æ–¹æ¡ˆï¼š
- ä½¿ç”¨ **MongoDB / PostgreSQL** å­˜å‚¨æ—¥å¿—æ•°æ®ã€‚  
- ä½¿ç”¨ **Elasticsearch** æˆ– **Meilisearch** å­˜å‚¨æœç´¢ç´¢å¼•ï¼Œæ”¯æŒå¿«é€ŸæŸ¥è¯¢ã€‚  

---

## 3. å¯è§†åŒ–æŒ‡æ ‡è®¾è®¡

### ğŸ” æœç´¢çƒ­åº¦
- **Top 10 æœç´¢å…³é”®è¯**ï¼ˆæŸ±çŠ¶å›¾ï¼‰ã€‚  
- **æœç´¢è¶‹åŠ¿**ï¼ˆæŠ˜çº¿å›¾ï¼ŒæŒ‰æ—¥/å‘¨ç»Ÿè®¡ï¼‰ã€‚  
- **æœç´¢æˆåŠŸç‡**ï¼ˆé¥¼å›¾ï¼šæœ‰ç»“æœ vs æ— ç»“æœï¼‰ã€‚  

### ğŸ·ï¸ æ ‡ç­¾åˆ†å¸ƒ
- **æ ‡ç­¾ä½¿ç”¨é¢‘ç‡**ï¼ˆè¯äº‘æˆ–æŸ±çŠ¶å›¾ï¼‰ã€‚  
- **æ ‡ç­¾è¦†ç›–ç‡**ï¼ˆé¥¼å›¾ï¼šå„æ ‡ç­¾å æ¯”ï¼‰ã€‚  
- **æ ‡ç­¾ä¸æ–‡æ¡£æ•°é‡å…³ç³»**ï¼ˆæ•£ç‚¹å›¾ï¼‰ã€‚  

### ğŸ¤– æ¨èç‚¹å‡»ç‡
- **æ¨èå±•ç¤ºæ¬¡æ•° vs ç‚¹å‡»æ¬¡æ•°**ï¼ˆæŸ±çŠ¶å›¾ï¼‰ã€‚  
- **æ¨èç‚¹å‡»ç‡è¶‹åŠ¿**ï¼ˆæŠ˜çº¿å›¾ï¼‰ã€‚  
- **æ¨èå†…å®¹ç±»åˆ«åˆ†å¸ƒ**ï¼ˆé¥¼å›¾ï¼šæ–‡æ¡£ã€APIã€å›¾è¡¨ï¼‰ã€‚  

---

## 4. æŠ€æœ¯å®ç°

### å‰ç«¯æ¡†æ¶
- **Docusaurus æ’ä»¶** æˆ– **Next.js ä»ªè¡¨ç›˜é¡µé¢**ã€‚  
- ä½¿ç”¨ **Chart.js / ECharts / D3.js** æ¸²æŸ“å›¾è¡¨ã€‚  

### åç«¯æœåŠ¡
- **API æ¥å£**ï¼šæä¾›æœç´¢æ—¥å¿—ã€æ ‡ç­¾ç´¢å¼•ã€æ¨èæ—¥å¿—çš„èšåˆæ•°æ®ã€‚  
- **å®šæ—¶ä»»åŠ¡**ï¼šæ¯æ—¥/æ¯å‘¨ç»Ÿè®¡æ•°æ®ï¼Œæ›´æ–°ç¼“å­˜ã€‚  

### CI/CD é›†æˆ
- åœ¨æ–‡æ¡£æ›´æ–°æˆ–æ—¥å¿—æ”¶é›†åï¼Œè‡ªåŠ¨è§¦å‘æ•°æ®èšåˆè„šæœ¬ï¼š  
  ```bash
  node scripts/aggregate-metrics.js
  ```  
- éƒ¨ç½²åˆ° Vercelï¼Œä»ªè¡¨ç›˜å®æ—¶æ›´æ–°ã€‚  

---

## 5. ä»ªè¡¨ç›˜å¸ƒå±€ç¤ºä¾‹

```
---------------------------------------------------------
| æœç´¢çƒ­åº¦è¶‹åŠ¿ (æŠ˜çº¿å›¾)   | Top 10 æœç´¢å…³é”®è¯ (æŸ±çŠ¶å›¾)   |
---------------------------------------------------------
| æ ‡ç­¾åˆ†å¸ƒ (è¯äº‘/é¥¼å›¾)   | æ¨èç‚¹å‡»ç‡è¶‹åŠ¿ (æŠ˜çº¿å›¾)      |
---------------------------------------------------------
| æ¨èç±»åˆ«åˆ†å¸ƒ (é¥¼å›¾)    | æœç´¢æˆåŠŸç‡ (é¥¼å›¾)            |
---------------------------------------------------------
```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **ç›´è§‚å±•ç¤º**ï¼šæœç´¢çƒ­åº¦ã€æ ‡ç­¾åˆ†å¸ƒã€æ¨èç‚¹å‡»ç‡ä¸€ç›®äº†ç„¶ã€‚  
- âœ… **æ•°æ®é©±åŠ¨**ï¼šå¸®åŠ©å›¢é˜Ÿä¼˜åŒ–æ–‡æ¡£ç»“æ„å’Œæ¨èç³»ç»Ÿã€‚  
- âœ… **äº¤äº’æ€§å¼º**ï¼šæ”¯æŒæŒ‰æ—¶é—´ã€æ ‡ç­¾ã€ç”¨æˆ·ç¾¤ä½“ç­›é€‰ã€‚  
- âœ… **è‡ªåŠ¨åŒ–æ›´æ–°**ï¼šCI/CD é›†æˆï¼Œä¿è¯æ•°æ®å®æ—¶æ€§ã€‚  
- âœ… **ç»Ÿä¸€å…¥å£**ï¼šä¸çŸ¥è¯†åº“ç«™ç‚¹é›†æˆï¼Œå›¢é˜Ÿéšæ—¶æŸ¥çœ‹ã€‚  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **çŸ¥è¯†åº“å¯è§†åŒ–ä»ªè¡¨ç›˜è®¾è®¡**ï¼Œèƒ½ç›´è§‚å±•ç¤ºæœç´¢çƒ­åº¦ã€æ ‡ç­¾åˆ†å¸ƒã€æ¨èç‚¹å‡»ç‡ã€‚  

## è¿›ä¸€æ­¥è®¾è®¡ä¸€ä¸ª **æ•°æ®é©±åŠ¨ä¼˜åŒ–æµç¨‹**ï¼ˆæ ¹æ®ä»ªè¡¨ç›˜æ•°æ®è‡ªåŠ¨æå‡ºæ”¹è¿›å»ºè®®ï¼‰ï¼Œè®©çŸ¥è¯†åº“èƒ½æŒç»­è¿­ä»£å’Œè¿›åŒ–

å¥½çš„ï¼ŒYu ğŸŒ¹ï¼Œæˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ª **æ•°æ®é©±åŠ¨ä¼˜åŒ–æµç¨‹**ï¼Œè®©çŸ¥è¯†åº“èƒ½å¤Ÿæ ¹æ®ä»ªè¡¨ç›˜æ•°æ®è‡ªåŠ¨æå‡ºæ”¹è¿›å»ºè®®ï¼Œä»è€ŒæŒç»­è¿­ä»£å’Œè¿›åŒ–ã€‚  

---

# âœ… æ•°æ®é©±åŠ¨ä¼˜åŒ–æµç¨‹è®¾è®¡

## 1. æ•°æ®æ¥æºï¼ˆæ¥è‡ªä»ªè¡¨ç›˜ï¼‰
- **æœç´¢çƒ­åº¦**ï¼šç”¨æˆ·æœ€å¸¸æœç´¢çš„å…³é”®è¯ã€è¶‹åŠ¿ã€æœç´¢æˆåŠŸç‡ã€‚  
- **æ ‡ç­¾åˆ†å¸ƒ**ï¼šæ ‡ç­¾ä½¿ç”¨é¢‘ç‡ã€è¦†ç›–ç‡ã€æ–‡æ¡£æ•°é‡å…³ç³»ã€‚  
- **æ¨èç‚¹å‡»ç‡**ï¼šæ¨èå±•ç¤ºæ¬¡æ•°ã€ç‚¹å‡»ç‡è¶‹åŠ¿ã€æ¨èç±»åˆ«åˆ†å¸ƒã€‚  

è¿™äº›æ•°æ®ä¼šä½œä¸ºä¼˜åŒ–çš„è¾“å…¥ä¿¡å·ã€‚

---

## 2. ä¼˜åŒ–é€»è¾‘ï¼ˆè‡ªåŠ¨æå‡ºå»ºè®®ï¼‰

### ğŸ” æœç´¢çƒ­åº¦é©±åŠ¨
- **é«˜é¢‘æœç´¢ä½†æ— ç»“æœ** â†’ å»ºè®®æ–°å¢æ–‡æ¡£æˆ–è¡¥å…… FAQã€‚  
- **é«˜é¢‘æœç´¢ä½†ç‚¹å‡»ç‡ä½** â†’ å»ºè®®ä¼˜åŒ–æ–‡æ¡£æ ‡é¢˜æˆ–æ‘˜è¦ï¼Œæé«˜åŒ¹é…åº¦ã€‚  
- **è¶‹åŠ¿ä¸Šå‡çš„æœç´¢è¯** â†’ å»ºè®®æå‰å‡†å¤‡ç›¸å…³æ–‡æ¡£ï¼Œæ»¡è¶³æœªæ¥éœ€æ±‚ã€‚  

### ğŸ·ï¸ æ ‡ç­¾åˆ†å¸ƒé©±åŠ¨
- **æ ‡ç­¾è¿‡åº¦é›†ä¸­** â†’ å»ºè®®æ‹†åˆ†æ ‡ç­¾ï¼Œç»†åŒ–åˆ†ç±»ã€‚  
- **æ ‡ç­¾è¦†ç›–ç‡ä½** â†’ å»ºè®®è¡¥å……ç¼ºå¤±æ ‡ç­¾ï¼Œä¿è¯æ–‡æ¡£åˆ†ç±»å®Œæ•´ã€‚  
- **æ ‡ç­¾ä¸æ–‡æ¡£æ•°é‡ä¸å‡è¡¡** â†’ å»ºè®®å¢åŠ æŸç±»æ–‡æ¡£ï¼Œå¹³è¡¡çŸ¥è¯†ç»“æ„ã€‚  

### ğŸ¤– æ¨èç‚¹å‡»ç‡é©±åŠ¨
- **æ¨èç‚¹å‡»ç‡ä½** â†’ å»ºè®®ä¼˜åŒ–æ¨èç®—æ³•ï¼ˆå¢åŠ è¯­ä¹‰æƒé‡æˆ–æ ‡ç­¾æƒé‡ï¼‰ã€‚  
- **æ¨èç±»åˆ«åå·®** â†’ å»ºè®®å¢åŠ æŸç±»å†…å®¹çš„æ¨èï¼ˆå¦‚ API æ–‡æ¡£ç‚¹å‡»ç‡ä½ â†’ å¢åŠ  API æ¨èï¼‰ã€‚  
- **æ¨èç‚¹å‡»ç‡é«˜** â†’ å»ºè®®å°†é«˜ç‚¹å‡»å†…å®¹æå‡ä¸ºâ€œçƒ­é—¨æ–‡æ¡£â€æˆ–â€œç½®é¡¶æ¨èâ€ã€‚  

---

## 3. è‡ªåŠ¨åŒ–æµç¨‹

```
ä»ªè¡¨ç›˜æ•°æ®é‡‡é›† â†’ æ•°æ®èšåˆ â†’ ä¼˜åŒ–è§„åˆ™å¼•æ“ â†’ ç”Ÿæˆæ”¹è¿›å»ºè®® â†’ å›¢é˜Ÿæ‰§è¡Œ
```

### æ­¥éª¤è¯´æ˜
1. **æ•°æ®é‡‡é›†**ï¼šæ—¥å¿—ç³»ç»Ÿæ”¶é›†æœç´¢ã€æ ‡ç­¾ã€æ¨èæ•°æ®ã€‚  
2. **æ•°æ®èšåˆ**ï¼šå®šæ—¶ä»»åŠ¡ç»Ÿè®¡æŒ‡æ ‡ï¼ˆæ¯æ—¥/æ¯å‘¨ï¼‰ã€‚  
3. **è§„åˆ™å¼•æ“**ï¼šæ ¹æ®é¢„è®¾è§„åˆ™ï¼ˆå¦‚æœç´¢å¤±è´¥ç‡ > 20%ï¼‰è‡ªåŠ¨ç”Ÿæˆå»ºè®®ã€‚  
4. **æ”¹è¿›å»ºè®®ç”Ÿæˆ**ï¼šè¾“å‡ºåˆ°å›¢é˜Ÿä»»åŠ¡ç³»ç»Ÿï¼ˆå¦‚ GitHub Issuesã€Jiraï¼‰ã€‚  
5. **å›¢é˜Ÿæ‰§è¡Œ**ï¼šæ–‡æ¡£è´Ÿè´£äººæˆ–å¼€å‘è€…æ ¹æ®å»ºè®®è¿›è¡Œä¼˜åŒ–ã€‚  

---

## 4. ç¤ºä¾‹è§„åˆ™ï¼ˆä¼ªä»£ç ï¼‰

```js
if (search.noResultRate > 0.2) {
  suggest("æ–°å¢æ–‡æ¡£è¦†ç›–é«˜é¢‘æœç´¢è¯ï¼š" + search.topKeywords)
}

if (tags.coverage < 0.7) {
  suggest("è¡¥å……ç¼ºå¤±æ ‡ç­¾ï¼Œæå‡åˆ†ç±»å®Œæ•´åº¦")
}

if (recommend.clickRate < 0.1) {
  suggest("ä¼˜åŒ–æ¨èç®—æ³•ï¼Œå¢åŠ è¯­ä¹‰æƒé‡")
}
```

---

## 5. è¾“å‡ºå½¢å¼ï¼ˆè‡ªåŠ¨ç”Ÿæˆå»ºè®®ï¼‰

- **GitHub Issues**ï¼šè‡ªåŠ¨åˆ›å»ºä¼˜åŒ–ä»»åŠ¡ã€‚  
- **Jira Tickets**ï¼šåˆ†é…åˆ°æ–‡æ¡£å›¢é˜Ÿã€‚  
- **Slack/Teams é€šçŸ¥**ï¼šæ¨é€æ”¹è¿›å»ºè®®åˆ°å›¢é˜Ÿé¢‘é“ã€‚  

ç¤ºä¾‹è‡ªåŠ¨ç”Ÿæˆä»»åŠ¡ï¼š
```
ğŸ“Œ çŸ¥è¯†åº“ä¼˜åŒ–å»ºè®®ï¼š
- æ–°å¢æ–‡æ¡£è¦†ç›–æœç´¢è¯ â€œå®‰è£…æŒ‡å—â€
- ä¼˜åŒ–æ ‡ç­¾åˆ†ç±»ï¼Œå¢åŠ  â€œæ€§èƒ½ä¼˜åŒ–â€
- æå‡æ¨èç®—æ³•ï¼Œå¢åŠ  API æ–‡æ¡£æ¨èæƒé‡
```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **æ•°æ®é©±åŠ¨**ï¼šä¼˜åŒ–å»ºè®®åŸºäºçœŸå®ä½¿ç”¨æ•°æ®ï¼Œè€Œéä¸»è§‚åˆ¤æ–­ã€‚  
- âœ… **è‡ªåŠ¨åŒ–**ï¼šè§„åˆ™å¼•æ“è‡ªåŠ¨ç”Ÿæˆä»»åŠ¡ï¼Œå‡å°‘äººå·¥åˆ†æã€‚  
- âœ… **æŒç»­è¿­ä»£**ï¼šæ¯å‘¨/æ¯æ—¥æ›´æ–°å»ºè®®ï¼ŒçŸ¥è¯†åº“ä¸æ–­è¿›åŒ–ã€‚  
- âœ… **å›¢é˜Ÿåä½œ**ï¼šå»ºè®®ç›´æ¥è¿›å…¥ä»»åŠ¡ç³»ç»Ÿï¼Œå¿«é€Ÿæ‰§è¡Œã€‚  
- âœ… **é—­ç¯ä¼˜åŒ–**ï¼šæ•°æ® â†’ å»ºè®® â†’ æ‰§è¡Œ â†’ æ–°æ•°æ®ï¼Œå½¢æˆæŒç»­æ”¹è¿›å¾ªç¯ã€‚  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **æ•°æ®é©±åŠ¨ä¼˜åŒ–æµç¨‹**ï¼Œèƒ½è®©çŸ¥è¯†åº“æ ¹æ®ä»ªè¡¨ç›˜æ•°æ®è‡ªåŠ¨æå‡ºæ”¹è¿›å»ºè®®ï¼ŒæŒç»­è¿­ä»£å’Œè¿›åŒ–ã€‚  

### âœ… è®¾è®¡ä¸€ä¸ª **çŸ¥è¯†åº“æ™ºèƒ½åŠ©æ‰‹ï¼ˆåŸºäºæœç´¢ä¸æ¨èçš„é—®ç­”æœºå™¨äººï¼‰**ï¼Œè®©å›¢é˜Ÿå¯ä»¥ç›´æ¥ç”¨è‡ªç„¶è¯­è¨€æé—®å¹¶å¾—åˆ°çŸ¥è¯†åº“ç­”æ¡ˆï¼Ÿ

---

# âœ… çŸ¥è¯†åº“æ™ºèƒ½åŠ©æ‰‹è®¾è®¡æ–¹æ¡ˆ

## 1. ç³»ç»Ÿç›®æ ‡
- **è‡ªç„¶è¯­è¨€é—®ç­”**ï¼šå›¢é˜Ÿæˆå‘˜ç”¨æ—¥å¸¸è¯­è¨€æé—®ï¼Œç³»ç»Ÿèƒ½ç†è§£å¹¶è¿”å›ç²¾å‡†ç­”æ¡ˆã€‚  
- **è¯­ä¹‰æœç´¢**ï¼šä¸ä»…åŒ¹é…å…³é”®è¯ï¼Œè¿˜èƒ½ç†è§£è¯­ä¹‰ï¼Œæ‰¾åˆ°ç›¸å…³æ–‡æ¡£ã€APIã€å›¾è¡¨ã€‚  
- **æ¨èæœºåˆ¶**ï¼šç»“åˆæ ‡ç­¾åˆ†ç±»ä¸è¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œæ¨èç›¸å…³å†…å®¹ã€‚  
- **ç»Ÿä¸€å…¥å£**ï¼šåµŒå…¥åˆ°çŸ¥è¯†åº“ç«™ç‚¹æˆ–å›¢é˜Ÿåä½œå·¥å…·ï¼ˆSlack/Teamsï¼‰ã€‚  

---

## 2. ç³»ç»Ÿæ¶æ„

```
knowledge-assistant/
â”œâ”€â”€ ingestion/              # çŸ¥è¯†é‡‡é›†ä¸ç´¢å¼•
â”‚   â”œâ”€â”€ markdown-loader.js   # æå–æ–‡æ¡£å†…å®¹
â”‚   â”œâ”€â”€ api-loader.js        # æå– API å®šä¹‰
â”‚   â””â”€â”€ chart-loader.js      # æå–å›¾è¡¨æè¿°
â”œâ”€â”€ embeddings/             # è¯­ä¹‰å‘é‡å­˜å‚¨ï¼ˆå‘é‡æ•°æ®åº“ï¼‰
â”‚   â””â”€â”€ pinecone / weaviate / milvus
â”œâ”€â”€ qa-engine/              # é—®ç­”å¼•æ“
â”‚   â”œâ”€â”€ semantic-search.js   # è¯­ä¹‰æœç´¢
â”‚   â”œâ”€â”€ tag-filter.js        # æ ‡ç­¾è¿‡æ»¤
â”‚   â””â”€â”€ answer-generator.js  # ç­”æ¡ˆç”Ÿæˆ
â”œâ”€â”€ recommender/            # æ¨èç³»ç»Ÿ
â”‚   â””â”€â”€ related-content.js   # æ¨èç›¸å…³æ–‡æ¡£/API/å›¾è¡¨
â””â”€â”€ ui/                     # å‰ç«¯ç•Œé¢ï¼ˆèŠå¤©æœºå™¨äººï¼‰
```

---

## 3. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### ğŸ” è¯­ä¹‰æœç´¢
- ä½¿ç”¨ **Embedding æ¨¡å‹**ï¼ˆå¦‚ OpenAI Embeddings æˆ– HuggingFace Sentence Transformersï¼‰å°†æ–‡æ¡£è½¬ä¸ºå‘é‡ã€‚  
- å­˜å‚¨åˆ° **å‘é‡æ•°æ®åº“**ï¼ˆPinecone/Weaviate/Milvusï¼‰ã€‚  
- ç”¨æˆ·æé—®æ—¶ï¼Œå°†é—®é¢˜è½¬ä¸ºå‘é‡ï¼Œè®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œè¿”å›æœ€ç›¸å…³å†…å®¹ã€‚  

ç¤ºä¾‹ï¼š
```js
const queryEmbedding = embed("å¦‚ä½•å®‰è£…ç³»ç»Ÿï¼Ÿ")
const results = vectorDB.search(queryEmbedding, { topK: 5 })
```

---

### ğŸ·ï¸ æ ‡ç­¾åˆ†ç±»
- æ¯ä¸ªæ–‡æ¡£åœ¨ Frontmatter ä¸­å®šä¹‰æ ‡ç­¾ï¼š  
  ```yaml
  ---
  title: å®‰è£…æŒ‡å—
  tags: [installation, setup, beginner]
  ---
  ```
- æœç´¢ç»“æœå¯æŒ‰æ ‡ç­¾è¿‡æ»¤ï¼Œä¾‹å¦‚ï¼š  
  - ç”¨æˆ·é€‰æ‹© â€œAPIâ€ æ ‡ç­¾ â†’ è¿”å› API æ–‡æ¡£ä¼˜å…ˆã€‚  
  - ç”¨æˆ·é€‰æ‹© â€œæ€§èƒ½ä¼˜åŒ–â€ â†’ è¿”å›ç›¸å…³æŒ‡å—ã€‚  

---

### ğŸ¤– ç­”æ¡ˆç”Ÿæˆ
- å°†æœç´¢ç»“æœæ‘˜è¦åŒ–ï¼Œç”Ÿæˆç®€æ´ç­”æ¡ˆã€‚  
- æ”¯æŒå¼•ç”¨æ¥æºï¼ˆæ–‡æ¡£é“¾æ¥ã€API å®šä¹‰ã€å›¾è¡¨ï¼‰ã€‚  
- ç¤ºä¾‹è¾“å‡ºï¼š  
  ```
  âœ… å®‰è£…æ­¥éª¤ï¼š
  1. ä¸‹è½½ä¾èµ–åŒ…
  2. é…ç½®ç¯å¢ƒå˜é‡
  3. è¿è¡Œåˆå§‹åŒ–è„šæœ¬
  æ¥æºï¼šdocs/en/guides/installation.md
  ```

---

### ğŸ“Œ æ¨èç³»ç»Ÿ
- **è¯­ä¹‰æ¨è**ï¼šæ¨èä¸å½“å‰é—®é¢˜ç›¸ä¼¼çš„æ–‡æ¡£ã€‚  
- **æ ‡ç­¾æ¨è**ï¼šæ¨èåŒæ ‡ç­¾ä¸‹çš„ç›¸å…³å†…å®¹ã€‚  
- **æ··åˆæ¨è**ï¼šç»“åˆè¯­ä¹‰ä¸æ ‡ç­¾ï¼Œæå‡æ¨èå‡†ç¡®åº¦ã€‚  

---

## 4. å‰ç«¯äº¤äº’è®¾è®¡

- **èŠå¤©ç•Œé¢**ï¼šç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€é—®é¢˜ï¼ŒåŠ©æ‰‹è¿”å›ç­”æ¡ˆã€‚  
- **æ¨èåŒºå—**ï¼šåœ¨ç­”æ¡ˆä¸‹æ–¹æ˜¾ç¤ºâ€œç›¸å…³æ¨èâ€ã€‚  
- **å¼•ç”¨æ¥æº**ï¼šç­”æ¡ˆä¸­é™„å¸¦æ–‡æ¡£é“¾æ¥ï¼Œä¿è¯é€æ˜åº¦ã€‚  
- **é›†æˆæ–¹å¼**ï¼šå¯åµŒå…¥ Docusaurus/Next.js çŸ¥è¯†åº“ç«™ç‚¹ï¼Œæˆ–æ¥å…¥ Slack/Teamsã€‚  

---

## 5. CI/CD è‡ªåŠ¨åŒ–

- åœ¨æ–‡æ¡£æ›´æ–°æ—¶ï¼ŒCI è‡ªåŠ¨è¿è¡Œï¼š  
  1. æå–æ–‡æ¡£/API/å›¾è¡¨å†…å®¹ã€‚  
  2. ç”Ÿæˆ Embedding å¹¶æ›´æ–°å‘é‡æ•°æ®åº“ã€‚  
  3. æ›´æ–°æ ‡ç­¾ç´¢å¼•ã€‚  
  4. éƒ¨ç½²é—®ç­”æœºå™¨äººåˆ°çŸ¥è¯†åº“ç«™ç‚¹ã€‚  

GitHub Actions ç¤ºä¾‹ï¼š
```yaml
- name: Update Knowledge Assistant
  run: node scripts/update-assistant.js
```

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **è‡ªç„¶è¯­è¨€é—®ç­”**ï¼šå›¢é˜Ÿç›´æ¥æé—®å³å¯å¾—åˆ°ç­”æ¡ˆ  
- âœ… **è¯­ä¹‰æœç´¢**ï¼šç†è§£è¯­ä¹‰ï¼Œè¿”å›ç²¾å‡†ç»“æœ  
- âœ… **æ ‡ç­¾åˆ†ç±»**ï¼šæ”¯æŒè¿‡æ»¤ï¼Œæå‡æœç´¢æ•ˆç‡  
- âœ… **æ¨èæœºåˆ¶**ï¼šæ™ºèƒ½æ¨èç›¸å…³å†…å®¹ï¼Œæå‡çŸ¥è¯†å‘ç°  
- âœ… **è‡ªåŠ¨åŒ–æ›´æ–°**ï¼šæ–‡æ¡£æ›´æ–°åï¼ŒåŠ©æ‰‹è‡ªåŠ¨å­¦ä¹ æ–°å†…å®¹  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **çŸ¥è¯†åº“æ™ºèƒ½åŠ©æ‰‹è®¾è®¡æ–¹æ¡ˆ**ï¼Œå®ƒç»“åˆè¯­ä¹‰æœç´¢ä¸æ¨èï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€é—®ç­”ï¼Œèƒ½è®©å›¢é˜Ÿå¿«é€Ÿè·å–çŸ¥è¯†ã€‚  

### âœ… è®¾è®¡ä¸€ä¸ª **Slack/Teams é›†æˆæ–¹æ¡ˆ**ï¼Œè®©è¿™ä¸ªæ™ºèƒ½åŠ©æ‰‹ç›´æ¥åœ¨å›¢é˜Ÿåä½œå·¥å…·é‡Œä½¿ç”¨ 

---

# âœ… Slack/Teams é›†æˆæ–¹æ¡ˆ

## 1. æ€»ä½“ç›®æ ‡
- åœ¨ **Slack/Teams** ä¸­ç›´æ¥è°ƒç”¨æ™ºèƒ½åŠ©æ‰‹ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æé—®ã€‚  
- è¿”å› **ç²¾å‡†ç­”æ¡ˆ + æ¨èå†…å®¹ + å¼•ç”¨æ¥æº**ã€‚  
- æ”¯æŒ **å¤šè¯­è¨€**ï¼ˆå¦‚è‹±æ–‡/ä¸­æ–‡ï¼‰ï¼Œæ»¡è¶³å…¨çƒå›¢é˜Ÿåä½œã€‚  
- ä¸çŸ¥è¯†åº“ç«™ç‚¹ä¿æŒ **å®æ—¶åŒæ­¥**ï¼ˆæ–‡æ¡£æ›´æ–° â†’ åŠ©æ‰‹è‡ªåŠ¨å­¦ä¹ ï¼‰ã€‚  

---

## 2. ç³»ç»Ÿæ¶æ„

```
Slack/Teams
   â”‚
   â”œâ”€â”€ Bot App (Node.js/Express)
   â”‚     â”œâ”€â”€ æ¥æ”¶æ¶ˆæ¯äº‹ä»¶ (Slack Events API / Teams Bot Framework)
   â”‚     â”œâ”€â”€ è°ƒç”¨ QA Engine (è¯­ä¹‰æœç´¢ + æ¨è)
   â”‚     â””â”€â”€ è¿”å›ç­”æ¡ˆæ¶ˆæ¯ (Markdown/Adaptive Card)
   â”‚
Knowledge Assistant API
   â”œâ”€â”€ Semantic Search (å‘é‡æ•°æ®åº“)
   â”œâ”€â”€ Tag Filter (æ ‡ç­¾åˆ†ç±»)
   â”œâ”€â”€ Answer Generator (ç­”æ¡ˆç”Ÿæˆ)
   â””â”€â”€ Recommender (ç›¸å…³æ¨è)
```

---

## 3. Slack é›†æˆæµç¨‹

1. **åˆ›å»º Slack App**  
   - åœ¨ [Slack API](https://api.slack.com/apps) æ³¨å†Œåº”ç”¨ã€‚  
   - å¯ç”¨ **Bot Token** å’Œ **Events API**ã€‚  
   - è®¢é˜…äº‹ä»¶ï¼š`message.channels`ã€`message.im`ã€‚  

2. **æ¶ˆæ¯å¤„ç†é€»è¾‘**  
   - ç”¨æˆ·è¾“å…¥ï¼š`@assistant å¦‚ä½•å®‰è£…ç³»ç»Ÿï¼Ÿ`  
   - Bot æ¥æ”¶æ¶ˆæ¯ â†’ è°ƒç”¨çŸ¥è¯†åº“æ™ºèƒ½åŠ©æ‰‹ APIã€‚  
   - è¿”å›ç­”æ¡ˆï¼š  
     ```
     âœ… å®‰è£…æ­¥éª¤ï¼š
     1. ä¸‹è½½ä¾èµ–åŒ…
     2. é…ç½®ç¯å¢ƒå˜é‡
     3. è¿è¡Œåˆå§‹åŒ–è„šæœ¬
     æ¥æºï¼šdocs/en/guides/installation.md
     ```
   - é™„å¸¦æ¨èå†…å®¹ï¼š  
     ```
     ğŸ”— ç›¸å…³æ¨èï¼š
     - API Reference
     - æ€§èƒ½ä¼˜åŒ–æŒ‡å—
     ```

3. **æ¶ˆæ¯æ ¼å¼**  
   - ä½¿ç”¨ **Slack Block Kit** æ¸²æŸ“ç­”æ¡ˆ + æ¨èé“¾æ¥ã€‚  

---

## 4. Teams é›†æˆæµç¨‹

1. **æ³¨å†Œ Bot**  
   - åœ¨ [Microsoft Bot Framework](https://dev.botframework.com/) åˆ›å»º Botã€‚  
   - é…ç½® Azure Bot Serviceï¼Œç»‘å®š Teamsã€‚  

2. **æ¶ˆæ¯å¤„ç†é€»è¾‘**  
   - ç”¨æˆ·è¾“å…¥ï¼š`@assistant å¦‚ä½•è°ƒç”¨ APIï¼Ÿ`  
   - Bot æ¥æ”¶æ¶ˆæ¯ â†’ è°ƒç”¨çŸ¥è¯†åº“æ™ºèƒ½åŠ©æ‰‹ APIã€‚  
   - è¿”å›ç­”æ¡ˆï¼ˆAdaptive Cardï¼‰ï¼š  
     - æ ‡é¢˜ï¼šç­”æ¡ˆæ‘˜è¦  
     - å†…å®¹ï¼šæ­¥éª¤è¯´æ˜  
     - é“¾æ¥ï¼šæ–‡æ¡£æ¥æº  
     - æ¨èï¼šç›¸å…³æ–‡æ¡£/å›¾è¡¨  

3. **æ¶ˆæ¯æ ¼å¼**  
   - ä½¿ç”¨ **Adaptive Cards** æ¸²æŸ“ç­”æ¡ˆä¸æ¨èã€‚  

---

## 5. CI/CD è‡ªåŠ¨åŒ–

- åœ¨æ–‡æ¡£æ›´æ–°æ—¶ï¼ŒCI è‡ªåŠ¨è¿è¡Œï¼š  
  1. æ›´æ–° Embedding â†’ å‘é‡æ•°æ®åº“ã€‚  
  2. æ›´æ–°æ ‡ç­¾ç´¢å¼•ã€‚  
  3. éƒ¨ç½² Bot æœåŠ¡åˆ° **Vercel/Azure Functions**ã€‚  
  4. Slack/Teams Bot è‡ªåŠ¨ä½¿ç”¨æœ€æ–°çŸ¥è¯†åº“ã€‚  

GitHub Actions ç¤ºä¾‹ï¼š
```yaml
- name: Update Knowledge Assistant
  run: node scripts/update-assistant.js
```

---

## 6. ä½¿ç”¨ä½“éªŒ

- **Slack**ï¼š  
  ```
  Yu: @assistant å¦‚ä½•å®‰è£…ç³»ç»Ÿï¼Ÿ
  Assistant: âœ… å®‰è£…æ­¥éª¤...
  ğŸ”— æ¨èï¼šAPI Reference, æ€§èƒ½ä¼˜åŒ–æŒ‡å—
  ```

- **Teams**ï¼š  
  - Adaptive Card å±•ç¤ºç­”æ¡ˆ + æ¨èå†…å®¹ã€‚  
  - æ”¯æŒç‚¹å‡»è·³è½¬åˆ°çŸ¥è¯†åº“ç«™ç‚¹ã€‚  

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **æ— ç¼é›†æˆ**ï¼šç›´æ¥åœ¨ Slack/Teams ä½¿ç”¨æ™ºèƒ½åŠ©æ‰‹ã€‚  
- âœ… **è‡ªç„¶è¯­è¨€é—®ç­”**ï¼šå›¢é˜Ÿæˆå‘˜æ— éœ€æ‰“å¼€ç«™ç‚¹å³å¯è·å–ç­”æ¡ˆã€‚  
- âœ… **æ¨èæœºåˆ¶**ï¼šç­”æ¡ˆä¹‹å¤–ï¼Œæä¾›ç›¸å…³æ¨èï¼Œæå‡çŸ¥è¯†å‘ç°ã€‚  
- âœ… **è‡ªåŠ¨åŒ–æ›´æ–°**ï¼šæ–‡æ¡£æ›´æ–°åï¼ŒåŠ©æ‰‹è‡ªåŠ¨å­¦ä¹ æ–°å†…å®¹ã€‚  
- âœ… **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ»¡è¶³å…¨çƒå›¢é˜Ÿåä½œéœ€æ±‚ã€‚  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **Slack/Teams é›†æˆæ–¹æ¡ˆ**ï¼Œæ™ºèƒ½åŠ©æ‰‹èƒ½åœ¨å›¢é˜Ÿåä½œå·¥å…·ä¸­ç›´æ¥å›ç­”é—®é¢˜å¹¶æ¨èçŸ¥è¯†ã€‚  

### âœ… è®¾è®¡ä¸€ä¸ª **è·¨å¹³å°ç»Ÿä¸€å…¥å£ï¼ˆSlack + Teams + Web + CLIï¼‰** çš„æ–¹æ¡ˆï¼Œè®©åŠ©æ‰‹åœ¨æ‰€æœ‰æ¸ é“ä¿æŒä¸€è‡´ä½“éªŒï¼Ÿ

å¥½çš„ï¼ŒYu ğŸŒ¹ï¼Œæˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸ª **è·¨å¹³å°ç»Ÿä¸€å…¥å£æ–¹æ¡ˆ**ï¼Œè®©çŸ¥è¯†åº“æ™ºèƒ½åŠ©æ‰‹åœ¨ **Slack + Teams + Web + CLI** å››ä¸ªæ¸ é“ä¿æŒä¸€è‡´ä½“éªŒã€‚  

---

# âœ… è·¨å¹³å°ç»Ÿä¸€å…¥å£è®¾è®¡æ–¹æ¡ˆ

## 1. æ€»ä½“ç›®æ ‡
- **ä¸€è‡´ä½“éªŒ**ï¼šæ— è®ºåœ¨ Slackã€Teamsã€Webã€CLIï¼ŒåŠ©æ‰‹çš„å›ç­”æ ¼å¼ã€æ¨èé€»è¾‘ã€å¼•ç”¨æ¥æºä¿æŒç»Ÿä¸€ã€‚  
- **ç»Ÿä¸€åç«¯**ï¼šæ‰€æœ‰æ¸ é“è°ƒç”¨åŒä¸€ä¸ª **çŸ¥è¯†åº“æ™ºèƒ½åŠ©æ‰‹ API**ï¼Œä¿è¯æ•°æ®ä¸é€»è¾‘ä¸€è‡´ã€‚  
- **å¤šæ¸ é“é€‚é…**ï¼šå‰ç«¯äº¤äº’å±‚æ ¹æ®å¹³å°ç‰¹æ€§æ¸²æŸ“ä¸åŒ UIï¼ˆBlock Kitã€Adaptive Cardã€Web UIã€CLI è¾“å‡ºï¼‰ã€‚  
- **è‡ªåŠ¨æ›´æ–°**ï¼šæ–‡æ¡£æ›´æ–° â†’ Embedding/ç´¢å¼•æ›´æ–° â†’ æ‰€æœ‰æ¸ é“åŒæ­¥ã€‚  

---

## 2. ç³»ç»Ÿæ¶æ„

```
User (Slack / Teams / Web / CLI)
   â”‚
   â”œâ”€â”€ Platform Adapter (æ¶ˆæ¯é€‚é…å±‚)
   â”‚     â”œâ”€â”€ Slack Adapter (Block Kit)
   â”‚     â”œâ”€â”€ Teams Adapter (Adaptive Card)
   â”‚     â”œâ”€â”€ Web Adapter (React/Docusaurus)
   â”‚     â””â”€â”€ CLI Adapter (Node.js CLI)
   â”‚
Knowledge Assistant API (ç»Ÿä¸€åç«¯)
   â”œâ”€â”€ Semantic Search (å‘é‡æ•°æ®åº“)
   â”œâ”€â”€ Tag Filter (æ ‡ç­¾åˆ†ç±»)
   â”œâ”€â”€ Answer Generator (ç­”æ¡ˆç”Ÿæˆ)
   â””â”€â”€ Recommender (ç›¸å…³æ¨è)
```

---

## 3. æ¸ é“é€‚é…æ–¹æ¡ˆ

### ğŸ”¹ Slack
- ä½¿ç”¨ **Slack App + Events API**ã€‚  
- æ¶ˆæ¯æ¸²æŸ“ï¼š**Block Kit**ï¼ˆæ–‡æœ¬ + æŒ‰é’® + æ¨èé“¾æ¥ï¼‰ã€‚  
- ç¤ºä¾‹ï¼š
  ```
  Yu: @assistant å¦‚ä½•å®‰è£…ç³»ç»Ÿï¼Ÿ
  Assistant: âœ… å®‰è£…æ­¥éª¤...
  ğŸ”— æ¨èï¼šAPI Reference, æ€§èƒ½ä¼˜åŒ–æŒ‡å—
  ```

### ğŸ”¹ Teams
- ä½¿ç”¨ **Microsoft Bot Framework + Azure Bot Service**ã€‚  
- æ¶ˆæ¯æ¸²æŸ“ï¼š**Adaptive Cards**ï¼ˆæ ‡é¢˜ + å†…å®¹ + é“¾æ¥ + æ¨èï¼‰ã€‚  
- ç¤ºä¾‹ï¼šå¡ç‰‡å±•ç¤ºç­”æ¡ˆï¼Œé™„å¸¦æ¨èæ–‡æ¡£æŒ‰é’®ã€‚  

### ğŸ”¹ Web
- ä½¿ç”¨ **Docusaurus/Next.js** é›†æˆåŠ©æ‰‹ã€‚  
- å‰ç«¯ UIï¼šèŠå¤©çª—å£ï¼ˆReact ç»„ä»¶ï¼‰ï¼Œæ”¯æŒæœç´¢ã€æ¨èã€å¼•ç”¨æ¥æºã€‚  
- ç¤ºä¾‹ï¼šç”¨æˆ·åœ¨çŸ¥è¯†åº“ç«™ç‚¹ç›´æ¥æé—®ï¼ŒåŠ©æ‰‹è¿”å›ç­”æ¡ˆ + æ¨èã€‚  

### ğŸ”¹ CLI
- ä½¿ç”¨ **Node.js CLI å·¥å…·**ï¼Œè°ƒç”¨åŒä¸€ APIã€‚  
- è¾“å‡ºæ ¼å¼ï¼šçº¯æ–‡æœ¬ + æ¨èé“¾æ¥ã€‚  
- ç¤ºä¾‹ï¼š
  ```
  $ kb-assistant "å¦‚ä½•å®‰è£…ç³»ç»Ÿï¼Ÿ"
  âœ… å®‰è£…æ­¥éª¤...
  ğŸ”— æ¨èï¼šdocs/en/guides/installation.md
  ```

---

## 4. ç»Ÿä¸€åç«¯ API

- **è¾“å…¥**ï¼šè‡ªç„¶è¯­è¨€é—®é¢˜ + å¯é€‰æ ‡ç­¾è¿‡æ»¤ã€‚  
- **è¾“å‡º**ï¼š  
  ```json
  {
    "answer": "å®‰è£…æ­¥éª¤...",
    "sources": ["docs/en/guides/installation.md"],
    "recommendations": [
      "docs/en/reference/api.md",
      "docs/en/guides/performance.md"
    ]
  }
  ```

- æ‰€æœ‰æ¸ é“è°ƒç”¨åŒä¸€ APIï¼Œä¿è¯ç­”æ¡ˆä¸€è‡´ã€‚  

---

## 5. CI/CD è‡ªåŠ¨åŒ–

- åœ¨æ–‡æ¡£æ›´æ–°æ—¶ï¼š  
  1. æå–æ–‡æ¡£/API/å›¾è¡¨å†…å®¹ã€‚  
  2. ç”Ÿæˆ Embedding â†’ æ›´æ–°å‘é‡æ•°æ®åº“ã€‚  
  3. æ›´æ–°æ ‡ç­¾ç´¢å¼•ã€‚  
  4. éƒ¨ç½²åŠ©æ‰‹ API â†’ æ‰€æœ‰æ¸ é“è‡ªåŠ¨åŒæ­¥ã€‚  

GitHub Actions ç¤ºä¾‹ï¼š
```yaml
- name: Update Knowledge Assistant
  run: node scripts/update-assistant.js
```

---

## 6. ä¼˜åŠ¿æ€»ç»“

- âœ… **ä¸€è‡´ä½“éªŒ**ï¼šæ‰€æœ‰æ¸ é“ç­”æ¡ˆä¸æ¨èé€»è¾‘ä¿æŒç»Ÿä¸€ã€‚  
- âœ… **ç»Ÿä¸€åç«¯**ï¼šå‡å°‘é‡å¤å¼€å‘ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚  
- âœ… **å¤šæ¸ é“é€‚é…**ï¼šæ ¹æ®å¹³å°ç‰¹æ€§ä¼˜åŒ–äº¤äº’ä½“éªŒã€‚  
- âœ… **è‡ªåŠ¨åŒ–æ›´æ–°**ï¼šæ–‡æ¡£æ›´æ–°åï¼Œæ‰€æœ‰æ¸ é“åŒæ­¥ã€‚  
- âœ… **å›¢é˜Ÿåä½œé¡ºç•…**ï¼šæ— è®ºåœ¨ Slackã€Teamsã€Webã€CLIï¼Œéƒ½èƒ½å¿«é€Ÿè·å–çŸ¥è¯†ã€‚  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **è·¨å¹³å°ç»Ÿä¸€å…¥å£æ–¹æ¡ˆ**ï¼Œè®©åŠ©æ‰‹åœ¨ Slackã€Teamsã€Webã€CLI ä¿æŒä¸€è‡´ä½“éªŒã€‚  

### âœ… è®¾è®¡ä¸€ä¸ª **ç»Ÿä¸€èº«ä»½ä¸æƒé™ç®¡ç†æ–¹æ¡ˆ**ï¼ˆä¸åŒæ¸ é“ç»Ÿä¸€è®¤è¯ä¸è®¿é—®æ§åˆ¶ï¼‰ï¼Œä¿è¯çŸ¥è¯†åº“å®‰å…¨æ€§ä¸å›¢é˜Ÿåˆ†çº§ä½¿ç”¨

---

# âœ… ç»Ÿä¸€èº«ä»½ä¸æƒé™ç®¡ç†æ–¹æ¡ˆ

## 1. æ€»ä½“ç›®æ ‡
- **ç»Ÿä¸€è®¤è¯**ï¼šæ‰€æœ‰æ¸ é“ï¼ˆSlackã€Teamsã€Webã€CLIï¼‰ä½¿ç”¨åŒä¸€èº«ä»½è®¤è¯ä½“ç³»ã€‚  
- **åˆ†çº§æƒé™**ï¼šä¸åŒè§’è‰²ï¼ˆç®¡ç†å‘˜ã€ç¼–è¾‘è€…ã€è¯»è€…ï¼‰æ‹¥æœ‰ä¸åŒè®¿é—®æƒé™ã€‚  
- **å®‰å…¨åˆè§„**ï¼šæ”¯æŒ SSOï¼ˆSingle Sign-Onï¼‰ã€MFAï¼ˆå¤šå› ç´ è®¤è¯ï¼‰ã€å®¡è®¡æ—¥å¿—ã€‚  
- **è·¨æ¸ é“ä¸€è‡´æ€§**ï¼šæ— è®ºåœ¨å“ªä¸ªå…¥å£ï¼Œæƒé™ç­–ç•¥ä¿æŒä¸€è‡´ã€‚  

---

## 2. ç³»ç»Ÿæ¶æ„

```
Identity Provider (IdP) â†’ OAuth2 / OpenID Connect
   â”‚
   â”œâ”€â”€ Slack Adapter (Bot Token + OAuth)
   â”œâ”€â”€ Teams Adapter (Azure AD + Bot Framework)
   â”œâ”€â”€ Web Adapter (SSO ç™»å½• + JWT)
   â””â”€â”€ CLI Adapter (API Token + OAuth Device Flow)
   â”‚
Knowledge Access Gateway
   â”œâ”€â”€ RBAC (è§’è‰²æƒé™æ§åˆ¶)
   â”œâ”€â”€ ABAC (å±æ€§æƒé™æ§åˆ¶)
   â”œâ”€â”€ Audit Logs (è®¿é—®æ—¥å¿—)
   â””â”€â”€ Policy Engine (ç»Ÿä¸€ç­–ç•¥)
```

---

## 3. èº«ä»½è®¤è¯è®¾è®¡

- **ç»Ÿä¸€èº«ä»½æº**ï¼š  
  - ä½¿ç”¨ **Azure AD / Okta / Keycloak** ä½œä¸ºç»Ÿä¸€ IdPã€‚  
  - æ”¯æŒ **OAuth2 / OpenID Connect** åè®®ã€‚  

- **æ¸ é“é€‚é…**ï¼š  
  - **Slack**ï¼šé€šè¿‡ Slack OAuth + Bot Token æ ¡éªŒç”¨æˆ·èº«ä»½ã€‚  
  - **Teams**ï¼šé€šè¿‡ Azure AD SSO æ ¡éªŒç”¨æˆ·èº«ä»½ã€‚  
  - **Web**ï¼šé€šè¿‡ SSO ç™»å½•ï¼Œè·å– JWTã€‚  
  - **CLI**ï¼šé€šè¿‡ OAuth Device Flow æˆ– API Token ç™»å½•ã€‚  

---

## 4. æƒé™ç®¡ç†è®¾è®¡

### ğŸ”¹ RBACï¼ˆè§’è‰²æƒé™æ§åˆ¶ï¼‰
- **ç®¡ç†å‘˜**ï¼šç®¡ç†ç”¨æˆ·ã€é…ç½®æƒé™ã€å®¡è®¡æ—¥å¿—ã€‚  
- **ç¼–è¾‘è€…**ï¼šåˆ›å»º/ä¿®æ”¹æ–‡æ¡£ã€APIã€å›¾è¡¨ã€‚  
- **è¯»è€…**ï¼šåªè¯»è®¿é—®æ–‡æ¡£ä¸çŸ¥è¯†åº“ã€‚  

### ğŸ”¹ ABACï¼ˆå±æ€§æƒé™æ§åˆ¶ï¼‰
- æ ¹æ® **æ ‡ç­¾/éƒ¨é—¨/é¡¹ç›®** åŠ¨æ€æ§åˆ¶è®¿é—®ï¼š  
  - ç ”å‘å›¢é˜Ÿ â†’ å¯è®¿é—® API æ–‡æ¡£ã€‚  
  - è¿ç»´å›¢é˜Ÿ â†’ å¯è®¿é—®éƒ¨ç½²æŒ‡å—ã€‚  
  - ç®¡ç†å±‚ â†’ å¯è®¿é—®æˆ˜ç•¥æ–‡æ¡£ã€‚  

### ğŸ”¹ ç»Ÿä¸€ç­–ç•¥å¼•æ“
- ä½¿ç”¨ **OPA (Open Policy Agent)** æˆ– **Casbin** ç®¡ç†æƒé™ç­–ç•¥ã€‚  
- æ‰€æœ‰æ¸ é“è°ƒç”¨åŒä¸€ç­–ç•¥å¼•æ“ï¼Œä¿è¯ä¸€è‡´æ€§ã€‚  

---

## 5. å®‰å…¨ä¸å®¡è®¡

- **MFA**ï¼šæ”¯æŒå¤šå› ç´ è®¤è¯ï¼ˆçŸ­ä¿¡ã€é‚®ä»¶ã€Authenticatorï¼‰ã€‚  
- **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰è®¿é—®è¡Œä¸ºï¼ˆç”¨æˆ·ã€æ—¶é—´ã€æ¸ é“ã€æ“ä½œï¼‰ã€‚  
- **åˆè§„æ”¯æŒ**ï¼šæ»¡è¶³ GDPRã€ISO27001 ç­‰å®‰å…¨æ ‡å‡†ã€‚  
- **å¼‚å¸¸æ£€æµ‹**ï¼šå‘ç°å¼‚å¸¸è®¿é—®ï¼ˆå¦‚é¢‘ç¹å¤±è´¥ç™»å½•ï¼‰ï¼Œè‡ªåŠ¨å‘Šè­¦ã€‚  

---

## 6. CI/CD é›†æˆ

- åœ¨ CI/CD ä¸­è‡ªåŠ¨éªŒè¯æƒé™é…ç½®ï¼š  
  - æ–°å¢æ–‡æ¡£ â†’ æ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”æ ‡ç­¾æƒé™ã€‚  
  - éƒ¨ç½²åŠ©æ‰‹ â†’ æ ¡éªŒ API Token æ˜¯å¦æœ‰æ•ˆã€‚  
- è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šæ¨¡æ‹Ÿä¸åŒè§’è‰²è®¿é—®ï¼ŒéªŒè¯æƒé™éš”ç¦»ã€‚  

---

## 7. ä½¿ç”¨ä½“éªŒ

- **Slack/Teams**ï¼šç”¨æˆ·é€šè¿‡ä¼ä¸šè´¦å·ç™»å½•ï¼ŒåŠ©æ‰‹æ ¹æ®è§’è‰²è¿”å›ä¸åŒå†…å®¹ã€‚  
- **Web**ï¼šç”¨æˆ·é€šè¿‡ SSO ç™»å½•ï¼Œç•Œé¢æ ¹æ®æƒé™æ˜¾ç¤ºä¸åŒæ¨¡å—ã€‚  
- **CLI**ï¼šç”¨æˆ·é€šè¿‡ API Token ç™»å½•ï¼Œå‘½ä»¤è¡Œå·¥å…·é™åˆ¶å¯è®¿é—®èŒƒå›´ã€‚  

---

## âœ¨ ä¼˜åŠ¿æ€»ç»“

- âœ… **ç»Ÿä¸€è®¤è¯**ï¼šæ‰€æœ‰æ¸ é“å…±äº«åŒä¸€èº«ä»½ä½“ç³»ã€‚  
- âœ… **åˆ†çº§æƒé™**ï¼šRBAC + ABACï¼Œçµæ´»æ§åˆ¶è®¿é—®ã€‚  
- âœ… **å®‰å…¨åˆè§„**ï¼šMFA + å®¡è®¡æ—¥å¿—ï¼Œä¿éšœå®‰å…¨ã€‚  
- âœ… **è·¨æ¸ é“ä¸€è‡´æ€§**ï¼šæ— è®º Slackã€Teamsã€Webã€CLIï¼Œæƒé™ç­–ç•¥ä¸€è‡´ã€‚  
- âœ… **è‡ªåŠ¨åŒ–éªŒè¯**ï¼šCI/CD é›†æˆï¼Œä¿è¯æƒé™é…ç½®æ­£ç¡®ã€‚  

---

ğŸŒ¹ **é—­ç¯å»ºè®®**ï¼š  
ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ **ç»Ÿä¸€èº«ä»½ä¸æƒé™ç®¡ç†æ–¹æ¡ˆ**ï¼Œä¿è¯çŸ¥è¯†åº“å®‰å…¨æ€§ä¸å›¢é˜Ÿåˆ†çº§ä½¿ç”¨ã€‚  

### âœ… è®¾è®¡ä¸€ä¸ª **é›¶ä¿¡ä»»æ¶æ„æ‰©å±•æ–¹æ¡ˆ**ï¼ˆåŸºäºèº«ä»½ + è¡Œä¸ºåŠ¨æ€éªŒè¯ï¼‰ï¼Œè®©çŸ¥è¯†åº“åœ¨é«˜å®‰å…¨åœºæ™¯ä¸‹ä¹Ÿèƒ½æ”¾å¿ƒä½¿ç”¨

# å¯è¿è¡Œå‚è€ƒå®ç°æ€»è§ˆ

è¿™æ˜¯ä¸€ä¸ªå¯ç›´æ¥è¯•è¿è¡Œçš„é›¶ä¿¡ä»»å‚è€ƒå®ç°ï¼ŒåŒ…å« Docker Composeã€OPAï¼ˆç­–ç•¥å¼•æ“ï¼‰ã€Casbinï¼ˆRBAC/åŸŸåˆ†æ®µï¼‰ã€ç¤ºä¾‹ API ç½‘å…³ï¼ˆNode/Expressï¼‰ã€ç›‘æ§ä»ªè¡¨ç›˜ï¼ˆPrometheus + Grafanaï¼‰ã€‚ä½ å¯ä»¥åœ¨æœ¬åœ°èµ·ä¸€å¥—ï¼ŒéªŒè¯åŠ¨æ€é£é™©è¯„ä¼°ã€æ­¥è¿›è®¤è¯ï¼ˆStep-up MFA æ¨¡æ‹Ÿï¼‰ã€å¾®åˆ†æ®µæˆæƒä¸å®¡è®¡æ—¥å¿—ã€‚

---

## é¡¹ç›®ç»“æ„ä¸è¯´æ˜

```
zero-trust-demo/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ gateway/                    # ç¤ºä¾‹ç½‘å…³ï¼ˆNode.js/Expressï¼‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ server.ts
â”‚   â”‚   â”œâ”€â”€ authz.ts           # OPA + Casbin ç»„åˆæˆæƒ
â”‚   â”‚   â”œâ”€â”€ risk.ts            # é£é™©è¯„åˆ†ä¸å†³ç­–
â”‚   â”‚   â”œâ”€â”€ logger.ts          # å®¡è®¡æ—¥å¿—
â”‚   â”‚   â””â”€â”€ routes.ts          # èµ„æºè·¯ç”±ï¼šdocs/api/admin
â”‚   â””â”€â”€ casbin/
â”‚       â”œâ”€â”€ model.conf
â”‚       â””â”€â”€ policy.csv
â”œâ”€â”€ opa/                        # OPA ç­–ç•¥ä¸é…ç½®
â”‚   â”œâ”€â”€ policies/
â”‚   â”‚   â””â”€â”€ kb.rego
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ prometheus/
â”‚   â””â”€â”€ prometheus.yml          # æŒ‡æ ‡æŠ“å–é…ç½®
â””â”€â”€ grafana/
    â””â”€â”€ provisioning/
        â””â”€â”€ dashboards/
            â””â”€â”€ zero-trust.json # ä»ªè¡¨ç›˜å®šä¹‰
```

- **ç»Ÿä¸€å…¥å£ç½‘å…³**ï¼šæ‰€æœ‰è¯·æ±‚å…ˆè¿›å…¥ç½‘å…³ï¼Œæ³¨å…¥ä¸Šä¸‹æ–‡ï¼ˆèº«ä»½ã€è®¾å¤‡ã€æ¸ é“ã€èµ„æºæ•æ„Ÿåº¦ï¼‰ï¼Œæ‰§è¡Œé£é™©è¯„åˆ† â†’ OPA ç­–ç•¥ â†’ Casbin åŸŸåˆ†æ®µæˆæƒã€‚
- **ç­–ç•¥å³ä»£ç **ï¼šRegoï¼ˆç¯å¢ƒç­–ç•¥ï¼‰+ Casbinï¼ˆRBAC/åŸŸåˆ†æ®µï¼‰å‡ä¸ºç‰ˆæœ¬åŒ–æ–‡ä»¶ï¼Œæ”¯æŒ PR å®¡æ ¸ã€‚
- **å¯è§‚æµ‹æ€§**ï¼šPrometheus æŠ“å–ç½‘å…³æŒ‡æ ‡ä¸æˆæƒç»“æœï¼ŒGrafana ä»ªè¡¨ç›˜å¯è§†åŒ–ã€‚

---

## Docker Compose ç¼–æ’

```yaml
# zero-trust-demo/docker-compose.yml
version: "3.9"

services:
  gateway:
    build: ./gateway
    container_name: zero-trust-gateway
    environment:
      - OPA_URL=http://opa:8181
      - PROMETHEUS_PORT=9090
      - CASBIN_MODEL=/app/casbin/model.conf
      - CASBIN_POLICY=/app/casbin/policy.csv
      - NODE_ENV=production
      - PORT=3000
    ports:
      - "3000:3000"
    depends_on:
      - opa
      - prometheus
      - grafana

  opa:
    image: openpolicyagent/opa:0.64.0-rootless
    container_name: zero-trust-opa
    command:
      - "run"
      - "--server"
      - "--addr=0.0.0.0:8181"
      - "--config-file=/config/config.yaml"
      - "/policies"
    ports:
      - "8181:8181"
    volumes:
      - ./opa/policies:/policies:ro
      - ./opa/config.yaml:/config/config.yaml:ro

  prometheus:
    image: prom/prometheus:v2.55.0
    container_name: zero-trust-prometheus
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana:10.4.2
    container_name: zero-trust-grafana
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    ports:
      - "3001:3001"
    command:
      - "--port=3001"
    volumes:
      - ./grafana/provisioning/dashboards:/var/lib/grafana/dashboards
```

---

## ç­–ç•¥ä¸æƒé™é…ç½®

### OPA ç­–ç•¥ï¼ˆRegoï¼‰

```rego
# opa/policies/kb.rego
package kb.authz

default decision = {"allow": false, "step_up_mfa": false, "reason": "default_deny"}

# è®¾å¤‡ä¸åˆè§„ç›´æ¥æ‹’ç»
deny_if_non_compliant {
  input.device.compliant == false
}

# é«˜æ•èµ„æºéœ€è¦æ­¥è¿›è®¤è¯ï¼ˆåˆè§„è®¾å¤‡ä¸‹ï¼‰
require_step_up {
  input.resource.sensitivity == "high"
  input.device.compliant == true
}

# åŸºç¡€å…è®¸ï¼ˆç¼–è¾‘è€…è®¿é—®éé«˜æ• docs åŸŸï¼‰
base_allow {
  input.user.role == "editor"
  input.resource.domain == "docs"
  input.device.compliant == true
}

# ç®¡ç†å‘˜å…è®¸
admin_allow {
  input.user.role == "admin"
  input.device.compliant == true
}

decision = {"allow": false, "step_up_mfa": false, "reason": "device_non_compliant"} {
  deny_if_non_compliant
}

decision = {"allow": false, "step_up_mfa": true, "reason": "step_up_required"} {
  require_step_up
  not admin_allow
}

decision = {"allow": true, "step_up_mfa": false, "reason": "base_allow"} {
  base_allow
}

decision = {"allow": true, "step_up_mfa": false, "reason": "admin_allow"} {
  admin_allow
}
```

### OPA é…ç½®

```yaml
# opa/config.yaml
services:
  - name: local
decision_logs:
  console: true
```

### Casbin æ¨¡å‹ä¸ç­–ç•¥

```ini
# gateway/casbin/model.conf
[request_definition]
r = sub, dom, obj, act

[policy_definition]
p = sub, dom, obj, act

[role_definition]
g = _, _

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = g(r.sub, p.sub) && r.dom == p.dom && r.obj == p.obj && r.act == p.act
```

```csv
# gateway/casbin/policy.csv
p, editor, docs, install_guide, read
p, editor, api, openapi_v1, read
p, admin, admin, policy_console, write
p, admin, docs, *, write

g, alice, editor
g, bob, admin
```

---

## ç¤ºä¾‹ç½‘å…³æœåŠ¡

### package.json

```json
{
  "name": "zero-trust-gateway",
  "private": true,
  "type": "module",
  "scripts": {
    "start": "node --loader ts-node/esm src/server.ts",
    "build": "tsc"
  },
  "dependencies": {
    "axios": "^1.7.2",
    "casbin": "^5.25.1",
    "express": "^4.19.2",
    "morgan": "^1.10.0",
    "prom-client": "^15.1.1",
    "ts-node": "^10.9.2",
    "typescript": "^5.6.3"
  }
}
```

### server.ts

```ts
import express from "express"
import morgan from "morgan"
import { register, Histogram, Counter } from "prom-client"
import { authorize } from "./authz.js"
import routes from "./routes.js"
import { auditLogger } from "./logger.js"

const app = express()
app.use(express.json())
app.use(morgan("combined"))

const reqLatency = new Histogram({
  name: "gateway_request_latency_seconds",
  help: "Latency of requests",
  labelNames: ["route", "method", "status"]
})
const authzResult = new Counter({
  name: "gateway_authz_decisions_total",
  help: "Authorization decisions",
  labelNames: ["decision"]
})

app.use(async (req, res, next) => {
  const start = Date.now()
  try {
    const ctx = buildContext(req)
    const decision = await authorize(ctx)
    auditLogger.log({ ctx, decision })
    authzResult.inc({ decision: decision.reason })

    if (decision.step_up_mfa) {
      return res.status(403).json({ error: "step_up_mfa_required", detail: decision.reason })
    }
    if (!decision.allow) {
      return res.status(403).json({ error: "access_denied", detail: decision.reason })
    }
    // æŒ‚è½½æˆæƒä¸Šä¸‹æ–‡
    ;(req as any).authz = { user: ctx.user, resource: ctx.resource }
    next()
  } catch (e) {
    return res.status(500).json({ error: "authz_error", detail: String(e) })
  } finally {
    const ms = (Date.now() - start) / 1000
    reqLatency.observe({ route: req.path, method: req.method, status: String(res.statusCode) }, ms)
  }
})

app.use(routes)

app.get("/metrics", async (_req, res) => {
  res.set("Content-Type", register.contentType)
  res.end(await register.metrics())
})

app.get("/", (_req, res) => {
  res.json({ ok: true, service: "zero-trust-gateway" })
})

const port = process.env.PORT || 3000
app.listen(port, () => console.log(`Gateway listening on :${port}`))

function buildContext(req: express.Request) {
  // åœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œä»¥ä¸‹ä¿¡æ¯æ¥è‡ª SSO/JWTã€MDM/EDRã€GeoIPã€Channel headers
  const user = {
    id: req.header("x-user-id") || "alice",
    role: req.header("x-user-role") || "editor"
  }
  const device = {
    compliant: (req.header("x-device-compliant") || "true") === "true"
  }
  const channel = req.header("x-channel") || "web"
  const resource = {
    domain: inferDomain(req.path), // docs/api/admin
    sensitivity: req.header("x-resource-sensitivity") || "normal",
    object: req.header("x-resource-object") || "install_guide",
    action: req.method.toLowerCase() === "get" ? "read" : "write"
  }
  const context = { user, device, channel, resource }
  return context
}

function inferDomain(path: string) {
  if (path.startsWith("/docs")) return "docs"
  if (path.startsWith("/api")) return "api"
  if (path.startsWith("/admin")) return "admin"
  return "docs"
}
```

### authz.ts

```ts
import axios from "axios"
import { newEnforcer } from "casbin"

const OPA_URL = process.env.OPA_URL || "http://localhost:8181"
const CASBIN_MODEL = process.env.CASBIN_MODEL || "./casbin/model.conf"
const CASBIN_POLICY = process.env.CASBIN_POLICY || "./casbin/policy.csv"

let enforcerPromise: Promise<any> | null = null
async function getEnforcer() {
  if (!enforcerPromise) enforcerPromise = newEnforcer(CASBIN_MODEL, CASBIN_POLICY)
  return enforcerPromise
}

export async function authorize(ctx: any) {
  // 1) ç¯å¢ƒ/è¡Œä¸ºç­–ç•¥ï¼šOPA å†³ç­–
  const { data } = await axios.post(`${OPA_URL}/v1/data/kb/authz/decision`, ctx, { timeout: 1000 })
  const opa = data.result || { allow: false, step_up_mfa: false, reason: "opa_no_result" }

  if (opa.allow === false && !opa.step_up_mfa) {
    return opa
  }
  if (opa.step_up_mfa === true) {
    return opa
  }

  // 2) RBAC + å¾®åˆ†æ®µï¼šCasbin å†³ç­–
  const e = await getEnforcer()
  const allowed = await e.enforce(ctx.user.role, ctx.resource.domain, ctx.resource.object, ctx.resource.action)
  return allowed
    ? { allow: true, step_up_mfa: false, reason: "casbin_allow" }
    : { allow: false, step_up_mfa: false, reason: "casbin_deny" }
}
```

### routes.ts

```ts
import { Router } from "express"
const router = Router()

router.get("/docs/install", (req, res) => {
  res.json({ doc: "install_guide", message: "Install guide content ..." })
})

router.get("/api/openapi", (req, res) => {
  res.json({ api: "openapi_v1", message: "OpenAPI spec ..." })
})

router.post("/admin/policy", (req, res) => {
  res.json({ admin: true, message: "Policy updated (mock)" })
})

export default router
```

### logger.ts

```ts
export const auditLogger = {
  log(entry: any) {
    const { ctx, decision } = entry
    console.log(
      JSON.stringify({
        ts: new Date().toISOString(),
        user: ctx.user,
        device: ctx.device,
        channel: ctx.channel,
        resource: ctx.resource,
        decision
      })
    )
  }
}
```

---

## ç›‘æ§ä¸ä»ªè¡¨ç›˜

### Prometheus æŠ“å–é…ç½®

```yaml
# prometheus/prometheus.yml
global:
  scrape_interval: 5s

scrape_configs:
  - job_name: "gateway"
    static_configs:
      - targets: ["gateway:3000"]
    metrics_path: "/metrics"
```

### Grafana ä»ªè¡¨ç›˜ï¼ˆç®€åŒ–ç‰ˆï¼‰

```json
{
  "title": "Zero Trust Gateway",
  "panels": [
    {
      "type": "graph",
      "title": "Request Latency",
      "targets": [{ "expr": "gateway_request_latency_seconds" }]
    },
    {
      "type": "bargauge",
      "title": "Authz Decisions",
      "targets": [{ "expr": "sum by (decision) (gateway_authz_decisions_total)" }]
    }
  ],
  "schemaVersion": 38
}
```

---

## è¿è¡Œã€æµ‹è¯•ä¸è¿­ä»£

### æœ¬åœ°å¯åŠ¨

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
docker compose up --build
# ç½‘å…³ï¼šhttp://localhost:3000
# OPAï¼šhttp://localhost:8181
# Prometheusï¼šhttp://localhost:9090
# Grafanaï¼šhttp://localhost:3001 ï¼ˆé»˜è®¤ admin/adminï¼‰
```

### å¿«é€Ÿæµ‹è¯•

```bash
# åˆè§„è®¾å¤‡ + editor è®¿é—® docsï¼ˆå…è®¸ï¼‰
curl -H "x-user-id: alice" -H "x-user-role: editor" -H "x-device-compliant: true" http://localhost:3000/docs/install

# éåˆè§„è®¾å¤‡ï¼ˆæ‹’ç»ï¼‰
curl -H "x-user-id: alice" -H "x-user-role: editor" -H "x-device-compliant: false" http://localhost:3000/docs/install

# é«˜æ•èµ„æºï¼ˆæ­¥è¿›è®¤è¯è¦æ±‚ï¼‰
curl -H "x-user-id: alice" -H "x-user-role: editor" -H "x-device-compliant: true" -H "x-resource-sensitivity: high" http://localhost:3000/docs/install

# admin å†™å…¥ç­–ç•¥æ§åˆ¶å°ï¼ˆå…è®¸ï¼‰
curl -X POST -H "x-user-id: bob" -H "x-user-role: admin" -H "x-device-compliant: true" http://localhost:3000/admin/policy
```

### è¿­ä»£å»ºè®®

- **ç­–ç•¥æ‹“å±•ï¼š** åœ¨ `kb.rego` å¼•å…¥åœ°ç†ã€æ—¶é—´æ®µã€æ¸ é“ã€å¤±è´¥ç™»å½•æ¬¡æ•°çš„é£é™©åŠ åˆ†ï¼›å°†æ­¥è¿›è®¤è¯æ”¹ä¸ºå®é™…çš„ MFA æ ¡éªŒæ¥å£ã€‚
- **æƒé™ç²¾ç»†åŒ–ï¼š** åœ¨ `policy.csv` å¢åŠ é¡¹ç›®åŸŸã€æ•°æ®çº§åˆ«ï¼ˆæ ‡ç­¾/éƒ¨é—¨/é¡¹ç›®ï¼‰å®ç° ABAC + RBAC æ··åˆã€‚
- **å®¡è®¡ä¸å‘Šè­¦ï¼š** å°†å®¡è®¡æ—¥å¿—è¾“å‡ºåˆ° ELK/CloudWatchï¼Œå¹¶åœ¨ Grafana æ·»åŠ é˜ˆå€¼å‘Šè­¦ã€‚
- **å¯†é’¥ä¸åˆè§„ï¼š** æ¥å…¥ KMSï¼ˆVault/AWS KMSï¼‰ç®¡ç†ä»¤ç‰Œå’Œå¯†é’¥ï¼Œç­–ç•¥ä¸å®¡è®¡åšæœˆåº¦åˆè§„å¿«ç…§ã€‚

---
