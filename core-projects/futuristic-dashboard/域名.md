/**
 * @file README.md
 * @description YYC³ 智能行业平台部署说明（阿里云服务器 + Nginx 代理 + Vercel 项目集成）
 * @author YYC³
 * @version 1.0.0
 * @created 2025-10-15
 */

# YYC³ 智能行业平台部署说明

## 📍 服务器信息

- 云服务商：阿里云
- 公网 IP：`8.152.195.33`
- 操作系统：Alibaba Cloud Linux / Ubuntu
- Web 服务：Nginx + Docker（可选）

## 🌐 主域名与子域名解析

### 主域名
- `0379.world` → 解析至 `8.152.195.33`
- 用于部署仪表盘项目（Next.js）

### 子域名（行业项目代理）

所有子域名均解析至同一 IP，并由 Nginx 代理至 Vercel 项目或自定义域：

| 子域名             | 对应项目地址（Vercel 或自定义）         |
|--------------------|------------------------------------------|
| yyc3-agr.0379.world | https://yyc3-agr.vercel.app              |
| yyc3-fb.0379.world  | https://yyc3-fb.vercel.app               |
| yyc3-fn.0379.world  | https://yyc3-fn.vercel.app               |
| yyc3-gov.0379.world | https://yyc3-gov.vercel.app              |
| yyc3-hr.0379.world  | https://yyc3-hr.vercel.app               |
| yyc3-med.0379.world | https://yyc3-med.vercel.app              |
| yyc3-media.0379.world | https://yyc3-media.vercel.app          |
| yyc3-manu.0379.world | https://yyc3-manu.vercel.app            |
| yyc3-core.0379.world | https://yyc3-core.vercel.app            |
| yyc3-cultural.0379.world | https://yyc3-cultural.vercel.app     |
| yyc3-edu.0379.world | https://yyc3-edu.vercel.app              |
| yyc3-energy.0379.world | https://yyc3-energy.vercel.app         |
| yyc3-env.0379.world | https://yyc3-env.vercel.app              |
| yyc3-law.0379.world | https://yyc3-law.vercel.app              |
| yyc3-log.0379.world | https://yyc3-log.vercel.app              |
| yyc3-ent.0379.world | https://yyc3-ent.vercel.app              |
| yyc3-real.0379.world | https://yyc3-real.vercel.app            |
| yyc3-retail.0379.world | https://yyc3-retail.vercel.app         |
| yyc3-traffic.0379.world | https://yyc3-traffic.vercel.app       |
| yyc3-tourism.0379.world | https://yyc3-tourism.vercel.app       |
| yyc3-elder.0379.world | https://yyc3-elder.vercel.app          |
| yyc3-api.0379.world | https://yyc3-api.vercel.app              |
| yyc3-dc.0379.world  | https://yyc3-dc.vercel.app               |
| yyc3-finance.0379.world | https://yyc3-finance.vercel.app       |
| yyc3-cdc.0379.world | https://yyc3-cdc.vercel.app              |
| yyc3-edc.0379.world | https://yyc3-edc.vercel.app              |
| yyc3-Edge.0379.world | https://yyc3-edge.vercel.app            |
| yyc3-edu-basic.0379.world | https://yyc3-edu-basic.vercel.app   |
| yyc3-edu-higher.0379.world | https://yyc3-edu-higher.vercel.app |

> 所有子域名需在阿里云 DNS 控制台中添加 A 记录，指向 `8.152.195.33`

---

## 🧱 Nginx 配置建议

每个子域名配置一个 `server` 块，代理至对应 Vercel 项目：

```nginx
server {
    listen 80;
    server_name yyc3-agr.0379.world;
    
    location / {
        proxy_pass https://yyc3-agr.vercel.app;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}

# 其他子域名类似配置...
```

> 提示：可以使用部署脚本自动生成这些配置

---

## ✅ 24 个行业分类名称与缩写对照表

| 行业名称       | 缩写代码     | 图标 Emoji | 图标名称（iconName） |
|----------------|--------------|------------|------------------------|
| 智慧农业       | AGR          | 🌱         | Sprout                |
| 餐饮服务       | FB           | 🍽️         | Utensils              |
| 股票金融       | FN           | 📈         | TrendingUp            |
| 智慧城市       | GOV          | 🏢         | Building2             |
| 人力资源       | HR           | 👥         | Users                 |
| 医疗健康       | MED          | ❤️         | Heart                 |
| 媒体娱乐       | MEDIA        | 🎬         | Film                  |
| 智能制造       | MANU         | 🏭         | Factory               |
| 智能编程       | CORE         | 💻         | Code                  |
| 智能文创       | CULTURAL     | 🎨         | Palette               |
| 智能教育       | EDU          | 🎓         | GraduationCap         |
| 能源管理       | ENERGY       | ⚡         | Zap                   |
| 环境保护       | ENV          | 🍃         | Leaf                  |
| 法律服务       | LAW          | ⚖️         | Scale                 |
| 智慧物流       | LOG          | 🚚         | Truck                 |
| 实体经营       | ENT          | 💼         | Briefcase             |
| 地产建筑       | REAL         | 🏠         | Home                  |
| 智慧零售       | RETAIL       | 🛒         | ShoppingCart          |
| 智能交通       | TRAFFIC      | 🚗         | Car                   |
| 旅游酒店       | TOURISM      | ✈️         | Plane                 |
| 智慧养老       | ELDER        | 💓         | HeartPulse            |
| 技术集成       | API          | 🖥️         | Cpu                   |
| 数据中心       | DC           | 💾         | Database              |
| 金融科技       | FINANCE      | 💰         | DollarSign            |

---

## 🚀 完整部署步骤

### 域名映射架构

#### 设计理念
- **自治单元模型**：每个子域名作为独立的自治单元，映射到对应行业的仪表盘项目接口
- **解耦架构**：实现域名与具体服务实现的解耦，便于独立扩展和维护
- **统一入口**：通过Nginx提供统一的HTTPS入口，支持智能路由和负载均衡
- **配置驱动**：基于配置文件的域名映射，无需修改代码即可调整路由规则

#### 配置结构
1. **域名映射配置** (`config/dns/domain-mappings.json`)
   - 包含29个行业子域名的映射定义
   - 每个域名定义行业代码、目标服务地址和自治配置
   - 支持全局设置和个性化配置

2. **Nginx路由配置** (`config/nginx/domain-routes.conf`)
   - 配置SSL证书和HTTPS支持
   - 实现基于域名的反向代理
   - 优化安全头和性能设置

3. **中间件服务** (`lib/middleware/domain-router.ts`)
   - 实现动态路由解析
   - 支持配置热重载
   - 提供路由缓存和性能优化

#### 自治单元特性
- **独立扩展**：每个域名可以独立部署和扩展
- **服务发现**：支持自动服务发现和健康检查
- **容错机制**：单点故障不影响整体系统
- **个性化配置**：每个域名可拥有独立的配置参数

### 1. 环境准备

```bash
# 安装必要依赖
sudo apt update
sudo apt install -y docker.io docker-compose nginx certbot python3-certbot-nginx

# 启动Docker服务
sudo systemctl start docker
sudo systemctl enable docker
```

### 2. 项目部署

```bash
# 克隆项目仓库
cd /home
mkdir yyc3 && cd yyc3
git clone https://github.com/yourusername/yyc3-platform.git .

# 域名映射配置
mkdir -p config/dns

# 运行部署脚本
cd scripts
chmod +x deploy.sh
./deploy.sh --update-dns-mappings
```

### 3. SSL证书配置

```bash
# 为所有域名申请SSL证书
sudo certbot --nginx -d 0379.world -d *.0379.world

# 自动续期配置
sudo certbot renew --dry-run

# 添加到crontab实现自动更新
0 3 * * * certbot renew --quiet && systemctl reload nginx
```

### 域名映射管理

#### 配置文件说明
配置文件位于 `config/dns/domain-mappings.json`，结构如下：
```json
{
  "version": "1.0.0",
  "description": "YYC3 域名映射配置",
  "mappings": [
    {
      "domain": "yyc3-agr.0379.world",
      "industryCode": "AGR",
      "industryName": "农业",
      "target": "https://yyc3-agr.vercel.app",
      "services": [...],
      "autonomous": {
        "enabled": true,
        "timeout": 30000,
        "healthCheck": true
      }
    }
  ],
  "globalSettings": {
    "apiVersion": "v1",
    "defaultTimeout": 30000,
    "corsEnabled": true
  }
}
```

---

## 📊 监控系统使用

### 监控脚本功能

项目提供了完整的监控脚本，用于查看容器运行状态和资源使用情况：

```bash
# 运行监控脚本
cd scripts
./monitor.sh
```

### 监控选项

1. **查看所有容器状态**：`./monitor.sh status`
2. **查看容器资源使用**：`./monitor.sh stats`
3. **查看特定容器日志**：`./monitor.sh logs <容器名称> [行数]`
4. **查看Docker系统信息**：`./monitor.sh info`
5. **查看网络状态**：`./monitor.sh network`
6. **检查仪表盘服务**：`./monitor.sh dashboard`
7. **查看性能摘要**：`./monitor.sh perf`
8. **执行完整监控**：`./monitor.sh all`
9. **监控域名映射状态**：`./monitor.sh domains` - 检查所有域名映射状态和健康检查

---

## 🏗️ 项目结构

```
/Users/yanyu/www/0379-world/
├── app/                    # Next.js应用目录
│   ├── industries/         # 行业相关页面
│   │   └── [id]/           # 动态行业详情页面
├── config/                 # 配置目录
│   ├── dns/                # 域名映射配置
│   │   └── domain-mappings.json # 域名映射定义
│   └── nginx/              # Nginx配置
│       └── domain-routes.conf # 域名路由配置
├── lib/                    # 工具库
│   ├── config/             # 配置文件
│   │   ├── industries.json # 行业分类配置
│   │   └── industry-loader.ts # 行业数据加载逻辑
│   ├── middleware/         # 中间件
│   │   └── domain-router.ts # 域名路由中间件
│   └── types/              # 类型定义
│       └── industry.ts     # 行业类型定义
├── scripts/                # 脚本目录
│   ├── deploy.sh           # 部署脚本
│   └── monitor.sh          # 监控脚本
└── README.md               # 项目说明文档
```

### 域名映射相关文件
- `config/dns/domain-mappings.json` - 域名到接口的映射配置
- `config/nginx/domain-routes.conf` - Nginx域名路由配置
- `lib/middleware/domain-router.ts` - 域名路由处理中间件

---

## 🧠 审核说明

- 所有缩写均与图示内容一致，且在 `getIndustryIcon` 映射函数中有对应图标。
- 若你在云服务器中使用这些缩写作为标识符（如 `industry.id`），建议统一命名规范，例如：`yyc3-agr`, `yyc3-fb`, `yyc3-dc` 等。
- 若你使用数据库或配置文件管理行业分类，可将此表作为参考模板。

## 📊 域名映射架构图

```
┌─────────────────────────────────────────────────────────┐
│                       客户端请求                         │
└───────────────┬─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────────────────────┐
│                     Nginx 负载均衡                      │
│  ┌─────────────────┐   ┌─────────────────┐             │
│  │ HTTPS 终结     │   │ 域名路由规则     │             │
│  └─────────────────┘   └─────────────────┘             │
└───────────────┬─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────────────────────┐
│                域名路由中间件 (domain-router)            │
│  ┌─────────────────┐   ┌─────────────────┐             │
│  │ 配置加载与缓存   │   │ 路由解析       │             │
│  └─────────────────┘   └─────────────────┘             │
└───────────────┬─────────────────────────────────────────┘
                ↓
┌─────────────────────────────────────────────────────────┐
│                    自治单元服务集群                      │
│  ┌─────────────────┐   ┌─────────────────┐             │
│  │ 行业A服务       │   │ 行业B服务       │             │
│  │ (agr.0379.world) │   │ (fb.0379.world) │             │
│  └─────────────────┘   └─────────────────┘             │
│  ┌─────────────────┐   ┌─────────────────┐             │
│  │ 行业C服务       │   │ 行业D服务       │             │
│  │ (fn.0379.world) │   │ (gov.0379.world)│             │
│  └─────────────────┘   └─────────────────┘             │
│                       ... 更多行业服务 ...              │
└─────────────────────────────────────────────────────────┘
```

## 📝 更新日志

### 2024-10-15

  添加域名映射架构支持
  实现29个行业子域名的自治单元模型
  优化部署脚本，支持域名映射配置管理
  更新README.md文档，添加域名映射说明

---

## 🛠️ 常见问题解决

### Nginx代理问题

  确保所有子域名DNS记录正确配置
  检查Nginx配置文件语法：`sudo nginx -t`
  重启Nginx服务：`sudo systemctl restart nginx`

### Docker容器问题

  查看容器日志：`./monitor.sh logs <容器名称>`
  重启特定容器：`docker restart <容器名称>`
  检查Docker服务状态：`systemctl status docker`

### 域名映射问题

  **检查DNS解析**：`dig yyc3-agr.0379.world`
  **验证Nginx配置**：`nginx -t`
  **检查域名映射配置**：确保`domain-mappings.json`格式正确
  **验证域名映射**：`./deploy.sh --validate-mappings`
  **添加新域名映射**：编辑`domain-mappings.json`后运行`./deploy.sh --update-dns-mappings --no-build`

---

## 📝 维护建议

- 定期运行监控脚本检查系统状态
- 每周更新SSL证书：`sudo certbot renew`
- 每月备份重要数据和配置文件
- 定期更新Docker镜像以获取安全补丁

---

*文档更新时间：2025-10-15*
