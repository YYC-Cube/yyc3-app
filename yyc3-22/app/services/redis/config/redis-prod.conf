# ============================== 生产环境专属配置 ==============================
# 防误迁移警告：必须确认安全项后部署！
# 生产环境特征：强密码、固定生产IP、禁止开发网段、严格内存限制（Docker用户：yanyuit）

# 引入通用基础配置（容器内路径）
include /etc/redis/redis-base.conf

# 网络：生产环境建议绑定具体内网IP（此处为容器通用绑定）
bind 0.0.0.0
protected-mode yes
port 6379

tcp-backlog 511
tcp-keepalive 300

# 安全：极简基线——仅保留密码认证，取消命令重命名
requirepass redis_yyc3
masterauth redis_yyc3

# 持久化：生产级配置（避免数据丢失，NAS生产存储）
# RDB配置
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump-prod.rdb

# AOF配置
aof-use-rdb-preamble yes
appendonly yes
appendfilename "appendonly-prod.aof"
appendfsync everysec
no-appendfsync-on-rewrite yes
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes

# 主从复制配置（主节点配置）
# replicaof <masterip> <masterport>  # 从节点配置时取消注释并设置主节点IP和端口
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
replica-priority 100

# 内存：生产分配（云服务器按实际内存调整）
maxmemory 8gb
maxmemory-policy volatile-lru
maxmemory-samples 5

# 客户端限制
maxclients 10000

# 超时设置
timeout 0

dir /data

# 哨兵配置（仅在哨兵模式下使用）
# sentinel monitor mymaster 127.0.0.1 6379 2
# sentinel auth-pass mymaster redis_yyc3
# sentinel down-after-milliseconds mymaster 5000
# sentinel parallel-syncs mymaster 1
# sentinel failover-timeout mymaster 180000

# 其他生产级配置
cluster-enabled no
cluster-config-file nodes-6379.conf
cluster-node-timeout 15000

# 日志配置
logfile /var/log/redis/redis-server.log
loglevel notice
