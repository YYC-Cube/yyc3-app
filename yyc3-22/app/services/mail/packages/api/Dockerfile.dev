# ğŸš€ é‚®ä»¶å¹³å°APIæœåŠ¡å¼€å‘ç¯å¢ƒDockerfile
# @file Dockerfile.dev
# @description ç”¨äºæœ¬åœ°å¼€å‘çš„APIæœåŠ¡Dockerå®¹å™¨é…ç½®
# @author YYC
# @version 1.0.0
# @created 2024-10-15

FROM node:20

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶package.jsonå’Œpackage-lock.json
COPY package*.json ./

# å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬å¼€å‘ä¾èµ–ï¼‰
RUN npm install

# å¤åˆ¶æºä»£ç 
COPY src/ ./src/
COPY tsconfig.json ./

# åˆ›å»ºç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
RUN if [ ! -f .env.example ]; then touch .env.example; fi

# è®¾ç½®æ–‡ä»¶æƒé™ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
RUN chown -R node:node /app

# åˆ‡æ¢åˆ°nodeç”¨æˆ·
USER node

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV NODE_ENV=development
ENV PORT=3000

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨å‘½ä»¤ - ä½¿ç”¨ts-node-devè¿›è¡Œçƒ­é‡è½½
CMD ["npm", "run", "dev"]