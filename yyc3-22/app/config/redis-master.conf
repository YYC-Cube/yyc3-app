# === Redis主服务器配置文件 ===
# @description Redis主服务器配置参数
# @author YYC
# @version 1.0.0
# @created 2024-10-15

# -------------------- 基础配置 --------------------
# 绑定地址
bind 0.0.0.0

# 监听端口
port 6379

# 进程ID文件
pidfile /var/run/redis/redis-master.pid

# 日志文件
logfile /var/log/redis/redis-master.log

# 日志级别
loglevel notice

# 数据库数量
databases 16

# -------------------- 持久化配置 --------------------
# RDB持久化配置
# 900秒内至少有1个键被修改，则执行RDB持久化
save 900 1
# 300秒内至少有10个键被修改，则执行RDB持久化
save 300 10
# 60秒内至少有10000个键被修改，则执行RDB持久化
save 60 10000

# RDB持久化文件名
dbfilename dump.rdb

# RDB持久化文件存储路径
dir /data

# 启用AOF持久化
appendonly yes

# AOF持久化文件名
appendfilename "appendonly.aof"

# AOF持久化策略
# always: 每次写入都持久化到磁盘
# everysec: 每秒持久化一次
# no: 由操作系统决定何时持久化
appendfsync everysec

# 重写AOF文件时是否停止同步
no-appendfsync-on-rewrite no

# AOF文件大小增长百分比，达到此值时触发重写
auto-aof-rewrite-percentage 100

# AOF文件大小，达到此值时触发重写
auto-aof-rewrite-min-size 64mb

# 加载AOF文件时是否忽略错误
# yes: 忽略错误，继续加载
# no: 遇到错误停止加载
aof-load-truncated yes

# -------------------- 内存管理 --------------------
# 最大内存限制
maxmemory 1gb

# 内存淘汰策略
# volatile-lru: 只对设置了过期时间的键使用LRU算法
# allkeys-lru: 对所有键使用LRU算法
# volatile-lfu: 只对设置了过期时间的键使用LFU算法
# allkeys-lfu: 对所有键使用LFU算法
# volatile-random: 只对设置了过期时间的键随机删除
# allkeys-random: 对所有键随机删除
# volatile-ttl: 删除过期时间最近的键
# noeviction: 不删除键，写操作会返回错误
maxmemory-policy allkeys-lru

# 最大内存策略的采样数量
maxmemory-samples 5

# -------------------- 安全配置 --------------------
# 密码认证
requirepass password_yyc3

# 重命名危险命令
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG ""

# -------------------- 复制配置 --------------------
# 主服务器密码
masterauth password_yyc3

# 复制缓冲区大小
repl-backlog-size 1mb

# 复制缓冲区过期时间
repl-backlog-ttl 3600

# 复制超时时间
repl-timeout 60

# -------------------- 客户端配置 --------------------
# 最大客户端连接数
maxclients 10000

# 客户端超时时间
# 0: 不超时
timeout 0

# TCP keepalive时间
tcp-keepalive 300

# -------------------- 高级配置 --------------------
# 启用混合持久化
aof-use-rdb-preamble yes

# 延迟监控阈值
latency-monitor-threshold 100

# 慢查询日志阈值
slowlog-log-slower-than 10000

# 慢查询日志最大长度
slowlog-max-len 128

# 哈希表最大负载因子
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# 列表最大压缩长度
list-max-ziplist-size -2
list-compress-depth 0

# 集合最大压缩长度
set-max-intset-entries 512

# 有序集合最大压缩长度
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog最大稀疏存储长度
hll-sparse-max-bytes 3000

# -------------------- 集群配置 --------------------
# 启用集群模式
# cluster-enabled yes

# 集群配置文件
# cluster-config-file nodes.conf

# 集群节点超时时间
# cluster-node-timeout 15000

# 集群副本数量
# cluster-replica-count 1

# 集群迁移槽位的副本数量
# cluster-migration-barrier 1
