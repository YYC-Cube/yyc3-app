# Generating ZIP package with Wiki search script, Helm changelog integration, and CI/CD changelog push logic

import os
import zipfile

# Create necessary directories and files
os.makedirs("/mnt/data/www/email/wiki", exist_ok=True)
os.makedirs("/mnt/data/www/email/helm", exist_ok=True)
os.makedirs("/mnt/data/www/email/docs", exist_ok=True)

# Wiki Home.md with embedded search script
wiki_home_md = """# 0379.email å¤šæœåŠ¡å¹³å° Wiki

æ¬¢è¿ä½¿ç”¨ 0379.email å¤šæœåŠ¡å¹³å°æ–‡æ¡£ã€‚

## ğŸ” æœç´¢åŠŸèƒ½

<input type="text" id="searchInput" placeholder="è¾“å…¥å…³é”®è¯æœç´¢..." style="width: 100%; padding: 8px; font-size: 16px;">

<div id="searchResults"></div>

<script>
const pages = [
  { title: "æ¶æ„ç™½çš®ä¹¦", path: "architecture_whitepaper.md", content: "Nginx TLS Swagger Helm Chart CI/CD" },
  { title: "ç‰ˆæœ¬è®°å½•", path: "../docs/changelog.html", content: "v1.2.0 v1.3.0 Helm TLS GitLab CI" },
  { title: "ç‰ˆæœ¬å¯¹æ¯”", path: "../docs/changelog-diff.html", content: "æ–°å¢ ä¿®æ”¹ åˆ é™¤ Helm TLS GitLab CI" }
];

document.getElementById("searchInput").addEventListener("input", function() {
  const keyword = this.value.toLowerCase();
  const results = pages.filter(p => p.title.toLowerCase().includes(keyword) || p.content.toLowerCase().includes(keyword));
  const html = results.map(p => `<p><a href="${p.path}">${p.title}</a><br><em>${p.content}</em></p>`).join("");
  document.getElementById("searchResults").innerHTML = html || "<p>æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</p>";
});
</script>
"""

# Helm README.md with changelog links
helm_readme_md = """# 0379.email Helm Chart

éƒ¨ç½²æŒ‡å—ä¸é…ç½®è¯´æ˜ã€‚

## ğŸ“¦ ç‰ˆæœ¬è®°å½•

å®Œæ•´ç‰ˆæœ¬å˜æ›´è®°å½•è¯·è§ï¼š
- [Changelog é¡µé¢](../../docs/changelog.html)
- [ç‰ˆæœ¬å¯¹æ¯”è§†å›¾](../../docs/changelog-diff.html)
- [ç‰ˆæœ¬æ•°æ® JSON](../../docs/changelog.json)
"""

# CI/CD release.sh script
release_sh = """#!/bin/bash
echo "ğŸ” å‘å¸ƒæµç¨‹å¼€å§‹..."
cp docs/changelog.html docs/changelog-diff.html docs/changelog.json /mnt/data/wiki/
echo "âœ… changelog é¡µé¢å·²æ¨é€è‡³ Wiki"
"""

# Write files
with open("/mnt/data/www/email/wiki/Home.md", "w", encoding="utf-8") as f:
    f.write(wiki_home_md)

with open("/mnt/data/www/email/helm/README.md", "w", encoding="utf-8") as f:
    f.write(helm_readme_md)

with open("/mnt/data/www/email/release.sh", "w", encoding="utf-8") as f:
    f.write(release_sh)

# Create ZIP package
zip_path = "/mnt/data/0379_email_wiki_changelog_package.zip"
with zipfile.ZipFile(zip_path, "w", zipfile.ZIP_DEFLATED) as zipf:
    zipf.write("/mnt/data/www/email/wiki/Home.md", "www/email/wiki/Home.md")
    zipf.write("/mnt/data/www/email/helm/README.md", "www/email/helm/README.md")
    zipf.write("/mnt/data/www/email/release.sh", "www/email/release.sh")

print("âœ… å·²ç”Ÿæˆ ZIP åŒ…ï¼š", zip_path)
