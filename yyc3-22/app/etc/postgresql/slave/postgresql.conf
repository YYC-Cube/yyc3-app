# PostgreSQL configuration file for slave server

# -----------------------------
# PostgreSQL Server Configuration
# -----------------------------

# - Connection Settings - 连接设置
listen_addresses = '*'      # 监听所有地址
port = 5432                 # 端口号
max_connections = 100       # 最大连接数

# - Authentication Settings - 认证设置
password_encryption = scram-sha-256

# - Logging Settings - 日志设置
log_destination = 'stderr'
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d
log_rotation_size = 100MB

# - Replication Settings - 复制设置
# 启用WAL日志归档
wal_level = replica         # 日志级别，支持复制
archive_mode = on           # 归档模式开启
archive_command = 'cp %p /var/lib/postgresql/data/archive/%f'

# 复制槽设置
max_wal_senders = 10        # 最大WAL发送进程数
max_replication_slots = 10  # 最大复制槽数
wal_keep_size = 16384       # 保留的WAL大小，单位MB

# - Performance Settings - 性能设置
shared_buffers = 128MB      # 共享缓冲区
work_mem = 4MB              # 工作内存
maintenance_work_mem = 64MB # 维护工作内存
checkpoint_completion_target = 0.9
random_page_cost = 1.1

# - Other Settings - 其他设置
cluster_name = 'yyc3-postgres-slave'
data_directory = '/var/lib/postgresql/data/pgdata'

# 从服务器特定配置
hot_standby = on            # 启用热备模式
max_standby_streaming_delay = 30s
wal_receiver_status_interval = 10s
hot_standby_feedback = on

# 自动生成的配置
include_if_exists = 'postgresql.auto.conf'
