<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Changelog å·®å¼‚å¯¹æ¯” - 0379.email</title>
  <style>
    /* åŸºç¡€æ ·å¼ */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f9f9f9;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* æ ‡é¢˜æ ·å¼ */
    h1 {
      color: #2c3e50;
      margin-bottom: 30px;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    h1::before {
      content: 'ğŸ“Š';
      font-size: 1.2em;
    }
    
    h2 {
      color: #34495e;
      margin-top: 30px;
      margin-bottom: 20px;
      border-left: 4px solid #3498db;
      padding-left: 15px;
    }
    
    /* ç‰ˆæœ¬é€‰æ‹©å™¨æ ·å¼ */
    .selectors {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .selector-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    label {
      font-weight: bold;
      color: #2c3e50;
    }
    
    select {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: white;
      font-size: 16px;
      min-width: 250px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: border-color 0.3s;
    }
    
    select:focus {
      outline: none;
      border-color: #3498db;
    }
    
    /* å·®å¼‚ç»“æœæ ·å¼ */
    #diffResult {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .change-block {
      margin-bottom: 30px;
    }
    
    .change-list {
      list-style-type: none;
      padding: 0;
    }
    
    .change-item {
      padding: 10px 15px;
      margin-bottom: 8px;
      border-radius: 5px;
      border-left: 3px solid transparent;
      transition: all 0.2s ease;
    }
    
    .change-item:hover {
      transform: translateX(5px);
    }
    
    /* æ–°å¢é¡¹æ ·å¼ */
    .added {
      background-color: #e8f5e9;
      border-left-color: #4caf50;
    }
    
    .added::before {
      content: '+ ';
      color: #4caf50;
      font-weight: bold;
    }
    
    /* åˆ é™¤é¡¹æ ·å¼ */
    .removed {
      background-color: #ffebee;
      border-left-color: #f44336;
    }
    
    .removed::before {
      content: 'â€“ ';
      color: #f44336;
      font-weight: bold;
    }
    
    /* å…±åŒé¡¹æ ·å¼ */
    .unchanged {
      background-color: #f5f5f5;
      border-left-color: #9e9e9e;
      opacity: 0.7;
    }
    
    .unchanged::before {
      content: 'â€¢ ';
      color: #9e9e9e;
    }
    
    /* åŠ è½½çŠ¶æ€æ ·å¼ */
    .loading {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
      font-style: italic;
    }
    
    /* é”™è¯¯æç¤ºæ ·å¼ */
    .error {
      padding: 20px;
      background-color: #ffdddd;
      border: 1px solid #ff9999;
      border-radius: 5px;
      color: #d32f2f;
      margin: 20px 0;
    }
    
    /* ç©ºçŠ¶æ€æ ·å¼ */
    .empty {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
      font-style: italic;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .selectors {
        flex-direction: column;
      }
      
      select {
        width: 100%;
        min-width: auto;
      }
    }
    
    /* æš—è‰²æ¨¡å¼æ”¯æŒ */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #1e1e1e;
        color: #eee;
      }
      
      h1 {
        color: #e0e0e0;
        border-bottom-color: #566473;
      }
      
      h2 {
        color: #d0d0d0;
        border-left-color: #566473;
      }
      
      label {
        color: #e0e0e0;
      }
      
      select {
        background-color: #2d2d2d;
        border-color: #444;
        color: #eee;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      }
      
      #diffResult,
      .selectors {
        background-color: #2d2d2d;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      }
      
      .change-item.unchanged {
        background-color: #404040;
      }
      
      .loading,
      .empty {
        color: #b0b0b0;
      }
      
      .error {
        background-color: #4a2525;
        border-color: #8b4513;
      }
    }
    
    /* æ¯”è¾ƒä¿¡æ¯æ ·å¼ */
    .comparison-info {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #f0f7ff;
      border-radius: 5px;
      border-left: 4px solid #3498db;
    }
    
    @media (prefers-color-scheme: dark) {
      .comparison-info {
        background-color: #2c3e50;
        border-left-color: #566473;
      }
    }
  </style>
</head>
<body>
  <h1>Changelog å·®å¼‚å¯¹æ¯”</h1>
  
  <div class="selectors">
    <div class="selector-group">
      <label for="versionA">ç‰ˆæœ¬ A:</label>
      <select id="versionA"></select>
    </div>
    <div class="selector-group">
      <label for="versionB">ç‰ˆæœ¬ B:</label>
      <select id="versionB"></select>
    </div>
  </div>
  
  <div id="diffResult">
    <div class="loading">åŠ è½½ä¸­...</div>
  </div>

  <script>
    // å…¨å±€æ•°æ®å˜é‡
    let changelogData = [];
    
    /**
     * åŠ è½½ changelog æ•°æ®
     */
    async function loadChangelogData() {
      try {
        const response = await fetch('changelog.json');
        if (!response.ok) {
          throw new Error(`æ— æ³•åŠ è½½ changelog.json: ${response.status}`);
        }
        changelogData = await response.json();
        populateVersionSelectors();
        
        // é»˜è®¤é€‰æ‹©æœ€æ–°çš„ä¸¤ä¸ªç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”
        if (changelogData.length >= 2) {
          document.getElementById('versionA').value = changelogData[1].version; // ä¸Šä¸€ä¸ªç‰ˆæœ¬
          document.getElementById('versionB').value = changelogData[0].version; // æœ€æ–°ç‰ˆæœ¬
          compareVersions();
        } else if (changelogData.length === 1) {
          document.getElementById('versionA').value = changelogData[0].version;
          document.getElementById('versionB').value = changelogData[0].version;
          compareVersions();
        }
      } catch (error) {
        console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
        document.getElementById('diffResult').innerHTML = `
          <div class="error">
            <strong>åŠ è½½å¤±è´¥:</strong> ${error.message}<br>
            è¯·æ£€æŸ¥ changelog.json æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®ã€‚
          </div>
        `;
      }
    }
    
    /**
     * å¡«å……ç‰ˆæœ¬é€‰æ‹©å™¨
     */
    function populateVersionSelectors() {
      const versionA = document.getElementById('versionA');
      const versionB = document.getElementById('versionB');
      
      // æ¸…ç©ºç°æœ‰é€‰é¡¹
      versionA.innerHTML = '';
      versionB.innerHTML = '';
      
      // æ·»åŠ ç‰ˆæœ¬é€‰é¡¹
      changelogData.forEach(entry => {
        // ä¸ºç‰ˆæœ¬ A æ·»åŠ é€‰é¡¹
        const optionA = document.createElement('option');
        optionA.value = entry.version;
        optionA.textContent = `${entry.version} (${entry.date})`;
        versionA.appendChild(optionA);
        
        // ä¸ºç‰ˆæœ¬ B æ·»åŠ é€‰é¡¹
        const optionB = document.createElement('option');
        optionB.value = entry.version;
        optionB.textContent = `${entry.version} (${entry.date})`;
        versionB.appendChild(optionB);
      });
      
      // æ·»åŠ å˜æ›´äº‹ä»¶ç›‘å¬
      versionA.addEventListener('change', compareVersions);
      versionB.addEventListener('change', compareVersions);
    }
    
    /**
     * æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬çš„å·®å¼‚
     */
    function compareVersions() {
      const versionAValue = document.getElementById('versionA').value;
      const versionBValue = document.getElementById('versionB').value;
      
      if (!versionAValue || !versionBValue) {
        document.getElementById('diffResult').innerHTML = '<div class="empty">è¯·é€‰æ‹©è¦æ¯”è¾ƒçš„ä¸¤ä¸ªç‰ˆæœ¬</div>';
        return;
      }
      
      // è·å–ä¸¤ä¸ªç‰ˆæœ¬çš„æ•°æ®
      const entryA = changelogData.find(e => e.version === versionAValue);
      const entryB = changelogData.find(e => e.version === versionBValue);
      
      if (!entryA || !entryB) {
        document.getElementById('diffResult').innerHTML = '<div class="error">æœªæ‰¾åˆ°æŒ‡å®šç‰ˆæœ¬çš„æ•°æ®</div>';
        return;
      }
      
      // æ¸²æŸ“å·®å¼‚ç»“æœ
      renderDiffResult(entryA, entryB);
    }
    
    /**
     * æ¸²æŸ“å·®å¼‚ç»“æœ
     */
    function renderDiffResult(entryA, entryB) {
      const resultContainer = document.getElementById('diffResult');
      resultContainer.innerHTML = '';
      
      // æ·»åŠ æ¯”è¾ƒä¿¡æ¯
      const comparisonInfo = document.createElement('div');
      comparisonInfo.className = 'comparison-info';
      comparisonInfo.innerHTML = `
        <strong>å¯¹æ¯”: ${entryA.version} (${entryA.date}) â†’ ${entryB.version} (${entryB.date})</strong>
      `;
      resultContainer.appendChild(comparisonInfo);
      
      // æ¸²æŸ“ä¸­æ–‡å˜æ›´å·®å¼‚
      resultContainer.appendChild(createChangeSection('ä¸­æ–‡å˜æ›´', entryA.changes.zh || [], entryB.changes.zh || []));
      
      // æ¸²æŸ“è‹±æ–‡å˜æ›´å·®å¼‚
      resultContainer.appendChild(createChangeSection('English Changes', entryA.changes.en || [], entryB.changes.en || []));
    }
    
    /**
     * åˆ›å»ºå˜æ›´åŒºå—
     */
    function createChangeSection(title, changesA, changesB) {
      const section = document.createElement('div');
      section.className = 'change-block';
      
      const sectionTitle = document.createElement('h2');
      sectionTitle.textContent = title;
      section.appendChild(sectionTitle);
      
      const changeList = document.createElement('ul');
      changeList.className = 'change-list';
      
      // è®¡ç®—å·®å¼‚
      const setA = new Set(changesA);
      const setB = new Set(changesB);
      
      // æ‰¾å‡ºæ–°å¢é¡¹ (B ä¸­æœ‰ä½† A ä¸­æ²¡æœ‰çš„)
      const addedItems = Array.from(setB).filter(item => !setA.has(item));
      
      // æ‰¾å‡ºåˆ é™¤é¡¹ (A ä¸­æœ‰ä½† B ä¸­æ²¡æœ‰çš„)
      const removedItems = Array.from(setA).filter(item => !setB.has(item));
      
      // æ‰¾å‡ºå…±åŒé¡¹
      const unchangedItems = Array.from(setA).filter(item => setB.has(item));
      
      // æ·»åŠ æ–°å¢é¡¹
      addedItems.forEach(item => {
        changeList.appendChild(createChangeItem(item, 'added'));
      });
      
      // æ·»åŠ åˆ é™¤é¡¹
      removedItems.forEach(item => {
        changeList.appendChild(createChangeItem(item, 'removed'));
      });
      
      // æ·»åŠ å…±åŒé¡¹
      unchangedItems.forEach(item => {
        changeList.appendChild(createChangeItem(item, 'unchanged'));
      });
      
      // å¦‚æœæ²¡æœ‰å˜æ›´
      if (addedItems.length === 0 && removedItems.length === 0 && unchangedItems.length === 0) {
        const emptyItem = document.createElement('li');
        emptyItem.className = 'empty';
        emptyItem.textContent = 'æ— å˜æ›´è®°å½•';
        changeList.appendChild(emptyItem);
      }
      
      section.appendChild(changeList);
      return section;
    }
    
    /**
     * åˆ›å»ºå˜æ›´é¡¹
     */
    function createChangeItem(text, type) {
      const item = document.createElement('li');
      item.className = `change-item ${type}`;
      item.textContent = text;
      return item;
    }
    
    /**
     * é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
     */
    document.addEventListener('DOMContentLoaded', loadChangelogData);
  </script>
</body>
</html>