# frp 服务维护手册，同时补充各子域名服务的部署可用步骤，确保内容清晰可执行

一、frp 服务维护手册

1. 日常检查命令
操作 命令（服务端 / 客户端）
查看 frps 状态 systemctl status frps.service（服务端）
查看 frpc 状态 systemctl status frpc.service（客户端）
重启 frps systemctl restart frps.service（服务端）
重启 frpc systemctl restart frpc.service（客户端）
查看 frps 日志 tail -f /root/frps/frps.log（服务端）
查看 frpc 日志 tail -f /Volume2/www/frpc/logs/frpc.log（客户端）
验证服务端端口监听 `ss -tulpn grep frps`（服务端）
验证客户端代理状态 curl <http://127.0.0.1:7400/api/proxies（客户端，需输入> admin 账号密码）
故障现象 排查步骤
frpc 连接超时（i/o timeout） 1. 服务端安全组 / 防火墙是否放行 7001 端口；2. 客户端网络是否能访问服务端 IP；3. 服务端公网 IP 是否正确
frpc 连接被重置（EOF） 1. frpc/frps 的 token 是否一致；2. TLS 配置是否两端同步（tls_enable=true）
域名访问无响应 1. DNS 解析是否生效（ping nas.0379.email 看 IP 是否为 8.152.195.33）；2. frps 的 vhost_https_port=4443 是否放行
代理端口通但服务无响应 1. 客户端本地端口服务是否启动（如 `ss -tulpn grep 3000`）；2. 客户端本地防火墙是否放行
1. 证书续签（Let's Encrypt）
Let's Encrypt 证书有效期 90 天，需定期续签：
bash
运行

## 服务端执行（自动续签+重启frps）

certbot renew --quiet
systemctl restart frps.service

## 验证续签结果

certbot certificates
可添加为定时任务（每月 1 日执行）：
bash
运行
crontab -e

## 添加一行

0 0 1 ** certbot renew --quiet && systemctl restart frps.service
二、各子域名服务部署可用步骤
以下是 mail.0379.email 等服务的部署流程，需在 **客户端（群晖）** 操作：

1. 统一前提
确保群晖已安装 Docker（推荐用 Docker 部署服务，更稳定），并开启 SSH 终端。
2. 各服务部署步骤
（1）nas.0379.email（NAS 管理）
无需额外部署：群晖 TOS 已自带管理服务，只需确保 local_port=5443（对应 TOS 的 HTTPS 端口），访问：<https://nas.0379.email:4443>
（2）api.0379.email（API 服务）
用 Docker 启动一个 API 服务（以 Node.js 为例）：
bash
运行
docker run -d --name api-service -p 3000:3000 node:latest

## 进入容器部署API代码（或挂载本地目录）

docker exec -it api-service bash

## （在容器内安装依赖、启动API服务）

验证本地服务：curl <http://127.0.0.1:3000，确保返回正常响应；>
访问域名：<https://api.0379.email:4443>
（3）llm.0379.email（大模型服务）
用 Docker 启动大模型服务（以 Ollama 为例）：
bash
运行
docker run -d --name ollama -p 8000:11434 ollama/ollama

## 拉取模型（如llama3）

docker exec -it ollama ollama pull llama3
验证本地服务：curl <http://127.0.0.1:8000/api/generate> -d '{"model":"llama3","prompt":"hello"}'；
访问域名：<https://llm.0379.email:4443>
（4）admin.0379.email（管理面板）
用 Docker 启动一个管理面板（以 Portainer 为例）：
bash
运行
docker run -d --name portainer -p 3001:9000 portainer/portainer-ce
访问本地初始化：<http://127.0.0.1:3001，设置管理员账号；>
访问域名：<https://admin.0379.email:4443>
（5）mail.0379.email（邮件服务）
用 Docker 启动邮件服务（以 Poste.io 为例）：
bash
运行
docker run -d --name poste -p 3003:80 -p 25:25 -p 465:465 -p 587:587 -p 110:110 -p 995:995 -p 143:143 -p 993:993 -v /volume2/docker/poste:/data poste.io/poste:latest
本地初始化：<http://127.0.0.1:3003，配置域名0379.email；>
访问域名：<https://mail.0379.email:4443>
三、验证所有服务
完成部署后，在本地电脑访问：
<https://nas.0379.email:4443（NAS> 管理）
<https://api.0379.email:4443（API> 服务）
<https://llm.0379.email:4443（大模型）>
<https://admin.0379.email:4443（管理面板）>
<https://mail.0379.email:4443（邮件服务）>
