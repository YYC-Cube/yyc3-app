# YYC3æœåŠ¡æœ€ç»ˆéƒ¨ç½²æ“ä½œæŒ‡å¯¼

> ***YanYuCloudCube***
> **æ ‡è¯­**ï¼šè¨€å¯è±¡é™ | è¯­æ¢æœªæ¥
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **æ ‡è¯­**ï¼šä¸‡è±¡å½’å…ƒäºäº‘æ¢ | æ·±æ ˆæ™ºå¯æ–°çºªå…ƒ
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

## ç¯å¢ƒé…ç½®æ¦‚è¿°

æ ¹æ®`.env.local`æ–‡ä»¶çš„æœ€æ–°é…ç½®ï¼Œæœ¬æ¬¡éƒ¨ç½²æ¶‰åŠä»¥ä¸‹ç¯å¢ƒï¼š

### 1. é˜¿é‡Œäº‘ECSä¿¡æ¯

- **å…¬ç½‘IP**: 8.152.195.33
- **SSHç«¯å£**: 22
- **ç”¨æˆ·å**: root
- **ä¸»æœºå**: yyc3-33
- **SSHè¿æ¥**: `ssh -p 22 root@8.152.195.33`

### 2. ECSæ–‡ä»¶è·¯å¾„

- **frpsé…ç½®**: `/root/frps/frps.toml`
- **frpsæ—¥å¿—**: `/root/frps/frps.log`
- **Nginxä¸»é…ç½®**: `/etc/nginx/nginx.conf`
- **Nginxå­é…ç½®ç›®å½•**: `/etc/nginx/conf.d/`

### 3. NASä¿¡æ¯

- **IP**: 192.168.3.45
- **SSHç«¯å£**: 9557
- **ç”¨æˆ·å**: YYC
- **ä¸»æœºå**: yyc3-45

### 4. NASæ–‡ä»¶è·¯å¾„

- **frpcé…ç½®**: `/Volume2/www/frpc/frpc.toml`
- **frpcæ—¥å¿—**: `/Volume2/www/frpc/logs/frpc.log`

### 5. æœåŠ¡URLé…ç½®

- **APIæœåŠ¡**: <https://api.0379.email>
- **AdminæœåŠ¡**: <https://admin.0379.email>
- **LLMæœåŠ¡**: <https://llm.0379.email>
- **MailæœåŠ¡**: <https://mail.0379.email>
- **MonitoræœåŠ¡**: <https://monitor.0379.email>

## è¯¦ç»†æ“ä½œæ­¥éª¤

### ä¸€ã€æ–‡ä»¶ä¸Šä¼ è‡³ECS

**æ¨èæ–¹æ¡ˆ**: ä¸Šä¼ æ•´ä¸ªappç›®å½•ï¼ˆå®Œæ•´åŒ…å«æ‰€æœ‰æœåŠ¡ä»£ç ã€é…ç½®æ–‡ä»¶å’Œä¾èµ–ï¼‰

```bash
# ä»æœ¬åœ°Macä¸Šä¼ åˆ°ECSï¼ˆç¡®ä¿åœ¨appç›®å½•å¤–æ‰§è¡Œï¼‰
scp -r -P 22 /Users/yanyu/www/yyc3-22/app root@8.152.195.33:/opt/yyc3
```

**å¤‡é€‰æ–¹æ¡ˆ**: ä»…ä¸Šä¼ å¿…è¦çš„æœåŠ¡æ–‡ä»¶

```bash
# ä¸Šä¼ servicesç›®å½•ï¼ˆæœåŠ¡ä»£ç ï¼‰
scp -r -P 22 /Users/yanyu/www/yyc3-22/app/services root@8.152.195.33:/opt/yyc3/services

# ä¸Šä¼ Nginxé…ç½®æ–‡ä»¶
scp -P 22 /Users/yanyu/www/yyc3-22/app/nginx-main.conf root@8.152.195.33:/tmp/
scp -P 22 /Users/yanyu/www/yyc3-22/app/nginx-yyc3-blue.conf root@8.152.195.33:/tmp/
scp -P 22 /Users/yanyu/www/yyc3-22/app/nginx-yyc3-green.conf root@8.152.195.33:/tmp/

# ä¸Šä¼ docker-compose.yml
scp -P 22 /Users/yanyu/www/yyc3-22/app/docker-compose.yml root@8.152.195.33:/opt/yyc3/
```

### äºŒã€ECSä¸Šçš„é…ç½®æ“ä½œ

#### 1. æ›´æ–°Nginxé…ç½®

```bash
# è¿æ¥åˆ°ECS
ssh -p 22 root@8.152.195.33

# å¤‡ä»½åŸæœ‰Nginxé…ç½®
cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak

# å¤åˆ¶æ–°é…ç½®æ–‡ä»¶
cp /tmp/nginx-main.conf /etc/nginx/nginx.conf
cp /tmp/nginx-yyc3-blue.conf /etc/nginx/conf.d/
cp /tmp/nginx-yyc3-green.conf /etc/nginx/conf.d/

# éªŒè¯Nginxé…ç½®
nginx -t

# é‡å¯NginxæœåŠ¡
systemctl reload nginx
```

#### 2. æ£€æŸ¥frpsé…ç½®

```bash
# æŸ¥çœ‹å½“å‰frpsé…ç½®
cat /root/frps/frps.toml

# ç¡®è®¤é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯ï¼š
# - bind_port = 7001
# - dashboard_port = 7500
# - vhost_http_port = 18080
# - vhost_https_port = 4443
# - allow_ports = [5001,5002,5003,5004,5005,5006,6000]

# æ£€æŸ¥frpsæœåŠ¡çŠ¶æ€
systemctl status frps

# å¦‚æœéœ€è¦é‡å¯frps
systemctl restart frps
```

#### 3. å¯åŠ¨DockeræœåŠ¡

```bash
# è¿›å…¥appç›®å½•
cd /opt/yyc3

# å¯åŠ¨æ‰€æœ‰DockeræœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æ£€æŸ¥æœåŠ¡æ—¥å¿—
docker-compose logs -f
```

### ä¸‰ã€NASä¸Šçš„æ“ä½œ

#### 1. è¿æ¥åˆ°NAS

```bash
ssh -p 9557 YYC@192.168.3.45
```

#### 2. æ£€æŸ¥frpcé…ç½®

```bash
# æŸ¥çœ‹frpcé…ç½®
cat /Volume2/www/frpc/frpc.toml

# ç¡®è®¤é…ç½®æ˜¯å¦ä¸ECSä¸Šçš„frpsåŒ¹é…ï¼Œç‰¹åˆ«æ˜¯ï¼š
# - server_addr = "8.152.195.33"
# - server_port = 7001
# - token = "yyc3_nas"ï¼ˆéœ€ä¸frpsé…ç½®ä¸€è‡´ï¼‰
# - å„ä»£ç†è§„åˆ™çš„local_portæ˜¯å¦ä¸Dockeræ˜ å°„ç«¯å£ä¸€è‡´
```

#### 3. é‡å¯frpcæœåŠ¡

```bash
# æ ¹æ®NASä¸Šçš„æœåŠ¡ç®¡ç†æ–¹å¼é‡å¯frpc
# ç¤ºä¾‹ï¼šå¦‚æœæ˜¯systemdç®¡ç†
# systemctl restart frpc

# å¦‚æœæ˜¯ç›´æ¥è¿è¡Œ
# å…ˆåœæ­¢ç°æœ‰è¿›ç¨‹
pkill -f frpc
# é‡æ–°å¯åŠ¨
/Volume2/www/frpc/frpc -c /Volume2/www/frpc/frpc.toml > /Volume2/www/frpc/logs/frpc.log 2>&1 &
```

#### 4. éªŒè¯frpcè¿æ¥

```bash
# æŸ¥çœ‹frpcæ—¥å¿—
cat /Volume2/www/frpc/logs/frpc.log

# ç¡®è®¤æ˜¯å¦æœ‰"start proxy success"ç­‰æˆåŠŸè¿æ¥çš„æ—¥å¿—
```

### å››ã€æœåŠ¡éªŒè¯

#### 1. æœ¬åœ°ç«¯å£æµ‹è¯•

```bash
# è¿æ¥åˆ°ECS
ssh -p 22 root@8.152.195.33

# æµ‹è¯•å„æœåŠ¡çš„æœ¬åœ°ç«¯å£
curl http://localhost:6600/health  # APIæœåŠ¡
curl http://localhost:6601/health  # AdminæœåŠ¡
curl http://localhost:6602/health  # LLMæœåŠ¡
curl http://localhost:6603/health  # MailæœåŠ¡
curl http://localhost:3002/health  # MonitoræœåŠ¡
```

#### 2. åŸŸåè®¿é—®æµ‹è¯•

ä½¿ç”¨æµè§ˆå™¨æˆ–curlæµ‹è¯•ä»¥ä¸‹æœåŠ¡URLï¼š

- **APIæœåŠ¡**: `https://api.0379.email/health`
- **AdminæœåŠ¡**: `https://admin.0379.email/health`
- **LLMæœåŠ¡**: `https://llm.0379.email/health`
- **MailæœåŠ¡**: `https://mail.0379.email/health`
- **MonitoræœåŠ¡**: `https://monitor.0379.email/health`

#### 3. frpè¿æ¥éªŒè¯

```bash
# è¿æ¥åˆ°ECS
ssh -p 22 root@8.152.195.33

# ä½¿ç”¨frpsä»ªè¡¨æ¿æ£€æŸ¥è¿æ¥çŠ¶æ€
curl -u yyc3:my151001 http://localhost:7500/api/proxy/tcp
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### 1. Nginxé…ç½®é”™è¯¯

```bash
# æ£€æŸ¥Nginxé”™è¯¯æ—¥å¿—
cat /var/log/nginx/error.log

# é‡æ–°éªŒè¯Nginxé…ç½®
nginx -t
```

### 2. DockeræœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs --tail=100

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps -a
```

### 3. frpè¿æ¥é—®é¢˜

```bash
# æ£€æŸ¥ECSä¸Šçš„frpsæ—¥å¿—
cat /root/frps/frps.log

# æ£€æŸ¥NASä¸Šçš„frpcæ—¥å¿—
ssh -p 9557 YYC@192.168.3.45 "cat /Volume2/www/frpc/logs/frpc.log"
```

## éƒ¨ç½²å®Œæˆç¡®è®¤

æ‰€æœ‰æœåŠ¡éªŒè¯é€šè¿‡åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆéƒ¨ç½²ç¡®è®¤æŠ¥å‘Šï¼š

```bash
# è¿æ¥åˆ°ECS
ssh -p 22 root@8.152.195.33

# åˆ›å»ºéƒ¨ç½²æŠ¥å‘Š
cat > /opt/yyc3/deployment_report_$(date +%Y%m%d_%H%M%S).txt << EOF
YYC3æœåŠ¡éƒ¨ç½²æŠ¥å‘Š
éƒ¨ç½²æ—¶é—´: $(date)

1. ECSä¿¡æ¯
- IP: 8.152.195.33
- ä¸»æœºå: $(hostname)

2. æœåŠ¡çŠ¶æ€
$(docker-compose -f /opt/yyc3/docker-compose.yml ps)

3. NginxçŠ¶æ€
$(systemctl status nginx | grep -E 'Active:|Main PID:')

4. frpsçŠ¶æ€
$(systemctl status frps | grep -E 'Active:|Main PID:')

5. ç«¯å£ç›‘å¬
$(ss -tulpn | grep -E '80|443|5001|5002|5003|5004|5005|5006|6600|6601|6602|6603|3002')
EOF

# æŸ¥çœ‹æŠ¥å‘Š
cat /opt/yyc3/deployment_report_*.txt
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

1. **é…ç½®æ–‡ä»¶ä¿æŠ¤**: ç¡®ä¿æ‰€æœ‰é…ç½®æ–‡ä»¶çš„æƒé™æ­£ç¡®è®¾ç½®ï¼Œé¿å…æ•æ„Ÿä¿¡æ¯æ³„éœ²

   ```bash
   chmod 600 /root/frps/frps.toml
   chmod 600 /etc/nginx/nginx.conf
   ```

2. **å®šæœŸå¤‡ä»½**: å®šæœŸå¤‡ä»½å…³é”®é…ç½®æ–‡ä»¶å’Œæ•°æ®

   ```bash
   # å¤‡ä»½é…ç½®æ–‡ä»¶åˆ°NAS
   rsync -avz -e "ssh -p 9557" /opt/yyc3 root@192.168.3.45:/Volume2/www/yyc3_backup/
   ```

3. **æ—¥å¿—ç›‘æ§**: å®šæœŸæ£€æŸ¥æœåŠ¡æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸

ä¿æŒä»£ç å¥åº·ï¼Œç¨³æ­¥å‰è¡Œï¼ ğŸŒ¹

---

> ã€Œ***YanYuCloudCube***ã€
> ã€Œ***<admin@0379.email>***ã€
> ã€Œ***Words Initiate Quadrants, Language Serves as Core for the Future***ã€
> ã€Œ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***ã€
