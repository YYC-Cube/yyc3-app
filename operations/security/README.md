# 0379.email å®‰å…¨ç®¡ç†ç³»ç»Ÿ

## ğŸ” å¤šæœºSSHå¯†é’¥ç®¡ç†å™¨

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„SSHå¯†é’¥ç”Ÿæˆã€åˆ†å‘ã€è½®æ¢å’Œç®¡ç†ç³»ç»Ÿï¼Œç”¨äº0379.emailé¡¹ç›®çš„å¤šæœºç¯å¢ƒã€‚

### ğŸ¯ åŠŸèƒ½ç‰¹æ€§

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… **è‡ªåŠ¨å¯†é’¥ç”Ÿæˆ**: ä¸ºæ‰€æœ‰æœåŠ¡å™¨ç”ŸæˆED25519/RSAå¯†é’¥å¯¹
- âœ… **æ‰¹é‡å¯†é’¥åˆ†å‘**: è‡ªåŠ¨åˆ†å‘å¯†é’¥åˆ°æ‰€æœ‰ç›®æ ‡æœåŠ¡å™¨
- âœ… **è¿æ¥æµ‹è¯•**: æµ‹è¯•æœåŠ¡å™¨è¿é€šæ€§å’ŒSSHæœåŠ¡
- âœ… **é…ç½®ç®¡ç†**: ç”Ÿæˆæœ¬åœ°SSHé…ç½®æ–‡ä»¶
- âœ… **å¯†é’¥è½®æ¢**: æ”¯æŒå•ä¸ªæˆ–æ‰¹é‡å¯†é’¥è½®æ¢
- âœ… **å®‰å…¨å®¡è®¡**: æ£€æŸ¥å¯†é’¥æƒé™å’Œå®‰å…¨æ€§

#### é«˜çº§åŠŸèƒ½
- ğŸ”’ **ç¯å¢ƒéš”ç¦»**: æŒ‰ç¯å¢ƒ(ç”Ÿäº§/å­˜å‚¨/å¼€å‘ç­‰)ç®¡ç†æœåŠ¡å™¨
- ğŸ”„ **è‡ªåŠ¨æ•…éšœæ¢å¤**: å¯†é’¥åˆ†å‘å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
- ğŸ“Š **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„æ“ä½œæ—¥å¿—å’Œå®¡è®¡è·Ÿè¸ª
- ğŸ’¾ **è‡ªåŠ¨å¤‡ä»½**: å¯†é’¥æ–‡ä»¶è‡ªåŠ¨å¤‡ä»½
- ğŸ›¡ï¸ **å®‰å…¨åŠ å›º**: æœåŠ¡å™¨SSHå®‰å…¨é…ç½®

### ğŸ“ æ–‡ä»¶ç»“æ„

```
security/
â”œâ”€â”€ ssh-key-manager.sh          # ä¸»ç®¡ç†è„šæœ¬
â”œâ”€â”€ README.md                   # è¯´æ˜æ–‡æ¡£
â””â”€â”€ keys/                       # å¯†é’¥å­˜å‚¨ç›®å½•
    â”œâ”€â”€ ssh/                    # SSHå¯†é’¥
    â”‚   â”œâ”€â”€ private/            # ç§é’¥æ–‡ä»¶
    â”‚   â”œâ”€â”€ public/             # å…¬é’¥æ–‡ä»¶
    â”‚   â””â”€â”€ authorized_keys/    # æˆæƒå¯†é’¥
    â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
    â”‚   â”œâ”€â”€ servers.json       # æœåŠ¡å™¨é…ç½®
    â”‚   â””â”€â”€ key_index.json     # å¯†é’¥ç´¢å¼•
    â”œâ”€â”€ backup/                 # å¤‡ä»½ç›®å½•
    â””â”€â”€ logs/                   # æ—¥å¿—ç›®å½•
```

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### 1. ç”Ÿæˆæ‰€æœ‰å¯†é’¥
```bash
./security/ssh-key-manager.sh generate
```

#### 2. æµ‹è¯•æœåŠ¡å™¨è¿æ¥
```bash
./security/ssh-key-manager.sh test
```

#### 3. åˆ†å‘å¯†é’¥åˆ°æ‰€æœ‰æœåŠ¡å™¨
```bash
./security/ssh-key-manager.sh distribute
```

#### 4. ç”Ÿæˆæœ¬åœ°SSHé…ç½®
```bash
./security/ssh-key-manager.sh config
```

### ğŸ“‹ è¯¦ç»†ä½¿ç”¨è¯´æ˜

#### æœåŠ¡å™¨é…ç½®

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹ç¯å¢ƒçš„æœåŠ¡å™¨ï¼š

**ç”Ÿäº§ç¯å¢ƒ (production)**
- yyc3-121: 8.130.127.121:22 (ä¸»æœåŠ¡å™¨)
- yyc3-121-backup: 8.130.127.121:2222 (å¤‡ä»½ç«¯å£)

**å­˜å‚¨ç¯å¢ƒ (storage)**
- yyc3-45: 192.168.3.45:57 (NASæœåŠ¡å™¨)
- yyc3-45-backup: 192.168.3.45:2222 (å¤‡ä»½ç«¯å£)

**å¼€å‘ç¯å¢ƒ (development)**
- yyc3-22: 192.168.3.22:22 (M4 Maxå¼€å‘æœº)
- yyc3-66: 192.168.3.66:22 (å¼€å‘æœº66)
- yyc3-77: 192.168.3.77:22 (å¼€å‘æœº77)

**ç›‘æ§ç¯å¢ƒ (monitoring)**
- monitor-01: 192.168.3.100:22 (ç›‘æ§æœåŠ¡å™¨1)
- monitor-02: 192.168.3.101:22 (ç›‘æ§æœåŠ¡å™¨2)

**æ•°æ®åº“ç¯å¢ƒ (database)**
- db-master: 192.168.3.50:22 (ä¸»æ•°æ®åº“)
- db-slave: 192.168.3.51:22 (ä»æ•°æ®åº“)

**åº”ç”¨ç¯å¢ƒ (application)**
- api-01: 192.168.3.60:22 (APIæœåŠ¡å™¨1)
- api-02: 192.168.3.61:22 (APIæœåŠ¡å™¨2)
- api-03: 192.168.3.62:22 (APIæœåŠ¡å™¨3)
- lb-01: 192.168.3.40:22 (è´Ÿè½½å‡è¡¡å™¨1)
- lb-02: 192.168.3.41:22 (è´Ÿè½½å‡è¡¡å™¨2)

#### å‘½ä»¤è¯¦è§£

##### generate - ç”Ÿæˆå¯†é’¥
```bash
# ç”Ÿæˆæ‰€æœ‰æœåŠ¡å™¨å¯†é’¥
./security/ssh-key-manager.sh generate

# ç”Ÿæˆç‰¹å®šæœåŠ¡å™¨å¯†é’¥
./security/ssh-key-manager.sh generate --server yyc3-121

# ç”Ÿæˆç‰¹å®šç¯å¢ƒçš„å¯†é’¥
./security/ssh-key-manager.sh generate --env production
```

##### distribute - åˆ†å‘å¯†é’¥
```bash
# åˆ†å‘æ‰€æœ‰å¯†é’¥
./security/ssh-key-manager.sh distribute

# åˆ†å‘ç‰¹å®šæœåŠ¡å™¨å¯†é’¥
./security/ssh-key-manager.sh distribute --server yyc3-121

# å¼ºåˆ¶åˆ†å‘ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
./security/ssh-key-manager.sh distribute --force
```

##### test - æµ‹è¯•è¿æ¥
```bash
# æµ‹è¯•æ‰€æœ‰æœåŠ¡å™¨è¿æ¥
./security/ssh-key-manager.sh test

# æµ‹è¯•ç‰¹å®šç¯å¢ƒ
./security/ssh-key-manager.sh test --env production
```

##### rotate - å¯†é’¥è½®æ¢
```bash
# è½®æ¢æ‰€æœ‰å¯†é’¥ï¼ˆéœ€è¦ç¡®è®¤ï¼‰
./security/ssh-key-manager.sh rotate

# è½®æ¢ç‰¹å®šæœåŠ¡å™¨å¯†é’¥
./security/ssh-key-manager.sh rotate --server yyc3-121
```

##### audit - å®‰å…¨å®¡è®¡
```bash
# æ‰§è¡Œå®Œæ•´å®‰å…¨å®¡è®¡
./security/ssh-key-manager.sh audit

# å®¡è®¡å†…å®¹åŒ…æ‹¬ï¼š
# - å¯†é’¥æ–‡ä»¶æƒé™æ£€æŸ¥
# - é…ç½®æ–‡ä»¶æƒé™æ£€æŸ¥
# - å¯†é’¥æœ‰æ•ˆæœŸæ£€æŸ¥
# - ç”Ÿæˆå®‰å…¨å®¡è®¡æŠ¥å‘Š
```

##### status - æ˜¾ç¤ºçŠ¶æ€
```bash
# æ˜¾ç¤ºå½“å‰ç³»ç»ŸçŠ¶æ€
./security/ssh-key-manager.sh status

# æ˜¾ç¤ºå†…å®¹ï¼š
# - å¯†é’¥ç»Ÿè®¡ä¿¡æ¯
# - æœåŠ¡å™¨é…ç½®çŠ¶æ€
# - æ–‡ä»¶ä½ç½®
# - å¤‡ä»½æƒ…å†µ
```

### ğŸ”§ SSHé…ç½®ä½¿ç”¨

å¯†é’¥åˆ†å‘å®Œæˆåï¼Œå¯ä»¥é€šè¿‡SSHç›´æ¥è¿æ¥æœåŠ¡å™¨ï¼š

```bash
# è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨
ssh yyc3-121

# è¿æ¥åˆ°NASæœåŠ¡å™¨
ssh yyc3-45

# è¿æ¥åˆ°å¼€å‘æœº
ssh yyc3-22
```

æœ¬åœ°SSHé…ç½®æ–‡ä»¶ä½ç½®ï¼š`~/.ssh/config_0379`

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

#### å¯†é’¥å®‰å…¨
- ç§é’¥æ–‡ä»¶æƒé™ï¼š600
- å…¬é’¥æ–‡ä»¶æƒé™ï¼š644
- é…ç½®æ–‡ä»¶æƒé™ï¼š600

#### æœåŠ¡å™¨å®‰å…¨åŠ å›º
- ç¦ç”¨rootç™»å½•
- ç¦ç”¨å¯†ç è®¤è¯
- å¯ç”¨å…¬é’¥è®¤è¯
- é…ç½®ç™»å½•æ¨ªå¹…
- é™åˆ¶SSHè½¬å‘

#### å®¡è®¡å’Œç›‘æ§
- è¯¦ç»†çš„æ“ä½œæ—¥å¿—
- è‡ªåŠ¨å¤‡ä»½æœºåˆ¶
- å®‰å…¨æƒé™æ£€æŸ¥
- å¯†é’¥æœ‰æ•ˆæœŸè·Ÿè¸ª

### ğŸ“‹ æœ€ä½³å®è·µ

#### å®šæœŸç»´æŠ¤
1. **æ¯æœˆæ‰§è¡Œå®‰å…¨å®¡è®¡**
   ```bash
   ./security/ssh-key-manager.sh audit
   ```

2. **æ¯å­£åº¦è½®æ¢å¯†é’¥**
   ```bash
   ./security/ssh-key-manager.sh rotate
   ```

3. **å¤‡ä»½å¯†é’¥æ–‡ä»¶**
   - è‡ªåŠ¨å¤‡ä»½åˆ° `security/keys/backup/`
   - å»ºè®®é¢å¤–å¤‡ä»½åˆ°å®‰å…¨å­˜å‚¨

#### å®‰å…¨å»ºè®®
1. **æœ€å°æƒé™åŸåˆ™**
   - ä¸ºæ¯ä¸ªæœåŠ¡ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·
   - ä»…æˆäºˆå¿…è¦æƒé™

2. **å¯†é’¥ç®¡ç†**
   - å®šæœŸè½®æ¢å¯†é’¥
   - å®‰å…¨å­˜å‚¨å¤‡ä»½å¯†é’¥

3. **ç›‘æ§å‘Šè­¦**
   - ç›‘æ§SSHç™»å½•æ´»åŠ¨
   - è®¾ç½®å¼‚å¸¸è®¿é—®å‘Šè­¦

### ğŸš¨ æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜

**å¯†é’¥åˆ†å‘å¤±è´¥**
```bash
# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping 8.130.127.121

# æ£€æŸ¥SSHæœåŠ¡
telnet 8.130.127.121 22

# æ‰‹åŠ¨åˆ†å‘å¯†é’¥
ssh-copy-id -i ~/.ssh/keys/ssh/public/yyc3-121.pub -p 22 yanyu@8.130.127.121
```

**æƒé™é—®é¢˜**
```bash
# ä¿®å¤å¯†é’¥æƒé™
chmod 600 security/keys/ssh/private/*
chmod 644 security/keys/ssh/public/*
```

**è¿æ¥è¶…æ—¶**
```bash
# å¢åŠ è¿æ¥è¶…æ—¶
ssh -o ConnectTimeout=60 yyc3-121

# æ£€æŸ¥SSHé…ç½®
ssh -v yyc3-121
```

### ğŸ“ æ”¯æŒå’Œè”ç³»

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
2. æ“ä½œæ­¥éª¤
3. ç¯å¢ƒä¿¡æ¯

æŠ€æœ¯æ”¯æŒï¼šsecurity@0379.email

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æ›´æ–°æ—¶é—´**: 2025-11-11
**ç»´æŠ¤å›¢é˜Ÿ**: 0379.email Security Team