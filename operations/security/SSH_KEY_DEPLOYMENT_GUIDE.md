# SSHå¯†é’¥åˆ†å‘éƒ¨ç½²æŒ‡å—

## ğŸ¯ å½“å‰çŠ¶æ€

âœ… **SSHå¯†é’¥ç®¡ç†ç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²**
- 16ä¸ªæœåŠ¡å™¨å¯†é’¥å¯¹å·²ç”Ÿæˆ (ED25519ç®—æ³•)
- SSHé…ç½®æ–‡ä»¶å·²åˆ›å»º (`~/.ssh/config_0379`)
- æ–‡ä»¶æƒé™å·²æ­£ç¡®è®¾ç½®
- æœåŠ¡å™¨è¿é€šæ€§æµ‹è¯•å·²å®Œæˆ

## ğŸ“Š æœåŠ¡å™¨è¿é€šæ€§æµ‹è¯•ç»“æœ

### âœ… ç½‘ç»œå¯è¾¾æœåŠ¡å™¨ (3å°)
1. **yyc3-121** - `8.130.127.121:22` (ç”Ÿäº§ä¸»æœåŠ¡å™¨)
2. **yyc3-121-backup** - `8.130.127.121:2222` (ç”Ÿäº§å¤‡ä»½ç«¯å£)
3. **yyc3-45** - `192.168.3.45:57` (NASæœåŠ¡å™¨)

### âŒ ç½‘ç»œä¸å¯è¾¾æœåŠ¡å™¨ (13å°)
- api-01, api-02, api-03 (192.168.3.60-62)
- lb-01, lb-02 (192.168.3.40-41)
- db-master, db-slave (192.168.3.50-51)
- yyc3-22, yyc3-66, yyc3-77 (192.168.3.22,66,77)
- monitor-01, monitor-02 (192.168.3.100-101)
- yyc3-45-backup (192.168.3.45:2222)

## ğŸ”‘ æ‰‹åŠ¨å¯†é’¥åˆ†å‘æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ssh-copy-id (æ¨è)

```bash
# 1. ç”Ÿäº§æœåŠ¡å™¨ yyc3-121
ssh-copy-id -i /Users/yanyu/security/keys/ssh/public/yyc3-121.pub -p 22 yanyu@8.130.127.121

# 2. ç”Ÿäº§å¤‡ä»½æœåŠ¡å™¨ yyc3-121-backup
ssh-copy-id -i /Users/yanyu/security/keys/ssh/public/yyc3-121-backup.pub -p 2222 yanyu@8.130.127.121

# 3. NASæœåŠ¡å™¨ yyc3-45 (ç«¯å£57å¯èƒ½æœ‰åè®®é—®é¢˜)
ssh-copy-id -i /Users/yanyu/security/keys/ssh/public/yyc3-45.pub -p 57 YYC@192.168.3.45
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¤åˆ¶å…¬é’¥

```bash
# 1. æŸ¥çœ‹å…¬é’¥å†…å®¹
cat /Users/yanyu/security/keys/ssh/public/yyc3-121.pub

# 2. ç™»å½•æœåŠ¡å™¨å¹¶æ‰‹åŠ¨æ·»åŠ 
ssh yanyu@8.130.127.121
mkdir -p ~/.ssh
chmod 700 ~/.ssh
echo "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPE4sMgkJC+am5Wcab6zEs2IFIlxMZz/rP83il0SqEDg 0379-email-yyc3-121-20251111" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
exit
```

## ğŸ”§ è¿æ¥æµ‹è¯•

å®Œæˆå¯†é’¥åˆ†å‘åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•è¿æ¥ï¼š

```bash
# ä½¿ç”¨ç”Ÿæˆçš„SSHé…ç½®æ–‡ä»¶
ssh -F ~/.ssh/config_test yyc3-121-test

# æˆ–è€…ä½¿ç”¨å®Œæ•´å‘½ä»¤
ssh -i /Users/yanyu/security/keys/ssh/private/yyc3-121 -p 22 yanyu@8.130.127.121
```

## ğŸ› ï¸ ä¿®å¤SSHé…ç½®é—®é¢˜

å½“å‰ç”Ÿæˆçš„SSHé…ç½®æ–‡ä»¶åŒ…å«ä¸€äº›ä¸å…¼å®¹çš„é€‰é¡¹ã€‚å·²åˆ›å»ºç®€åŒ–ç‰ˆæœ¬ï¼š

**æ–‡ä»¶ä½ç½®**: `/Users/yanyu/.ssh/config_test`

## ğŸ“‹ å®Œæˆåçš„ä½¿ç”¨æ–¹å¼

å¯†é’¥åˆ†å‘å®Œæˆåï¼Œå¯ä»¥ç®€åŒ–è¿æ¥å‘½ä»¤ï¼š

```bash
# ç®€åŒ–çš„ä¸»æœºåè¿æ¥
ssh yyc3-121      # è¿æ¥ç”Ÿäº§æœåŠ¡å™¨
ssh yyc3-45       # è¿æ¥NASæœåŠ¡å™¨
ssh api-01        # è¿æ¥APIæœåŠ¡å™¨1
ssh db-master     # è¿æ¥ä¸»æ•°æ®åº“
```

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

1. **å®šæœŸè½®æ¢å¯†é’¥**: å»ºè®®æ¯3-6ä¸ªæœˆè½®æ¢ä¸€æ¬¡
2. **ç›‘æ§è®¿é—®æ—¥å¿—**: å®šæœŸæ£€æŸ¥SSHç™»å½•æ—¥å¿—
3. **é™åˆ¶IPè®¿é—®**: åœ¨é˜²ç«å¢™ä¸­é™åˆ¶SSHè®¿é—®æ¥æº
4. **ç¦ç”¨å¯†ç è®¤è¯**: å¯†é’¥åˆ†å‘å®Œæˆåç¦ç”¨å¯†ç è®¤è¯

## ğŸ“ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æƒé™è¢«æ‹’ç» (Permission denied)**
   - æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦å…è®¸å¯†ç è®¤è¯è¿›è¡Œåˆå§‹è®¾ç½®
   - éªŒè¯å…¬é’¥æ–‡ä»¶è·¯å¾„

2. **è¿æ¥è¶…æ—¶ (Connection timeout)**
   - æ£€æŸ¥æœåŠ¡å™¨IPå’Œç«¯å£
   - ç¡®è®¤é˜²ç«å¢™è®¾ç½®
   - éªŒè¯æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿

3. **SSHé…ç½®é”™è¯¯**
   - ä½¿ç”¨ `-F /dev/null` è·³è¿‡é…ç½®æ–‡ä»¶
   - æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•: `ssh -F ~/.ssh/config_test`

### è°ƒè¯•å‘½ä»¤

```bash
# è¯¦ç»†è¿æ¥è°ƒè¯•
ssh -vvv -i /Users/yanyu/security/keys/ssh/private/yyc3-121 -p 22 yanyu@8.130.127.121

# æµ‹è¯•ç«¯å£è¿é€šæ€§
nc -zv 8.130.127.121 22
telnet 8.130.127.121 22
```

## ğŸ“ é‡è¦æ–‡ä»¶ä½ç½®

- **ç§é’¥ç›®å½•**: `/Users/yanyu/security/keys/ssh/private/`
- **å…¬é’¥ç›®å½•**: `/Users/yanyu/security/keys/ssh/public/`
- **æœåŠ¡å™¨é…ç½®**: `/Users/yanyu/security/keys/config/servers.json`
- **SSHé…ç½®**: `/Users/yanyu/.ssh/config_0379` (éœ€ä¿®å¤) æˆ– `/Users/yanyu/.ssh/config_test` (ç®€åŒ–ç‰ˆ)
- **å¤‡ä»½ç›®å½•**: `/Users/yanyu/security/keys/backup/`

---

**ç”Ÿæˆæ—¶é—´**: 2025-11-11
**ç»´æŠ¤å›¢é˜Ÿ**: 0379.email Security Team