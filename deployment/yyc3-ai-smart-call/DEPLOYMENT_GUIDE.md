# YYC3-AI-Smart-Call æ™ºèƒ½å¤–å‘¼ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: YYC3-AI-Smart-Call (æ™ºèƒ½å¤–å‘¼ç³»ç»Ÿ)
**é¡¹ç›®ç±»å‹**: Next.js + React + Prisma å…¨æ ˆåº”ç”¨
**é¡¹ç›®URL**: https://v0-yyc3-ai-call.vercel.app/
**æŠ€æœ¯æ ˆ**: Next.js 15 + React 18 + TypeScript + Prisma + PostgreSQL + Radix UI

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„åˆ†æ

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Next.js 15 (App Router)
- **UI**: Radix UI + Tailwind CSS
- **çŠ¶æ€ç®¡ç†**: Zustand + TanStack Query
- **è¡¨å•**: React Hook Form + Zod
- **å›¾è¡¨**: Recharts
- **åŠ¨ç”»**: Framer Motion + Tailwind CSS Animate
- **ä¸»é¢˜**: Next Themes

### åç«¯æŠ€æœ¯æ ˆ
- **è¿è¡Œæ—¶**: Node.js
- **æ•°æ®åº“**: PostgreSQL + Prisma ORM
- **èº«ä»½éªŒè¯**: NextAuth.js (beta)
- **å®æ—¶é€šä¿¡**: Socket.IO
- **æ–‡ä»¶å¤„ç†**: å†…ç½®API Routes

### åŠŸèƒ½ç‰¹æ€§
- ğŸ¤– **æ™ºèƒ½å¯¹è¯**: AIé©±åŠ¨çš„å¯¹è¯ç³»ç»Ÿ
- ğŸ“Š **æ•°æ®å¯è§†åŒ–**: å›¾è¡¨å’Œç»Ÿè®¡é¢æ¿
- ğŸ‘¥ **ç”¨æˆ·ç®¡ç†**: å®Œæ•´çš„ç”¨æˆ·æƒé™ç³»ç»Ÿ
- ğŸ“ **é€šè¯ç®¡ç†**: å‘¼å«è®°å½•å’Œåˆ†æ
- ğŸ” **å®‰å…¨ç³»ç»Ÿ**: JWTè®¤è¯å’Œæƒé™æ§åˆ¶

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¼€å‘ç¯å¢ƒæ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ’» å¼€å‘è€…æœºå™¨ (YYC3-22)                                â”‚
â”‚  â”œâ”€ Next.js å¼€å‘æœåŠ¡å™¨ (ç«¯å£ 3123)                      â”‚
â”‚  â”œâ”€ çƒ­é‡åŠ è½½æ”¯æŒ                                      â”‚
â”‚  â”œâ”€ TypeScript ç±»å‹æ£€æŸ¥                                  â”‚
â”‚  â””â”€ æµè§ˆå™¨å¼€å‘å·¥å…·                                    â”‚
â”‚                                                             â”‚
â”‚  ğŸ—„ï¸ æ•°æ®åº“æœåŠ¡ (æœ¬åœ°/å®¹å™¨)                               â”‚
â”‚  â”œâ”€ PostgreSQL å¼€å‘å®ä¾‹ (ç«¯å£ 5432)                       â”‚
â”‚  â”œâ”€ Prisma Studio å¼€å‘å·¥å…·                               â”‚
â”‚  â””â”€ æ•°æ®åº“ç§å­å’Œè¿ç§»                                    â”‚
â”‚                                                             â”‚
â”‚  ğŸ”§ å¼€å‘å·¥å…·                                              â”‚
â”‚  â”œâ”€ VS Code + æ‰©å±•æ’ä»¶                                      â”‚
â”‚  â”œâ”€ Git ç‰ˆæœ¬æ§åˆ¶                                         â”‚
â”‚  â”œâ”€ Docker Desktop                                    â”‚
â”‚  â””â”€ Postman APIæµ‹è¯•                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿäº§ç¯å¢ƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”Ÿäº§ç¯å¢ƒæ¶æ„                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸŒ äº‘æœåŠ¡å™¨ (YYC3-121)                                    â”‚
â”‚  â”œâ”€ Nginx åå‘ä»£ç† (ç«¯å£ 80/443)                        â”‚
â”‚  â”‚    - SSL ç»ˆç«¯ç‚¹                                        â”‚
â”‚  â”‚    - é™æ€æ–‡ä»¶æœåŠ¡                                      â”‚
â”‚  â”‚    - API ä»£ç†                                        â”‚
â”‚  â”‚    WebSocket æ”¯æŒ                                  â”‚
â”‚  â””â”€ è¯·æ±‚è·¯ç”±å’Œè´Ÿè½½å‡è¡¡                                   â”‚
â”‚                                                             â”‚
â”‚  âš¡ åº”ç”¨æœåŠ¡å™¨é›†ç¾¤                                        â”‚
â”‚  â”œâ”€ Next.js åº”ç”¨å®ä¾‹ x2                                   â”‚
â”‚  â”‚    - å®¹å™¨åŒ–éƒ¨ç½²                                       â”‚
â”‚  â”‚    - å¥åº·æ£€æŸ¥ç«¯ç‚¹                                      â”‚
â”‚  â”‚    - å†…å­˜å’ŒCPUé™åˆ¶                                    â”‚
  â””â”€ è‡ªåŠ¨æ‰©ç¼©å’Œæ»šåŠ¨æ›´æ–°                                   â”‚
â”‚                                                             â”‚
|  ğŸ“Š æ•°æ®æœåŠ¡å™¨ (YYC3-45 NAS)                               â”‚
|  â”œâ”€ PostgreSQL ä¸»æ•°æ®åº“ (ç«¯å£ 5432)                       â”‚
|  â”œâ”€ Prisma ç”Ÿäº§æ•°æ®åº“                                     â”‚
|  â”œâ”€ æ•°æ®å¤‡ä»½å’Œå½’æ¡£                                        â”‚
|  â””â”€ æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–                                       â”‚
â”‚                                                             â”‚
|  ğŸ—„ï¸ ç¼“å­˜æœåŠ¡                                              â”‚
  â”œâ”€ Redis ç¼“å­˜ (ç«¯å£ 6379)                                  â”‚
  â”œâ”€ ä¼šè¯å­˜å‚¨                                              â”‚
  â”œâ”€ APIå“åº”ç¼“å­˜                                           â”‚
  â””â”€ å®æ—¶æ•°æ®ç¼“å­˜                                          â”‚
â”‚                                                             â”‚
|  ğŸ”’ ç›‘æ§å’Œæ—¥å¿—                                            â”‚
  â”œâ”€ Winston æ—¥å¿—ç³»ç»Ÿ                                     â”‚
  â”œâ”€ Prometheus æŒ‡æ ‡æ”¶é›†                                   â”‚
  â”œâ”€ Grafana ç›‘æ§é¢æ¿                                      â”‚
  â”œâ”€ ELK Stack æ—¥å¿—åˆ†æ                                   â”‚
  â””â”€ é”™è¯¯è¿½è¸ªå’Œå‘Šè­¦                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ é¡¹ç›®ç»“æ„è¯¦è§£

### é¡¹ç›®ç›®å½•
```
yyc3-ai-smart-call/
â”œâ”€â”€ prisma/                   # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ schema.prisma          # æ•°æ®åº“æ¨¡å¼å®šä¹‰
â”‚   â”œâ”€â”€ migrations/             # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚   â”œâ”€â”€ seed.ts                # æ•°æ®åº“ç§å­æ•°æ®
â”‚   â””â”€â”€ generate-client/        # ç”ŸæˆPrismaå®¢æˆ·ç«¯
â”œâ”€â”€ src/                       # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app/                   # Next.jsåº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ globals.css          # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # æ ¹å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â””â”€â”€ page.tsx            # é¡µé¢æ¨¡æ¿
â”‚   â”œâ”€â”€ pages/                  # Next.jsé¡µé¢
â”‚   â”‚   â”œâ”€â”€ api/                # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯API
â”‚   â”‚   â”‚   â”œâ”€â”€ ai-call/        # AIå¯¹è¯API
â”‚   â”‚   â”‚   â”œâ”€â”€ users/          # ç”¨æˆ·ç®¡ç†API
â”‚   â”‚   â”‚   â””â”€â”€ analytics/     # åˆ†æç»Ÿè®¡API
â”‚   â”‚   â”œâ”€â”€ dashboard/          # ä»ªè¡¨æ¿é¡µé¢
â”‚   â”‚   â”œâ”€â”€ chat/              # å¯¹è¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ calls/             # é€šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ settings/          # è®¾ç½®é¡µé¢
â”‚   â”‚   â””â”€â”€ login/             # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ components/             # Reactç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ ui/               # UIåŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Modal.tsx
â”‚   â”‚   â”œâ”€â”€ layout/            # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”‚   â”œâ”€â”€ forms/             # è¡¨å•ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CallForm.tsx
â”‚   â”‚   â”‚   â””â”€â”€ SettingsForm.tsx
â”‚   â”‚   â””â”€â”€ charts/            # å›¾è¡¨ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ LineChart.tsx
â”‚   â”‚       â”œâ”€â”€ BarChart.tsx
â”‚   â”‚       â””â”€â”€ PieChart.tsx
â”‚   â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useSocket.ts
â”‚   â”‚   â”œâ”€â”€ useLocalStorage.ts
â”‚   â”‚   â””â”€â”€ useDebounce.ts
â”‚   â”œâ”€â”€ lib/                   # å·¥å…·å‡½æ•°åº“
â”‚   â”‚   â”œâ”€â”€ utils.ts
â”‚   â”‚   â”œâ”€â”€ validations.ts
â”‚   â”‚   â”œâ”€â”€ constants.ts
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”œâ”€â”€ store/                 # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ authStore.ts
â”‚   â”‚   â”œâ”€â”€ callStore.ts
â”‚   â”‚   â””â”€â”€ settingsStore.ts
â”‚   â”œâ”€â”€ styles/                # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â””â”€â”€ components.css
â”‚   â””â”€â”€ types/                  # TypeScriptç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ api.ts
â”‚       â”œâ”€â”€ auth.ts
â”‚       â””â”€â”€ database.ts
â”œâ”€â”€ public/                    # é™æ€èµ„æº
â”‚   â”œâ”€â”€ icons/               # å›¾æ ‡æ–‡ä»¶
â”‚   â”œâ”€â”€ images/              # å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ scripts/                  # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ build.sh              # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh              # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ backup.sh              # å¤‡ä»½è„šæœ¬
â”‚   â””â”€â”€ test.sh                # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ docker/                   # Dockeré…ç½®
â”‚   â”œâ”€â”€ Dockerfile             # åº”ç”¨é•œåƒ
â”‚   â”œâ”€â”€ docker-compose.yml      # æœåŠ¡ç¼–æ’
â”‚   â”œâ”€â”€ docker-compose.prod.yml  # ç”Ÿäº§ç¯å¢ƒ
â”‚   â””â”€â”€ nginx.conf            # Nginxé…ç½®
â”œâ”€â”€ docs/                     # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ API.md               # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ DEPLOYMENT.md         # éƒ¨ç½²æ–‡æ¡£
â”‚   â””â”€â”€ USER_GUIDE.md        # ç”¨æˆ·æŒ‡å—
â”œâ”€â”€ tests/                     # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ __tests__/            # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ e2e/                 # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â””â”€â”€ integration/          # é›†æˆæµ‹è¯•
â””â”€â”€ docker-compose.yml        # å¼€å‘ç¯å¢ƒDocker
```

---

## ğŸ”§ æœ¬åœ°å¼€å‘ç¯å¢ƒéƒ¨ç½²

### 1. ç¯å¢ƒå‡†å¤‡

#### ç³»ç»Ÿè¦æ±‚
```bash
# æ¨èé…ç½®
- å†…å­˜: 8GB+
- å­˜å‚¨: 50GB+
- CPU: 4æ ¸+
- ç½‘ç»œ: ç¨³å®šè¿æ¥

# å¿…éœ€è½¯ä»¶
- Node.js 18+
- Docker & Docker Compose
- PostgreSQL 15+
- Git
- VS Code (æ¨è)
- pnpm (åŒ…ç®¡ç†å™¨)
```

#### å¿«é€Ÿå®‰è£…
```bash
# å®‰è£…Node.js (ä½¿ç”¨nvm)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18

# å®‰è£…pnpm
npm install -g pnpm

# å®‰è£…Docker
curl -fsSL https://get.docker.com -o get-docker.sh | sudo sh
sudo usermod -aG docker $USER

# å®‰è£…PostgreSQL
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgres
sudo systemctl enable postgres
```

### 2. é¡¹ç›®å…‹éš†å’Œåˆå§‹åŒ–

```bash
# 1. å…‹éš†é¡¹ç›® (å‡è®¾å·²æœ‰é¡¹ç›®)
git clone <your-repo-url> yyc3-ai-smart-call
cd yyc3-ai-smart-call

# 2. å®‰è£…ä¾èµ–
pnpm install

# 3. å¤åˆ¶ç¯å¢ƒå˜é‡
cp .env.example .env.local

# 4. é…ç½®ç¯å¢ƒå˜é‡
```

#### ç¯å¢ƒå˜é‡é…ç½®
```bash
# .env.local
# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://postgres:password@localhost:5432/yyc3_ai_smart_call"

# NextAuthé…ç½®
NEXTAUTH_URL="http://localhost:3123/api/auth"
NEXTAUTH_SECRET="your-nextauth-secret-key-here"

# åº”ç”¨é…ç½®
NODE_ENV="development"
NEXT_PUBLIC_APP_URL="http://localhost:3123"
NEXT_PUBLIC_API_URL="http://localhost:3123/api"

# AI APIé…ç½®
OPENAI_API_KEY="your-openai-api-key"
ANTHROPIC_API_KEY="your-anthropic-api-key"

# Prismaé…ç½®
PRISMA_GENERATE_DATAPROXY="true"

# å¼€å‘æœåŠ¡å™¨é…ç½®
PORT=3123
HOST=localhost
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

```bash
# 1. å¯åŠ¨PostgreSQL
sudo systemctl start postgres

# 2. åˆ›å»ºæ•°æ®åº“
sudo -u postgres createdb yyc3_ai_smart_call
sudo -u postgres createuser yyc3_admin
sudo -u postgres psql -c "ALTER USER yyc_admin PASSWORD 'dev_password';"

# 3. æˆäºˆæƒé™
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE yyc3_ai_smart_call TO yyc3_admin;"

# 4. ç”ŸæˆPrismaå®¢æˆ·ç«¯
pnpm prisma generate

# 5. è¿è¡Œæ•°æ®åº“è¿ç§»
pnpm prisma migrate dev

# 6. æ·»åŠ ç§å­æ•°æ®
pnpm prisma db seed
```

### 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# å¯ç”¨å‘½ä»¤
pnpm dev --experimental-https  # HTTPSå¼€å‘
pnpm dev --port 3000      # æŒ‡å®šç«¯å£
pnpm dev --turbo          # å¿«é€Ÿå¼€å‘
```

### 5. æ•°æ®åº“ç®¡ç†å·¥å…·

```bash
# æ‰“å¼€Prisma Studio
pnpm prisma studio

# å¸¸ç”¨Prismaå‘½ä»¤
pnpm prisma generate           # ç”Ÿæˆå®¢æˆ·ç«¯
pnpm prisma migrate deploy       # åº”ç”¨è¿ç§»
pnpm prisma db reset           # é‡ç½®æ•°æ®åº“
pnpm prisma db seed            # æ·»åŠ ç§å­æ•°æ®
pnpm prisma db push            # åŒæ­¥æ¨¡å¼
```

---

## ğŸŒ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. æœåŠ¡å™¨é…ç½®

#### YYC3-121 (ç”Ÿäº§æœåŠ¡å™¨)
```bash
# ç³»ç»Ÿæ›´æ–°
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…è¦è½¯ä»¶
sudo apt install -y nginx docker.io docker-compose-plugin

# é…ç½®Docker
sudo systemctl start docker
sudo systemctl enable docker

# é…ç½®é˜²ç«å¢™
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw enable
```

#### YYC3-45 (æ•°æ®æœåŠ¡å™¨)
```bash
# å®‰è£…PostgreSQL
sudo apt install postgresql postgresql-contrib

# é…ç½®PostgreSQL
sudo sed -i "s/#listen_addresses = 'localhost'/listen_addresses = '*'/" /etc/postgresql/12/main/postgresql.conf
sudo systemctl restart postgres

# é…ç½®è¿œç¨‹è®¿é—®
# åœ¨ /etc/postgresql/12/main/pg_hba.conf ä¸­æ·»åŠ :
# host    all             all             0.0.0.0/0               md5
```

### 2. Dockeréƒ¨ç½²é…ç½®

#### ç”Ÿäº§ç¯å¢ƒDockeré…ç½®
```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    container_name: yyc3-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl:/etc/nginx/ssl
      - static_files:/var/www/static
    depends_on:
      - app
    networks:
      - yyc3-network
    restart: unless-stopped

  app:
    build: .
    container_name: yyc3-app
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://postgres:${DB_PASSWORD}@postgres:5432/${DB_NAME}
      - NEXTAUTH_URL=https://yyc3-ai.com/api/auth
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
    volumes:
      - ./logs:/app/logs
      - /app/.next
    ports:
      - "3001:3000"
    depends_on:
      - postgres
      - redis
    networks:
      - yyc3-network
    restart: unless-stopped
    deploy:
      replicas: 2
      resources:
        limits:
          memory: 2G
          cpus: '1.0'

  postgres:
    image: postgres:15-alpine
    container_name: yyc3-postgres
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backups:/backups
    ports:
      - "5432:5432"
    networks:
      -yyc3-network
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: yyc3-redis
    command: redis-server --requirepass ${REDIS_PASSWORD} --appendonly yes
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    networks:
      - yyc3-network
    restart: unless-stopped

  prometheus:
    image: prom/prometheus:latest
    container_name: yyc3-prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
    networks:
      -yyc3-network
    restart: unless-stopped

  grafana:
    image: grafana/grafana:latest
    container_name: yyc3-grafana
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    volumes:
      - grafana_data:/var/lib/grafana
      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning
    networks:
      - yyc3-network
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
  prometheus_data:
  grafana_data:
  static_files:

networks:
  yyc3-network:
    driver: bridge
```

#### Dockerfileé…ç½®
```dockerfile
# Dockerfile
FROM node:18-alpine AS base

# ä¾èµ–å®‰è£…é˜¶æ®µ
FROM base AS deps
RUN apk add --no-cache libc6-compat

WORKDIR /app

COPY package*.json pnpm-lock.yaml* ./
RUN corepack enable pnpm && pnpm i --frozen-lockfile

# æ„å»ºé˜¶æ®µ
FROM base AS builder
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# ç”ŸæˆPrismaå®¢æˆ·ç«¯
RUN pnpm prisma generate

# åº”ç”¨é˜¶æ®µ
FROM base AS runner
WORKDIR /app

ENV NODE_ENV=production

COPY --from=deps /app/node_modules ./node_modules
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/public ./public

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup --system --gid 1001 nodejs && \
    adduser --system --uid 1001 nodejs

USER nodejs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["npm", "start"]
```

### 3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è„šæœ¬

#### è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# scripts/deploy-prod.sh
set -e

# é¢œè‰²å®šä¹‰
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

log_info() { echo -e "${BLUE}[INFO]${NC} $1"; }
log_success() { echo -e "${GREEN}[SUCCESS]${NC} $1"; }
log_warning() { echo -e "${YELLOW}[WARNING]${NC} $1"; }
log_error() { echo -e "${RED}[ERROR]${NC} $1"; }

# æ£€æŸ¥ç¯å¢ƒ
check_environment() {
    log_info "æ£€æŸ¥éƒ¨ç½²ç¯å¢ƒ..."

    if [[ ! -f ".env.local" ]]; then
        log_error ".env.local æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆé…ç½®"
        exit 1
    fi

    if ! command -v docker &> /dev/null; then
        log_error "Dockeræœªå®‰è£…"
        exit 1
    fi

    log_success "ç¯å¢ƒæ£€æŸ¥é€šè¿‡"
}

# æ„å»ºDockeré•œåƒ
build_images() {
    log_info "æ„å»ºDockeré•œåƒ..."

    docker build -t yyc3-ai-smart-call:latest .

    if [[ $? -eq 0 ]]; then
        log_success "é•œåƒæ„å»ºæˆåŠŸ"
    else
        log_error "é•œåƒæ„å»ºå¤±è´¥"
        exit 1
    fi
}

# å¤‡ä»½æ•°æ®åº“
backup_database() {
    log_info "å¤‡ä»½ç”Ÿäº§æ•°æ®åº“..."

    BACKUP_DIR="./backups/$(date +%Y%m%d_%H%M%S)"
    mkdir -p "$BACKUP_DIR"

    if docker exec yyc3-postgres pg_dump -U yyc3_admin yyc3_ai_prod > "$BACKUP_DIR/backup.sql"; then
        log_success "æ•°æ®åº“å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
    else
        log_error "æ•°æ®åº“å¤‡ä»½å¤±è´¥"
        exit 1
    fi
}

# éƒ¨ç½²åº”ç”¨
deploy_application() {
    log_info "éƒ¨ç½²åº”ç”¨..."

    # åœæ­¢æ—§å®¹å™¨
    docker-compose -f docker-compose.prod.yml down

    # å¯åŠ¨æ–°å®¹å™¨
    docker-compose -f docker-compose.prod.yml up -d

    # ç­‰å¾…æœåŠ¡å¯åŠ¨
    log_info "ç­‰å¾…æœåŠ¡å¯åŠ¨..."
    sleep 30

    # å¥åº·æ£€æŸ¥
    health_check
}

# å¥åº·æ£€æŸ¥
health_check() {
    log_info "æ‰§è¡Œå¥åº·æ£€æŸ¥..."

    # æ£€æŸ¥å‰ç«¯æœåŠ¡
    if curl -f http://localhost/health > /dev/null 2>&1; then
        log_success "å‰ç«¯æœåŠ¡æ­£å¸¸"
    else
        log_error "å‰ç«¯æœåŠ¡å¼‚å¸¸"
    fi

    # æ£€æŸ¥åç«¯æœåŠ¡
    if curl -f http://localhost:3001/health > /dev/null 2>&1; then
        log_success "åç«¯æœåŠ¡æ­£å¸¸"
    else
        log_warning "åç«¯æœåŠ¡å¼‚å¸¸"
    fi

    # æ£€æŸ¥æ•°æ®åº“è¿æ¥
    if docker exec yyc3-postgres pg_isready -U postgres -d yyc3_ai_prod > /dev/null 2>&1; then
        log_success "æ•°æ®åº“è¿æ¥æ­£å¸¸"
    else
        log_warning "æ•°æ®åº“è¿æ¥å¼‚å¸¸"
    fi
}

# ä¸»å‡½æ•°
main() {
    case "${1:-}" in
        "build")
            build_images
            ;;
        "deploy")
            check_environment
            build_images
            deploy_application
            health_check
            ;;
        "backup")
            backup_database
            ;;
        "full")
            check_environment
            build_images
            backup_database
            deploy_application
            health_check
            log_success "ğŸ‰ ç”Ÿäº§éƒ¨ç½²å®Œæˆ!"
            echo "ğŸŒ åº”ç”¨è®¿é—®åœ°å€:"
            echo "   - å‰ç«¯: http://localhost"
            echo "   - ç›‘æ§é¢æ¿: http://localhost:3001 (Grafana)"
            echo "   - APIæ–‡æ¡£: http://localhost/api/docs"
            ;;
        "help"|"--help"|"-h")
            echo "ç”¨æ³•: $0 [å‘½ä»¤]"
            echo ""
            echo "å‘½ä»¤:"
            echo "  build             æ„å»ºDockeré•œåƒ"
            echo "  deploy            éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"
            echo "  backup            å¤‡ä»½æ•°æ®åº“"
            echo "  full              å®Œæ•´éƒ¨ç½²æµç¨‹"
            echo "  help              æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
            ;;
        *)
            log_error "æœªçŸ¥å‘½ä»¤: $1"
            exit 1
            ;;
    esac
}

main "$@"
EOF

chmod +x scripts/deploy-prod.sh
```

### 4. Nginxé…ç½®

#### Nginxä¸»é…ç½®
```nginx
# nginx/nginx.conf
events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    access_log /var/log/nginx/access.log main;
    error_log /var/log/nginx/error.log;

    # åŸºç¡€é…ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/json
        application/javascript
        application/xml+rss
        application/atom+xml
        image/svg+xml
        text/markdown;

    # ä¸Šæ¸¸æœåŠ¡å™¨
    upstream app {
        server app:3000;
        keepalive 32;
    }

    # HTTPé‡å®šå‘
    server {
        listen 80;
        server_name _;
        return 301 https://$host$request_uri;
    }

    # HTTPSé…ç½®
    server {
        listen 443 ssl http2;
        server_name your-domain.com;

        # SSLè¯ä¹¦é…ç½®
        ssl_certificate /etc/nginx/ssl/cert.pem;
        ssl_certificate_key /etc/ssl/key.pem;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
        ssl_prefer_server_ciphers off;
        ssl_session_cache shared:SSL:10m;

        # å®‰å…¨å¤´
        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;
        add_header X-XSS-Protection "1; mode=block";
        add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

        # WebSocketæ”¯æŒ
        location /api/ws {
            proxy_pass http://app;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # APIä»£ç†
        location /api/ {
            proxy_pass http://app;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # APIè¯·æ±‚å¤§å°é™åˆ¶
            client_max_body_size 10M;

            # ä»£ç†è¶…æ—¶è®¾ç½®
            proxy_connect_timeout 60s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;
        }

        # å‰ç«¯é™æ€æ–‡ä»¶
        location / {
            root /var/www/static;
            try_files $uri $uri/ /index.html;
            expires 1y;
            add_header Cache-Control "public, immutable";
        }

        # å¥åº·æ£€æŸ¥
        location /health {
            access_log off;
            return 200 "healthy\n";
        }
    }
}
```

---

## ğŸ‘¥ å›¢é˜Ÿå†…éƒ¨æµ‹è¯•éƒ¨ç½²

### æµ‹è¯•ç¯å¢ƒé…ç½®

#### æµ‹è¯•æœåŠ¡å™¨éƒ¨ç½²
```bash
# 1. åˆ›å»ºæµ‹è¯•ç¯å¢ƒç›®å½•
mkdir -p /opt/yyc3-ai-test
cd /opt/yyc3-ai-test

# 2. å…‹éš†é¡¹ç›®ä»£ç 
git clone <your-repo-url> .
pnpm install

# 3. é…ç½®æµ‹è¯•ç¯å¢ƒå˜é‡
cp .env.example .env.local
```

#### æµ‹è¯•ç¯å¢ƒå˜é‡
```bash
# .env.local
NODE_ENV=testing
NEXT_PUBLIC_APP_URL=http://test.yyc3-ai.com
NEXT_PUBLIC_API_URL=http://test.yyc3-api.com
DATABASE_URL="postgresql://postgres:test_password@test-db:5432/yyc3_ai_test"

# æµ‹è¯•ä¸“ç”¨é…ç½®
NEXTAUTH_URL=http://test.yyc3-ai.com/api/auth
OPENAI_API_KEY=test-openai-key
ANTHROPIC_API_KEY=test-anthropic-key

# æµ‹è¯•ç”¨æˆ·æ•°æ®
TEST_USERS='[
  {"username": "test_admin", "password": "TestAdmin123!", "role": "admin", "email": "admin@yyc3.com"},
  {"username": "test_user1", "password": "TestUser123!", "role": "user", "email": "user1@yyc3.com"},
  {"username": "test_user2", "password": "TestUser123!", "role": "user", "email": "user2@yyc3.com"}
]'
```

#### æµ‹è¯•æ•°æ®åˆå§‹åŒ–
```bash
# scripts/init-test-data.sh
#!/bin/bash

echo "ğŸ”„ åˆå§‹åŒ–æµ‹è¯•æ•°æ®..."

# åˆ›å»ºæµ‹è¯•ç”¨æˆ·
echo "$TEST_USERS" > test_users.json

# åˆ›å»ºæµ‹è¯•å¯¹è¯
docker exec yyc3-postgres psql -U postgres -d yyc3_ai_test << 'EOF
-- åˆ›å»ºæµ‹è¯•å¯¹è¯
INSERT INTO ai_conversations (user_id, title, context)
SELECT
  (SELECT id FROM users WHERE username = 'test_user1'),
  'æµ‹è¯•å¯¹è¯1',
  '{"topic": "æµ‹è¯•", "language": "zh-CN"}'
RETURNING id;

-- åˆ›å»ºæµ‹è¯•æ¶ˆæ¯
INSERT INTO ai_messages (conversation_id, content, sender, metadata)
SELECT
  (SELECT id FROM ai_conversations WHERE title = 'æµ‹è¯•å¯¹è¯1'),
  'è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯',
  'user',
  '{"test": true}'
RETURNING id;
EOF

echo "âœ… æµ‹è¯•æ•°æ®åˆå§‹åŒ–å®Œæˆ!"
```

### æµ‹è¯•ç”¨æˆ·ç®¡ç†

#### ç”¨æˆ·åˆ›å»ºè„šæœ¬
```bash
# scripts/create-test-users.sh
#!/bin/bash

# åˆ›å»ºæµ‹è¯•ç”¨æˆ·å‡½æ•°
create_test_user() {
    local username=$1
    local password=$2
    local role=$3
    local email=$4

    # åœ¨æ•°æ®åº“ä¸­åˆ›å»ºç”¨æˆ·
    docker exec yyc3-postgres psql -U postgres -d yyc3_ai_test << EOF
INSERT INTO users (username, password_hash, full_name, role, email, created_at)
VALUES (
    '$username',
    crypt('\$2b\$$10\$hashed_password'),
    '$roleæµ‹è¯•ç”¨æˆ·',
    '$role',
    '$email',
    NOW()
) ON CONFLICT (username) DO NOTHING;
EOF
}

# æ‰¹è¡Œæµ‹è¯•ç”¨æˆ·åˆ›å»º
create_test_user "test_admin" "TestAdmin123!" "admin" "admin@yyc3.com"
create_test_user "test_user1" "TestUser123!" "user" "user1@yyc3.com"
create_test_user "test_user2" "TestUser123!" "user" "user2@yyc3.com"

echo "âœ… æµ‹è¯•ç”¨æˆ·åˆ›å»ºå®Œæˆ!"
```

### æµ‹è¯•æ‰§è¡Œè®¡åˆ’

#### åŠŸèƒ½æµ‹è¯•æ¸…å•
```markdown
# docs/TESTING_CHECKLIST.md

## åŠŸèƒ½æµ‹è¯•æ¸…å•

### ğŸ” ç”¨æˆ·è®¤è¯æµ‹è¯•
- [ ] ç”¨æˆ·ç™»å½•/ç™»å‡ºåŠŸèƒ½
- [ ] JWTä»¤ç‰ŒéªŒè¯
- [ ] ä¼šè¯è¶…æ—¶å¤„ç†
- [ ] å¯†ç å¼ºåº¦éªŒè¯
- [ ] è®°ä½ç™»å½•çŠ¶æ€

### ğŸ¤– AIå¯¹è¯åŠŸèƒ½æµ‹è¯•
- [ ] å‘é€æ¶ˆæ¯åˆ°AI
- [ ] æ¥æ”¶AIå“åº”
- [ WebSocketè¿æ¥ç¨³å®šæ€§
- [ ] æ¶ˆæ¯å†å²è®°å½•
- [] å®æ—¶æ¶ˆæ¯æ¨é€

### ğŸ“Š æ•°æ®ç®¡ç†æµ‹è¯•
- [ ] å¯¹è¯æ•°æ®æŒä¹…åŒ–
- [ ç”¨æˆ·æ•°æ®ç®¡ç†
- æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- æ•°æ®å¯¼å‡ºåŠŸèƒ½
- æ•°æ®å¤‡ä»½æ¢å¤

### ğŸ“ é€šè¯ç®¡ç†æµ‹è¯•
- é€šè¯è®°å½•åˆ›å»º
- é€šè¯å†å²æŸ¥è¯¢
- é€šè¯çŠ¶æ€è·Ÿè¸ª
- é€šè¯æ•°æ®åˆ†æ

### ğŸ”’ æƒé™ç®¡ç†æµ‹è¯•
- ç®¡ç†å‘˜æƒé™éªŒè¯
- æ™®é€šç”¨æˆ·æƒé™é™åˆ¶
- åŠŸèƒ½è®¿é—®æ§åˆ¶
- æ•°æ®è®¿é—®æ§åˆ¶

### ğŸ¨ ç”¨æˆ·ç•Œé¢æµ‹è¯•
- å“åº”å¼è®¾è®¡æµ‹è¯•
- ç§»åŠ¨ç«¯é€‚é…
- æ— éšœç¢è®¿é—®
- æµè§ˆå™¨å…¼å®¹æ€§
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨ç›‘æ§é…ç½®

#### Prometheusé…ç½®
```yaml
# monitoring/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "alert_rules.yml"

scrape_configs:
  - job_name: 'nextjs'
    static_configs:
      - targets: ['app:3000']
    metrics_path: /api/metrics
    basic_auth:
      - username: admin
      - password: ${GRAFANA_PASSWORD}

  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres:5432']
    basic_auth:
      - username: admin
      - password: ${GRAFANA_PASSWORD}

  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']
    basic_auth:
      - username: admin
      - password: ${GRAFANA_PASSWORD}
```

### 2. Grafanaä»ªè¡¨æ¿

#### ç›‘æ§é¢æ¿é…ç½®
```json
{
  "dashboard": [
    {
      "title": "åº”ç”¨æ€§èƒ½ç›‘æ§",
      "panels": [
        {
          "title": "å“åº”æ—¶é—´",
          "type": "graph",
          "targets": [
            {
              "expr": "http_request_duration_seconds_sum",
              "legendFormat": "{{legend}}"
            }
          ]
        },
        {
          "title": "é”™è¯¯ç‡",
          "type": "stat",
          "targets": [
            {
              "expr": "http_requests_total - http_requests_2xx",
              "legendFormat": "4xx/5xx é”™è¯¯"
            }
          ]
        }
      ]
    },
    {
      "title": "ç”¨æˆ·æ´»è·ƒåº¦",
      "panels": [
        {
          "title": "æ—¥æ´»è·ƒç”¨æˆ·",
          "type": "stat",
          "targets": [
            {
              "expr": "active_users_daily",
              "legendFormat": "æ—¥æ´»è·ƒç”¨æˆ·æ•°"
            }
          ]
        }
      ]
    },
    {
      "title": "AIå¯¹è¯ç»Ÿè®¡",
      "panels": [
        {
          "title": "å¯¹è¯æ•°é‡",
          "type": "stat",
          "targets": [
            {
              "expr": "conversations_created_total",
              "legendFormat": "æ€»å¯¹è¯æ•°"
            }
          ]
        },
        {
          "title": "æ¶ˆæ¯æ•°é‡",
          "type": "stat",
          "target_dict": {
            "conversation_messages": {
              "messages_today",
              "messages_this_week",
              "messages_this_month"
            }
          }
        }
      ]
    }
  ]
}
```

### 3. æ—¥å¿—ç®¡ç†ç³»ç»Ÿ

#### Winstonæ—¥å¿—é…ç½®
```typescript
// src/lib/logger.ts
import winston from 'winston';
import { NextApiResponse } from 'next/server';
import fs from 'fs';
import path from 'path';

// æ—¥å¿—çº§åˆ«å®šä¹‰
const levels = {
  error: 0,
  warn: 1,
  info: 2,
  http: 3,
  debug: 4,
};

// æ—¥å¿—æ ¼å¼
const logFormat = winston.format.combine(
  winston.format.timestamp(),
  winston.format.errors({ stack: true }),
  winston.format.json()
);

// åˆ›å»ºloggerå®ä¾‹
export const logger = winston.createLogger({
  level: levels.info,
  format: logFormat,
  transports: [
    // æ§åˆ¶å°è¾“å‡º
    new winston.transports.Console({
      level: levels.debug,
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    }),
    // æ–‡ä»¶è¾“å‡º
    new winston.transports.File({
      filename: path.join(process.env.LOGS_DIR || 'logs', 'app.log'),
      level: levels.info,
      format: logFormat,
      maxsize: 20 * 1024 * 1024, // 20MB
      maxFiles: 5,
      tailable: true,
    }),
    // é”™è¯¯æ—¥å¿—å•ç‹¬æ–‡ä»¶
    new winston.transports.File({
      filename: path.join(process.env.LOGS_DIR || 'logs', 'error.log'),
      level: levels.error,
      format: logFormat,
      maxsize: 10 * 1024 * 1024, // 10MB
      maxFiles: 3,
      tailable: true,
    }),
  ],
  exitOnError: false,
});

// HTTPè¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
export const httpLogger = (req: NextApiResponse, res: NextApiResponse) => {
  logger.info('HTTP Request', {
    method: req.method,
    url: req.url,
    status: res.statusCode,
    ip: req.ip,
    userAgent: req.headers['user-agent'],
  });
};
```

---

## ğŸ”’ è¿ç»´å’Œç»´æŠ¤

### 1. è‡ªåŠ¨åŒ–è„šæœ¬

#### å®šæœŸå¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
# scripts/backup-daily.sh
#!/bin/bash
set -e

BACKUP_DIR="/opt/backups/yyc3-ai/$(date +%Y%m%d)"
DATE=$(date +%Y%m%d_%H%M%S)

echo "ğŸ”„ å¼€å§‹æ—¥å¸¸å¤‡ä»½..."

# æ•°æ®åº“å¤‡ä»½
docker exec yyc3-postgres pg_dump -U yyc3_admin yyc3_ai_prod > "$BACKUP_DIR/db_$DATE.sql"

# åº”ç”¨æ–‡ä»¶å¤‡ä»½
docker cp -r yyc3-app:/var/www/static "$BACKUP_DIR/static_$DATE"

# é…ç½®æ–‡ä»¶å¤‡ä»½
tar -czf "$BACKUPDIR/configs_$DATE.tar.gz" ./configs

# æ—¥å¿—æ–‡ä»¶å¤‡ä»½
tar -czf "$BACKUPDIR/logs_$DATE.tar.gz" ./logs

echo "âœ… å¤‡ä»½å®Œæˆ: $BACKUP_DIR"

# æ¸…ç†æ—§å¤‡ä»½ (ä¿ç•™30å¤©)
find /opt/backups/yyc3-ai -type d -mtime +30 -exec rm -rf {} +
```

#### å¥åº·æ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
# scripts/health-check.sh
#!/bin/bash
set -e

echo "ğŸ¥ æ‰§è¡Œå¥åº·æ£€æŸ¥..."

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
services=("nginx" "app" "postgres" "redis")
healthy_services=0

for service in "${services[@]}"; do
    if docker ps --filter "name=yyc3-$service" --format "table {{.Names}}" | grep -q "Up"; then
        ((healthy_services++))
        echo "âœ… $service: æ­£å¸¸"
    else
        echo "âŒ $service: å¼‚å¸¸"
    fi
done

# æ£€æŸ¥èµ„æºä½¿ç”¨
echo ""
echo "ğŸ“Š ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ:"
df -h | grep -E "(Filesystem|/dev/sd.*|Used)"

echo ""
echo "ğŸ³ å†…å­˜ä½¿ç”¨æƒ…å†µ:"
free -h

echo ""
echo "ğŸ”— ç½‘ç»œè¿æ¥æ•°:"
netstat -an | grep :80 | wc -l

echo ""
echo "ğŸ“Š æœåŠ¡çŠ¶æ€ç»Ÿè®¡:"
echo "å¥åº·æœåŠ¡: $healthy_services/${#services[@]}"

# æ£€æŸ¥ç£ç›˜ç©ºé—´
disk_usage=$(df / | grep -vE '^/dev/sd.*' | awk '{print $5}' | sort -n | tail -1)
available_gb=$((disk_usage / 1024 / 1024))

if [[ $available_gb -lt 10 ]]; then
    echo "âš ï¸ è­¦å‘Š: ç£ç›˜ç©ºé—´ä¸è¶³ (å‰©ä½™ ${available_gb}GB)"
else
    echo "âœ… ç£ç›˜ç©ºé—´å……è¶³ (å‰©ä½™ ${available_gb}GB)"
fi
```

### 2. æ€§èƒ½ä¼˜åŒ–

#### æ•°æ®åº“ä¼˜åŒ–
```sql
-- PostgreSQLæ€§èƒ½ä¼˜åŒ–é…ç½®
-- åœ¨postgresql.confä¸­è®¾ç½®

-- å†…å­˜é…ç½®
shared_buffers = 4GB
effective_cache_size = 12GB
work_mem = 256MB
maintenance_work_mem = 1GB

-- è¿æ¥é…ç½®
max_connections = 200
superuser_reserved_connections = 3

-- æŸ¥è¯¢ä¼˜åŒ–
random_page_cost = 1.1
effective_io_concurrency = 200
checkpoint_completion_target = 0.9

-- æ—¥å¿—é…ç½®
log_min_duration_statement = 1000
log_checkpoints = on
log_autovacuum = on
autovacuum_max_workers = 3

-- ç´¢å¼•ä¼˜åŒ–
default_statistics_target = 100
autovacuum_analyze_scale_factor = 0.05
autovacuum_vacuum_scale_factor = 0.1
```

#### åº”ç”¨æ€§èƒ½ä¼˜åŒ–
```typescript
// æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
// src/middleware/performance.ts
import { NextApiRequest, NextApiResponse } from 'next/server';

const start = Date.now();

export const performanceLogger = (
  req: NextApiRequest,
  res: NextApiResponse,
  next: () => void
) => {
  const duration = Date.now() - start;

  // è®°å½•æ…¢æŸ¥è¯¢
  if (duration > 1000) {
    console.warn(`ğŸŒ Slow Request: ${req.method} ${req.url} (${duration}ms)`);
  }

  // è®°å½•APIè°ƒç”¨
  console.log(`API: ${req.method} ${req.url} (${duration}ms)`);

  next();
};

// èµ„æºç¼“å­˜
const withCache = (cacheDuration = 300000) => {
  return async (target: any, ...args: any[]) => {
    const cacheKey = JSON.stringify(args);

  return new Promise((resolve) => {
      // è¿™é‡Œå®ç°ç¼“å­˜é€»è¾‘
      const cached = cache.get(cacheKey);
      if (cached) {
        return resolve(cached);
      }

      const result = await target(...args);
      cache.set(cacheKey, result, { ttl: cacheDuration });
      resolve(result);
    });
  };
};
```

---

## ğŸ“± å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### éƒ¨ç½²é—®é¢˜

#### é—®é¢˜1: Dockerå®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥å®¹å™¨æ—¥å¿—
docker logs yyc3-app

# å¸¸è§è§£å†³æ–¹æ¡ˆ
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
# 2. æ£€æŸ¥ç«¯å£å ç”¨
# 3. æ£€æŸ¥èµ„æºé™åˆ¶
# 4. é‡æ–°æ„å»ºé•œåƒ
```

#### é—®é¢˜2: æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
docker exec yyc3-postgres pg_isready -U postgres

# å¸¸è§è§£å†³æ–¹æ¡ˆ
# 1. æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
# 2. éªŒè¯è¿æ¥å­—ç¬¦ä¸²
# 3. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
# 4. éªŒè¯æƒé™è®¾ç½®
```

#### é—®é¢˜3: å‰ç«¯æ— æ³•è®¿é—®åç«¯
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
curl -v http://localhost:3001/api/health

# å¸¸è§è§£å†³æ–¹æ¡ˆ
# 1. æ£€æŸ¥Nginxé…ç½®
# 2. éªŒè¯APIè·¯ç”±
# 3. æ£€æŸ¥CORSè®¾ç½®
# 4. éªŒè¯è®¤è¯é…ç½®
```

### æ€§èƒ½é—®é¢˜

#### é—®é¢˜1: é¡µé¢åŠ è½½ç¼“æ…¢
```javascript
// å‰ç«¯æ€§èƒ½ä¼˜åŒ–
// 1. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
// 2. å›¾ç‰‡ä¼˜åŒ–å’Œå‹ç¼©
// 3. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
// 4. Bundleåˆ†æå’Œä¼˜åŒ–
```

#### é—®é¢˜2: APIå“åº”æ…¢
```typescript
// åç«¯æ€§èƒ½ä¼˜åŒ–
// 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
// 2. ç¼“å­˜çƒ­ç‚¹æ•°æ®
// 3. è¿æ¥æ± ä¼˜åŒ–
// 4. å¼‚æ­¥å¤„ç†ä¼˜åŒ–
// 5. ç›‘æ§æ€§èƒ½æŒ‡æ ‡
```

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ
- [ ] æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
- [ ] SSLè¯ä¹¦é…ç½®å®Œæˆ
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®å®Œæˆ
- [ ] ç›‘æ§ç³»ç»Ÿé…ç½®å®Œæˆ

### éƒ¨ç½²ä¸­æ£€æŸ¥
- [ ] Dockeré•œåƒæ„å»ºæˆåŠŸ
- [ ] å®¹å™¨å¯åŠ¨æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æˆåŠŸ
- [ ] APIå¥åº·æ£€æŸ¥é€šè¿‡
- [ ] é™æ€æ–‡ä»¶æœåŠ¡æ­£å¸¸

### éƒ¨ç½²åæ£€æŸ¥
- [ ] åº”ç”¨è®¿é—®æ­£å¸¸
- [ ] ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•
- [ ] AIå¯¹è¯åŠŸèƒ½æ­£å¸¸
- [ WebSocketè¿æ¥ç¨³å®š
- [ ] ç›‘æ§æ•°æ®æ­£å¸¸

### ä¸Šçº¿åæ£€æŸ¥
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
- [ ] é”™è¯¯ç‡åœ¨å¯æ¥å—èŒƒå›´
- [ ] å¤‡ä»½æœºåˆ¶æ­£å¸¸
- - ç”¨æˆ·åé¦ˆæ­£å¸¸
- - ç›‘æ§å‘Šè­¦æ­£å¸¸é…ç½®

---

## ğŸ“ æ”¯æŒä¿¡æ¯

### æŠ€æœ¯æ”¯æŒ
- **æ–‡æ¡£**: å®Œæ•´çš„éƒ¨ç½²å’Œè¿ç»´æ–‡æ¡£
- **å·¥å…·**: è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç®¡ç†è„šæœ¬
- **ç›‘æ§**: å®Œæ•´çš„ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿ
- **åŸ¹è®­**: æŠ€æœ¯æ ˆä½¿ç”¨åŸ¹è®­

### è”ç³»æ–¹å¼
- **æŠ€æœ¯é—®é¢˜**: support@yyc3.com
- **ç´§æ€¥è”ç³»**: emergency@yyc3.com
- **é¡¹ç›®ä»“åº“**: [GitHubé¡¹ç›®åœ°å€]

---

**éƒ¨ç½²æ—¶é—´**: 2025-11-12
**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: $(date +%Y-%m-%d)
**ç»´æŠ¤å›¢é˜Ÿ**: YYC3å¼€å‘å›¢é˜Ÿ

**çŠ¶æ€**: ğŸŸ¡ å‡†å¤‡å°±ç»ª - ç«‹å³å¼€å§‹éƒ¨ç½²ï¼